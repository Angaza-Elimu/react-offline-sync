var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
import isEqual from 'lodash/isEqual';
import * as actionCreators from '../redux/actionCreators';
import createReducer, { initialState, networkSelector, } from '../redux/createReducer';
import getSimilarActionInQueue from '../utils/getSimilarActionInQueue';
var networkReducer = createReducer();
var getState = function (isConnected) {
    if (isConnected === void 0) { isConnected = false; }
    var actionQueue = [];
    for (var _i = 1; _i < arguments.length; _i++) {
        actionQueue[_i - 1] = arguments[_i];
    }
    return ({
        isConnected: isConnected,
        actionQueue: actionQueue,
        isQueuePaused: false,
    });
};
/** Actions used from now on to test different scenarios */
var prevActionToRetry1 = {
    type: 'FETCH_DATA_REQUEST',
    payload: {
        id: '1',
    },
    meta: {
        retry: true,
    },
};
var prevActionToRetry2 = {
    type: 'FETCH_OTHER_REQUEST',
    payload: {
        isFetching: true,
    },
    meta: {
        retry: true,
    },
};
var prevActionToRetry1WithDifferentPayload = {
    type: 'FETCH_DATA_REQUEST',
    payload: {
        id: '2',
    },
    meta: {
        retry: true,
    },
};
describe('unknown action type', function () {
    it('returns prevState on initialization', function () {
        expect(networkReducer(undefined, { type: 'ACTION_I_DONT_CARE' })).toEqual(initialState);
    });
    it('returns prevState if the action is not handled', function () {
        expect(networkReducer(initialState, { type: 'ANOTHER_ACTION_I_DONT_CARE' })).toEqual(initialState);
    });
});
describe('CONNECTION_CHANGE action type', function () {
    it('changes isConnected state properly', function () {
        var mockAction = actionCreators.connectionChange(false);
        expect(networkReducer(initialState, mockAction)).toEqual({
            isConnected: false,
            actionQueue: [],
            isQueuePaused: false,
        });
    });
});
describe('OFFLINE_ACTION action type', function () {
    describe('meta.retry !== true', function () {
        it('should NOT add the action to the queue', function () {
            var prevAction = {
                type: 'FETCH_DATA_REQUEST',
                payload: {
                    id: '1',
                },
            };
            var anotherPrevAction = {
                type: 'FETCH_DATA_REQUEST',
                payload: {
                    id: '1',
                },
                meta: {
                    retry: false,
                },
            };
            var action = actionCreators.fetchOfflineMode(prevAction);
            var anotherAction = actionCreators.fetchOfflineMode(anotherPrevAction);
            expect(networkReducer(initialState, action)).toEqual(initialState);
            expect(networkReducer(initialState, anotherAction)).toEqual(initialState);
        });
    });
    describe('meta.retry === true', function () {
        describe('actions with DIFFERENT type', function () {
            it('actions are pushed into the queue in order of arrival', function () {
                var preAction = actionCreators.connectionChange(false);
                var action1 = actionCreators.fetchOfflineMode(prevActionToRetry1);
                var prevState = networkReducer(initialState, preAction);
                var nextState = networkReducer(prevState, action1);
                expect(nextState).toEqual({
                    isConnected: false,
                    actionQueue: [prevActionToRetry1],
                    isQueuePaused: false,
                });
                var action2 = actionCreators.fetchOfflineMode(prevActionToRetry2);
                nextState = networkReducer(nextState, action2);
                expect(nextState).toEqual(getState(false, prevActionToRetry1, prevActionToRetry2));
            });
        });
        describe('thunks that are the same with custom comparison function', function () {
            function comparisonFn(action, actionQueue) {
                if (typeof action === 'object') {
                    return actionQueue.find(function (queued) { return isEqual(queued, action); });
                }
                if (typeof action === 'function') {
                    return actionQueue.find(function (queued) {
                        return action.meta.name === queued.meta.name &&
                            action.meta.args.id === queued.meta.args.id;
                    });
                }
                return undefined;
            }
            var thunkFactory = function (id, name, age) {
                function thunk(dispatch) {
                    dispatch({ type: 'UPDATE_DATA_REQUEST', payload: { id: id, name: name, age: age } });
                }
                thunk.meta = {
                    args: { id: id, name: name, age: age },
                    retry: true,
                };
                return thunk;
            };
            it("should add thunks if function is same but thunks are modifying different items", function () {
                var prevState = getState(false, thunkFactory(1, 'Bilbo', 55));
                var thunk = thunkFactory(2, 'Link', 54);
                var wrappedThunk = actionCreators.fetchOfflineMode(thunk);
                expect(getSimilarActionInQueue(thunk, prevState.actionQueue)).toEqual(prevState.actionQueue[0]);
                var nextState = createReducer(comparisonFn)(prevState, wrappedThunk);
                expect(nextState.actionQueue).toHaveLength(2);
            });
            it("should replace a thunk if thunk already exists to modify same item", function () {
                var prevState = getState(false, thunkFactory(1, 'Bilbo', 55));
                var thunk = thunkFactory(1, 'Bilbo', 65);
                var wrappedThunk = actionCreators.fetchOfflineMode(thunk);
                expect(getSimilarActionInQueue(thunk, prevState.actionQueue)).toEqual(prevState.actionQueue[0]);
                var nextState = createReducer(comparisonFn)(prevState, wrappedThunk);
                expect(nextState.actionQueue).toHaveLength(1);
            });
        });
        describe('actions with the same type', function () {
            it("should remove the action and add it back at the end of the queue\n   if the action has the same payload", function () {
                var prevState = getState(false, prevActionToRetry1, prevActionToRetry2);
                var action = actionCreators.fetchOfflineMode(prevActionToRetry1);
                var nextState = networkReducer(prevState, action);
                expect(nextState).toEqual(getState(false, prevActionToRetry2, prevActionToRetry1));
            });
            it("should push the action if the payload is different", function () {
                var prevState = getState(false, prevActionToRetry2, prevActionToRetry1);
                var action = actionCreators.fetchOfflineMode(prevActionToRetry1WithDifferentPayload);
                expect(networkReducer(prevState, action)).toEqual(getState(false, prevActionToRetry2, prevActionToRetry1, prevActionToRetry1WithDifferentPayload));
            });
        });
    });
});
describe('REMOVE_ACTION_FROM_QUEUE action type', function () {
    it('removes the action from the queue properly', function () {
        var prevState = getState(false, prevActionToRetry2, prevActionToRetry1, prevActionToRetry1WithDifferentPayload);
        // Different object references but same shape, checking that deep equal works correctly
        var action = actionCreators.removeActionFromQueue(__assign({}, prevActionToRetry2));
        expect(networkReducer(prevState, action)).toEqual(getState(false, prevActionToRetry1, prevActionToRetry1WithDifferentPayload));
    });
});
describe('QUEUE_SEMAPHORE_CHANGE action type', function () {
    it('Pauses the queue if semaphore is red', function () {
        expect(networkReducer(undefined, actionCreators.changeQueueSemaphore('RED'))).toEqual(__assign(__assign({}, initialState), { isQueuePaused: true }));
    });
    it('Resumes the queue if semaphore is green', function () {
        expect(networkReducer(undefined, actionCreators.changeQueueSemaphore('GREEN'))).toEqual(__assign(__assign({}, initialState), { isQueuePaused: false }));
    });
});
describe('thunks', function () {
    function fetchThunk(dispatch) {
        dispatch({ type: 'FETCH_DATA_REQUEST' });
    }
    describe('FETCH_OFFLINE_MODE action type', function () {
        describe('action with meta.retry !== true', function () {
            it('should NOT add the action to the queue', function () {
                var action = actionCreators.fetchOfflineMode(fetchThunk);
                expect(networkReducer(initialState, action)).toEqual(initialState);
            });
        });
        describe('action with meta.retry === true', function () {
            it('should add the action to the queue if the thunk is different', function () {
                var prevState = getState(false);
                // Property 'meta' does not exist on type '(dispatch: Dispatch<AnyAction>) => void'
                fetchThunk.meta = {
                    retry: true,
                };
                var action = actionCreators.fetchOfflineMode(fetchThunk);
                expect(networkReducer(prevState, action)).toEqual(getState(false, fetchThunk));
            });
            it("should remove the thunk and add it back at the end of the queue \n      if it presents the same shape", function () {
                var thunkFactory = function (param) {
                    function thunk1(dispatch) {
                        dispatch({ type: 'FETCH_DATA_REQUEST', payload: param });
                    }
                    return thunk1;
                };
                var thunk = thunkFactory('foo');
                var prevState = getState(false, thunk);
                var similarThunk = thunkFactory('bar');
                similarThunk.meta = {
                    retry: true,
                };
                var action = actionCreators.fetchOfflineMode(similarThunk);
                var nextState = networkReducer(prevState, action);
                expect(nextState).toEqual(getState(false, similarThunk));
            });
        });
    });
    describe('REMOVE_ACTION_FROM_QUEUE action type', function () {
        it('removes the thunk from the queue properly', function () {
            var prevState = getState(false, fetchThunk);
            var action = actionCreators.removeActionFromQueue(fetchThunk);
            expect(networkReducer(prevState, action)).toEqual(getState(false));
        });
    });
});
describe('dismiss feature', function () {
    var actionEnqueued1 = {
        type: 'FETCH_PAGE_REQUEST',
        payload: {
            id: '2',
        },
        meta: {
            retry: true,
            dismiss: ['NAVIGATE_BACK', 'NAVIGATE_TO_LOGIN'],
        },
    };
    var actionEnqueued2 = {
        type: 'FETCH_USER_REQUEST',
        payload: {
            id: '4',
        },
        meta: {
            retry: true,
            dismiss: ['NAVIGATE_TO_LOGIN'],
        },
    };
    var actionEnqueued3 = {
        type: 'FETCH_USER_REQUEST',
        payload: {
            id: '4',
        },
        meta: {
            retry: true,
        },
    };
    it('NAVIGATE_BACK dispatched, dismissing 1 action', function () {
        var prevState = getState(false, actionEnqueued1, actionEnqueued2, actionEnqueued3);
        var action = actionCreators.dismissActionsFromQueue('NAVIGATE_BACK');
        expect(networkReducer(prevState, action)).toEqual(getState(false, actionEnqueued2, actionEnqueued3));
    });
    it('NAVIGATE_TO_LOGIN dispatched, dismissing 2 actions', function () {
        var prevState = getState(false, actionEnqueued1, actionEnqueued2, actionEnqueued3);
        var action = actionCreators.dismissActionsFromQueue('NAVIGATE_TO_LOGIN');
        expect(networkReducer(prevState, action)).toEqual(getState(false, actionEnqueued3));
    });
    it("Any other action dispatched, no changes (although the middleware won't allow that)", function () {
        var prevState = getState(false, actionEnqueued1, actionEnqueued2, actionEnqueued3);
        var action = actionCreators.dismissActionsFromQueue('NAVIGATE_AWAY');
        expect(networkReducer(prevState, action)).toEqual(getState(false, actionEnqueued1, actionEnqueued2, actionEnqueued3));
    });
});
describe('networkSelector', function () {
    it('returns the correct shape', function () {
        var state = {
            network: {
                isConnected: true,
                actionQueue: [{ type: 'foo', payload: {} }],
                isQueuePaused: false,
            },
        };
        expect(networkSelector(state)).toEqual({
            isConnected: true,
            actionQueue: [{ type: 'foo', payload: {} }],
            isQueuePaused: false,
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0RldkFDL0Rlc2t0b3AvQW5nYXphL3JlYWN0LW9mZmxpbmUtc3luYy9zcmMvdGVzdC9yZWR1Y2VyLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFDQSxPQUFPLE9BQU8sTUFBTSxnQkFBZ0IsQ0FBQztBQUNyQyxPQUFPLEtBQUssY0FBYyxNQUFNLDZCQUE2QixDQUFDO0FBRTlELE9BQU8sYUFBYSxFQUFFLEVBQ3BCLFlBQVksRUFDWixlQUFlLEdBQ2hCLE1BQU0sNEJBQTRCLENBQUM7QUFDcEMsT0FBTyx1QkFBdUIsTUFBTSxzQ0FBc0MsQ0FBQztBQUUzRSxJQUFNLGNBQWMsR0FBRyxhQUFhLEVBQUUsQ0FBQztBQUV2QyxJQUFNLFFBQVEsR0FBRyxVQUFDLFdBQW1CO0lBQW5CLDRCQUFBLEVBQUEsbUJBQW1CO0lBQUUscUJBQWdDO1NBQWhDLFVBQWdDLEVBQWhDLHFCQUFnQyxFQUFoQyxJQUFnQztRQUFoQyxvQ0FBZ0M7O0lBQUssT0FBQSxDQUFDO1FBQzNFLFdBQVcsYUFBQTtRQUNYLFdBQVcsYUFBQTtRQUNYLGFBQWEsRUFBRSxLQUFLO0tBQ3JCLENBQUM7QUFKMEUsQ0FJMUUsQ0FBQztBQUVILDJEQUEyRDtBQUMzRCxJQUFNLGtCQUFrQixHQUFHO0lBQ3pCLElBQUksRUFBRSxvQkFBb0I7SUFDMUIsT0FBTyxFQUFFO1FBQ1AsRUFBRSxFQUFFLEdBQUc7S0FDUjtJQUNELElBQUksRUFBRTtRQUNKLEtBQUssRUFBRSxJQUFJO0tBQ1o7Q0FDRixDQUFDO0FBQ0YsSUFBTSxrQkFBa0IsR0FBRztJQUN6QixJQUFJLEVBQUUscUJBQXFCO0lBQzNCLE9BQU8sRUFBRTtRQUNQLFVBQVUsRUFBRSxJQUFJO0tBQ2pCO0lBQ0QsSUFBSSxFQUFFO1FBQ0osS0FBSyxFQUFFLElBQUk7S0FDWjtDQUNGLENBQUM7QUFDRixJQUFNLHNDQUFzQyxHQUFHO0lBQzdDLElBQUksRUFBRSxvQkFBb0I7SUFDMUIsT0FBTyxFQUFFO1FBQ1AsRUFBRSxFQUFFLEdBQUc7S0FDUjtJQUNE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QUUsQ0FBQyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLEVBQUUsRUFBRSxDQUFDO1lBQzNDLGFBQWEsRUFBRSxLQUFLO1NBQ3JCLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL0RldkFDL0Rlc2t0b3AvQW5nYXphL3JlYWN0LW9mZmxpbmUtc3luYy9zcmMvdGVzdC9yZWR1Y2VyLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGlzcGF0Y2ggfSBmcm9tICdyZWR1eCc7XG5pbXBvcnQgaXNFcXVhbCBmcm9tICdsb2Rhc2gvaXNFcXVhbCc7XG5pbXBvcnQgKiBhcyBhY3Rpb25DcmVhdG9ycyBmcm9tICcuLi9zcmMvcmVkdXgvYWN0aW9uQ3JlYXRvcnMnO1xuaW1wb3J0IHsgRW5xdWV1ZWRBY3Rpb24sIE5ldHdvcmtTdGF0ZSB9IGZyb20gJy4uL3NyYy90eXBlcyc7XG5pbXBvcnQgY3JlYXRlUmVkdWNlciwge1xuICBpbml0aWFsU3RhdGUsXG4gIG5ldHdvcmtTZWxlY3Rvcixcbn0gZnJvbSAnLi4vc3JjL3JlZHV4L2NyZWF0ZVJlZHVjZXInO1xuaW1wb3J0IGdldFNpbWlsYXJBY3Rpb25JblF1ZXVlIGZyb20gJy4uL3NyYy91dGlscy9nZXRTaW1pbGFyQWN0aW9uSW5RdWV1ZSc7XG5cbmNvbnN0IG5ldHdvcmtSZWR1Y2VyID0gY3JlYXRlUmVkdWNlcigpO1xuXG5jb25zdCBnZXRTdGF0ZSA9IChpc0Nvbm5lY3RlZCA9IGZhbHNlLCAuLi5hY3Rpb25RdWV1ZTogRW5xdWV1ZWRBY3Rpb25bXSkgPT4gKHtcbiAgaXNDb25uZWN0ZWQsXG4gIGFjdGlvblF1ZXVlLFxuICBpc1F1ZXVlUGF1c2VkOiBmYWxzZSxcbn0pO1xuXG4vKiogQWN0aW9ucyB1c2VkIGZyb20gbm93IG9uIHRvIHRlc3QgZGlmZmVyZW50IHNjZW5hcmlvcyAqL1xuY29uc3QgcHJldkFjdGlvblRvUmV0cnkxID0ge1xuICB0eXBlOiAnRkVUQ0hfREFUQV9SRVFVRVNUJyxcbiAgcGF5bG9hZDoge1xuICAgIGlkOiAnMScsXG4gIH0sXG4gIG1ldGE6IHtcbiAgICByZXRyeTogdHJ1ZSxcbiAgfSxcbn07XG5jb25zdCBwcmV2QWN0aW9uVG9SZXRyeTIgPSB7XG4gIHR5cGU6ICdGRVRDSF9PVEhFUl9SRVFVRVNUJyxcbiAgcGF5bG9hZDoge1xuICAgIGlzRmV0Y2hpbmc6IHRydWUsXG4gIH0sXG4gIG1ldGE6IHtcbiAgICByZXRyeTogdHJ1ZSxcbiAgfSxcbn07XG5jb25zdCBwcmV2QWN0aW9uVG9SZXRyeTFXaXRoRGlmZmVyZW50UGF5bG9hZCA9IHtcbiAgdHlwZTogJ0ZFVENIX0RBVEFfUkVRVUVTVCcsXG4gIHBheWxvYWQ6IHtcbiAgICBpZDogJzInLFxuICB9LFxuICBtZXRhOiB7XG4gICAgcmV0cnk6IHRydWUsXG4gIH0sXG59O1xuXG5kZXNjcmliZSgndW5rbm93biBhY3Rpb24gdHlwZScsICgpID0+IHtcbiAgaXQoJ3JldHVybnMgcHJldlN0YXRlIG9uIGluaXRpYWxpemF0aW9uJywgKCkgPT4ge1xuICAgIGV4cGVjdChuZXR3b3JrUmVkdWNlcih1bmRlZmluZWQsIHsgdHlwZTogJ0FDVElPTl9JX0RPTlRfQ0FSRScgfSkpLnRvRXF1YWwoXG4gICAgICBpbml0aWFsU3RhdGUsXG4gICAgKTtcbiAgfSk7XG5cbiAgaXQoJ3JldHVybnMgcHJldlN0YXRlIGlmIHRoZSBhY3Rpb24gaXMgbm90IGhhbmRsZWQnLCAoKSA9PiB7XG4gICAgZXhwZWN0KFxuICAgICAgbmV0d29ya1JlZHVjZXIoaW5pdGlhbFN0YXRlLCB7IHR5cGU6ICdBTk9USEVSX0FDVElPTl9JX0RPTlRfQ0FSRScgfSksXG4gICAgKS50b0VxdWFsKGluaXRpYWxTdGF0ZSk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdDT05ORUNUSU9OX0NIQU5HRSBhY3Rpb24gdHlwZScsICgpID0+IHtcbiAgaXQoJ2NoYW5nZXMgaXNDb25uZWN0ZWQgc3RhdGUgcHJvcGVybHknLCAoKSA9PiB7XG4gICAgY29uc3QgbW9ja0FjdGlvbiA9IGFjdGlvbkNyZWF0b3JzLmNvbm5lY3Rpb25DaGFuZ2UoZmFsc2UpO1xuICAgIGV4cGVjdChuZXR3b3JrUmVkdWNlcihpbml0aWFsU3RhdGUsIG1vY2tBY3Rpb24pKS50b0VxdWFsKHtcbiAgICAgIGlzQ29ubmVjdGVkOiBmYWxzZSxcbiAgICAgIGFjdGlvblF1ZXVlOiBbXSxcbiAgICAgIGlzUXVldWVQYXVzZWQ6IGZhbHNlLFxuICAgIH0pO1xuICB9KTtcbn0pO1xuXG5kZXNjcmliZSgnT0ZGTElORV9BQ1RJT04gYWN0aW9uIHR5cGUnLCAoKSA9PiB7XG4gIGRlc2NyaWJlKCdtZXRhLnJldHJ5ICE9PSB0cnVlJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgTk9UIGFkZCB0aGUgYWN0aW9uIHRvIHRoZSBxdWV1ZScsICgpID0+IHtcbiAgICAgIGNvbnN0IHByZXZBY3Rpb24gPSB7XG4gICAgICAgIHR5cGU6ICdGRVRDSF9EQVRBX1JFUVVFU1QnLFxuICAgICAgICBwYXlsb2FkOiB7XG4gICAgICAgICAgaWQ6ICcxJyxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgICBjb25zdCBhbm90aGVyUHJldkFjdGlvbiA9IHtcbiAgICAgICAgdHlwZTogJ0ZFVENIX0RBVEFfUkVRVUVTVCcsXG4gICAgICAgIHBheWxvYWQ6IHtcbiAgICAgICAgICBpZDogJzEnLFxuICAgICAgICB9LFxuICAgICAgICBtZXRhOiB7XG4gICAgICAgICAgcmV0cnk6IGZhbHNlLFxuICAgICAgICB9LFxuICAgICAgfTtcblxuICAgICAgY29uc3QgYWN0aW9uID0gYWN0aW9uQ3JlYXRvcnMuZmV0Y2hPZmZsaW5lTW9kZShwcmV2QWN0aW9uKTtcbiAgICAgIGNvbnN0IGFub3RoZXJBY3Rpb24gPSBhY3Rpb25DcmVhdG9ycy5mZXRjaE9mZmxpbmVNb2RlKGFub3RoZXJQcmV2QWN0aW9uKTtcblxuICAgICAgZXhwZWN0KG5ldHdvcmtSZWR1Y2VyKGluaXRpYWxTdGF0ZSwgYWN0aW9uKSkudG9FcXVhbChpbml0aWFsU3RhdGUpO1xuICAgICAgZXhwZWN0KG5ldHdvcmtSZWR1Y2VyKGluaXRpYWxTdGF0ZSwgYW5vdGhlckFjdGlvbikpLnRvRXF1YWwoaW5pdGlhbFN0YXRlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ21ldGEucmV0cnkgPT09IHRydWUnLCAoKSA9PiB7XG4gICAgZGVzY3JpYmUoJ2FjdGlvbnMgd2l0aCBESUZGRVJFTlQgdHlwZScsICgpID0+IHtcbiAgICAgIGl0KCdhY3Rpb25zIGFyZSBwdXNoZWQgaW50byB0aGUgcXVldWUgaW4gb3JkZXIgb2YgYXJyaXZhbCcsICgpID0+IHtcbiAgICAgICAgY29uc3QgcHJlQWN0aW9uID0gYWN0aW9uQ3JlYXRvcnMuY29ubmVjdGlvbkNoYW5nZShmYWxzZSk7XG4gICAgICAgIGNvbnN0IGFjdGlvbjEgPSBhY3Rpb25DcmVhdG9ycy5mZXRjaE9mZmxpbmVNb2RlKHByZXZBY3Rpb25Ub1JldHJ5MSk7XG4gICAgICAgIGNvbnN0IHByZXZTdGF0ZSA9IG5ldHdvcmtSZWR1Y2VyKGluaXRpYWxTdGF0ZSwgcHJlQWN0aW9uKTtcblxuICAgICAgICBsZXQgbmV4dFN0YXRlID0gbmV0d29ya1JlZHVjZXIocHJldlN0YXRlLCBhY3Rpb24xKTtcblxuICAgICAgICBleHBlY3QobmV4dFN0YXRlKS50b0VxdWFsKHtcbiAgICAgICAgICBpc0Nvbm5lY3RlZDogZmFsc2UsXG4gICAgICAgICAgYWN0aW9uUXVldWU6IFtwcmV2QWN0aW9uVG9SZXRyeTFdLFxuICAgICAgICAgIGlzUXVldWVQYXVzZWQ6IGZhbHNlLFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBhY3Rpb24yID0gYWN0aW9uQ3JlYXRvcnMuZmV0Y2hPZmZsaW5lTW9kZShwcmV2QWN0aW9uVG9SZXRyeTIpO1xuICAgICAgICBuZXh0U3RhdGUgPSBuZXR3b3JrUmVkdWNlcihuZXh0U3RhdGUsIGFjdGlvbjIpO1xuXG4gICAgICAgIGV4cGVjdChuZXh0U3RhdGUpLnRvRXF1YWwoXG4gICAgICAgICAgZ2V0U3RhdGUoZmFsc2UsIHByZXZBY3Rpb25Ub1JldHJ5MSwgcHJldkFjdGlvblRvUmV0cnkyKSxcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ3RodW5rcyB0aGF0IGFyZSB0aGUgc2FtZSB3aXRoIGN1c3RvbSBjb21wYXJpc29uIGZ1bmN0aW9uJywgKCkgPT4ge1xuICAgICAgZnVuY3Rpb24gY29tcGFyaXNvbkZuKGFjdGlvbjogYW55LCBhY3Rpb25RdWV1ZTogRW5xdWV1ZWRBY3Rpb25bXSkge1xuICAgICAgICBpZiAodHlwZW9mIGFjdGlvbiA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICByZXR1cm4gYWN0aW9uUXVldWUuZmluZChxdWV1ZWQgPT4gaXNFcXVhbChxdWV1ZWQsIGFjdGlvbikpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2YgYWN0aW9uID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgcmV0dXJuIGFjdGlvblF1ZXVlLmZpbmQoXG4gICAgICAgICAgICBxdWV1ZWQgPT5cbiAgICAgICAgICAgICAgYWN0aW9uLm1ldGEubmFtZSA9PT0gcXVldWVkLm1ldGEhLm5hbWUgJiZcbiAgICAgICAgICAgICAgYWN0aW9uLm1ldGEuYXJncy5pZCA9PT0gcXVldWVkLm1ldGEhLmFyZ3MuaWQsXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB0aHVua0ZhY3RvcnkgPSAoaWQ6IG51bWJlciwgbmFtZTogc3RyaW5nLCBhZ2U6IG51bWJlcikgPT4ge1xuICAgICAgICBmdW5jdGlvbiB0aHVuayhkaXNwYXRjaDogRGlzcGF0Y2gpIHtcbiAgICAgICAgICBkaXNwYXRjaCh7IHR5cGU6ICdVUERBVEVfREFUQV9SRVFVRVNUJywgcGF5bG9hZDogeyBpZCwgbmFtZSwgYWdlIH0gfSk7XG4gICAgICAgIH1cbiAgICAgICAgdGh1bmsubWV0YSA9IHtcbiAgICAgICAgICBhcmdzOiB7IGlkLCBuYW1lLCBhZ2UgfSxcbiAgICAgICAgICByZXRyeTogdHJ1ZSxcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHRodW5rO1xuICAgICAgfTtcblxuICAgICAgaXQoYHNob3VsZCBhZGQgdGh1bmtzIGlmIGZ1bmN0aW9uIGlzIHNhbWUgYnV0IHRodW5rcyBhcmUgbW9kaWZ5aW5nIGRpZmZlcmVudCBpdGVtc2AsICgpID0+IHtcbiAgICAgICAgY29uc3QgcHJldlN0YXRlID0gZ2V0U3RhdGUoZmFsc2UsIHRodW5rRmFjdG9yeSgxLCAnQmlsYm8nLCA1NSkpO1xuICAgICAgICBjb25zdCB0aHVuayA9IHRodW5rRmFjdG9yeSgyLCAnTGluaycsIDU0KTtcbiAgICAgICAgY29uc3Qgd3JhcHBlZFRodW5rID0gYWN0aW9uQ3JlYXRvcnMuZmV0Y2hPZmZsaW5lTW9kZSh0aHVuayk7XG5cbiAgICAgICAgZXhwZWN0KGdldFNpbWlsYXJBY3Rpb25JblF1ZXVlKHRodW5rLCBwcmV2U3RhdGUuYWN0aW9uUXVldWUpKS50b0VxdWFsKFxuICAgICAgICAgIHByZXZTdGF0ZS5hY3Rpb25RdWV1ZVswXSxcbiAgICAgICAgKTtcblxuICAgICAgICBjb25zdCBuZXh0U3RhdGUgPSBjcmVhdGVSZWR1Y2VyKGNvbXBhcmlzb25GbikocHJldlN0YXRlLCB3cmFwcGVkVGh1bmspO1xuXG4gICAgICAgIGV4cGVjdChuZXh0U3RhdGUuYWN0aW9uUXVldWUpLnRvSGF2ZUxlbmd0aCgyKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdChgc2hvdWxkIHJlcGxhY2UgYSB0aHVuayBpZiB0aHVuayBhbHJlYWR5IGV4aXN0cyB0byBtb2RpZnkgc2FtZSBpdGVtYCwgKCkgPT4ge1xuICAgICAgICBjb25zdCBwcmV2U3RhdGUgPSBnZXRTdGF0ZShmYWxzZSwgdGh1bmtGYWN0b3J5KDEsICdCaWxibycsIDU1KSk7XG4gICAgICAgIGNvbnN0IHRodW5rID0gdGh1bmtGYWN0b3J5KDEsICdCaWxibycsIDY1KTtcbiAgICAgICAgY29uc3Qgd3JhcHBlZFRodW5rID0gYWN0aW9uQ3JlYXRvcnMuZmV0Y2hPZmZsaW5lTW9kZSh0aHVuayk7XG5cbiAgICAgICAgZXhwZWN0KGdldFNpbWlsYXJBY3Rpb25JblF1ZXVlKHRodW5rLCBwcmV2U3RhdGUuYWN0aW9uUXVldWUpKS50b0VxdWFsKFxuICAgICAgICAgIHByZXZTdGF0ZS5hY3Rpb25RdWV1ZVswXSxcbiAgICAgICAgKTtcblxuICAgICAgICBjb25zdCBuZXh0U3RhdGUgPSBjcmVhdGVSZWR1Y2VyKGNvbXBhcmlzb25GbikocHJldlN0YXRlLCB3cmFwcGVkVGh1bmspO1xuXG4gICAgICAgIGV4cGVjdChuZXh0U3RhdGUuYWN0aW9uUXVldWUpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2FjdGlvbnMgd2l0aCB0aGUgc2FtZSB0eXBlJywgKCkgPT4ge1xuICAgICAgaXQoYHNob3VsZCByZW1vdmUgdGhlIGFjdGlvbiBhbmQgYWRkIGl0IGJhY2sgYXQgdGhlIGVuZCBvZiB0aGUgcXVldWVcbiAgIGlmIHRoZSBhY3Rpb24gaGFzIHRoZSBzYW1lIHBheWxvYWRgLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHByZXZTdGF0ZSA9IGdldFN0YXRlKFxuICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgIHByZXZBY3Rpb25Ub1JldHJ5MSxcbiAgICAgICAgICBwcmV2QWN0aW9uVG9SZXRyeTIsXG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IGFjdGlvbiA9IGFjdGlvbkNyZWF0b3JzLmZldGNoT2ZmbGluZU1vZGUocHJldkFjdGlvblRvUmV0cnkxKTtcblxuICAgICAgICBjb25zdCBuZXh0U3RhdGUgPSBuZXR3b3JrUmVkdWNlcihwcmV2U3RhdGUsIGFjdGlvbik7XG4gICAgICAgIGV4cGVjdChuZXh0U3RhdGUpLnRvRXF1YWwoXG4gICAgICAgICAgZ2V0U3RhdGUoZmFsc2UsIHByZXZBY3Rpb25Ub1JldHJ5MiwgcHJldkFjdGlvblRvUmV0cnkxKSxcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdChgc2hvdWxkIHB1c2ggdGhlIGFjdGlvbiBpZiB0aGUgcGF5bG9hZCBpcyBkaWZmZXJlbnRgLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHByZXZTdGF0ZSA9IGdldFN0YXRlKFxuICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgIHByZXZBY3Rpb25Ub1JldHJ5MixcbiAgICAgICAgICBwcmV2QWN0aW9uVG9SZXRyeTEsXG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IGFjdGlvbiA9IGFjdGlvbkNyZWF0b3JzLmZldGNoT2ZmbGluZU1vZGUoXG4gICAgICAgICAgcHJldkFjdGlvblRvUmV0cnkxV2l0aERpZmZlcmVudFBheWxvYWQsXG4gICAgICAgICk7XG5cbiAgICAgICAgZXhwZWN0KG5ldHdvcmtSZWR1Y2VyKHByZXZTdGF0ZSwgYWN0aW9uKSkudG9FcXVhbChcbiAgICAgICAgICBnZXRTdGF0ZShcbiAgICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgICAgcHJldkFjdGlvblRvUmV0cnkyLFxuICAgICAgICAgICAgcHJldkFjdGlvblRvUmV0cnkxLFxuICAgICAgICAgICAgcHJldkFjdGlvblRvUmV0cnkxV2l0aERpZmZlcmVudFBheWxvYWQsXG4gICAgICAgICAgKSxcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuXG5kZXNjcmliZSgnUkVNT1ZFX0FDVElPTl9GUk9NX1FVRVVFIGFjdGlvbiB0eXBlJywgKCkgPT4ge1xuICBpdCgncmVtb3ZlcyB0aGUgYWN0aW9uIGZyb20gdGhlIHF1ZXVlIHByb3Blcmx5JywgKCkgPT4ge1xuICAgIGNvbnN0IHByZXZTdGF0ZSA9IGdldFN0YXRlKFxuICAgICAgZmFsc2UsXG4gICAgICBwcmV2QWN0aW9uVG9SZXRyeTIsXG4gICAgICBwcmV2QWN0aW9uVG9SZXRyeTEsXG4gICAgICBwcmV2QWN0aW9uVG9SZXRyeTFXaXRoRGlmZmVyZW50UGF5bG9hZCxcbiAgICApO1xuICAgIC8vIERpZmZlcmVudCBvYmplY3QgcmVmZXJlbmNlcyBidXQgc2FtZSBzaGFwZSwgY2hlY2tpbmcgdGhhdCBkZWVwIGVxdWFsIHdvcmtzIGNvcnJlY3RseVxuICAgIGNvbnN0IGFjdGlvbiA9IGFjdGlvbkNyZWF0b3JzLnJlbW92ZUFjdGlvbkZyb21RdWV1ZSh7XG4gICAgICAuLi5wcmV2QWN0aW9uVG9SZXRyeTIsXG4gICAgfSk7XG5cbiAgICBleHBlY3QobmV0d29ya1JlZHVjZXIocHJldlN0YXRlLCBhY3Rpb24pKS50b0VxdWFsKFxuICAgICAgZ2V0U3RhdGUoXG4gICAgICAgIGZhbHNlLFxuICAgICAgICBwcmV2QWN0aW9uVG9SZXRyeTEsXG4gICAgICAgIHByZXZBY3Rpb25Ub1JldHJ5MVdpdGhEaWZmZXJlbnRQYXlsb2FkLFxuICAgICAgKSxcbiAgICApO1xuICB9KTtcbn0pO1xuXG5kZXNjcmliZSgnUVVFVUVfU0VNQVBIT1JFX0NIQU5HRSBhY3Rpb24gdHlwZScsICgpID0+IHtcbiAgaXQoJ1BhdXNlcyB0aGUgcXVldWUgaWYgc2VtYXBob3JlIGlzIHJlZCcsICgpID0+IHtcbiAgICBleHBlY3QoXG4gICAgICBuZXR3b3JrUmVkdWNlcih1bmRlZmluZWQsIGFjdGlvbkNyZWF0b3JzLmNoYW5nZVF1ZXVlU2VtYXBob3JlKCdSRUQnKSksXG4gICAgKS50b0VxdWFsKHtcbiAgICAgIC4uLmluaXRpYWxTdGF0ZSxcbiAgICAgIGlzUXVldWVQYXVzZWQ6IHRydWUsXG4gICAgfSk7XG4gIH0pO1xuXG4gIGl0KCdSZXN1bWVzIHRoZSBxdWV1ZSBpZiBzZW1hcGhvcmUgaXMgZ3JlZW4nLCAoKSA9PiB7XG4gICAgZXhwZWN0KFxuICAgICAgbmV0d29ya1JlZHVjZXIodW5kZWZpbmVkLCBhY3Rpb25DcmVhdG9ycy5jaGFuZ2VRdWV1ZVNlbWFwaG9yZSgnR1JFRU4nKSksXG4gICAgKS50b0VxdWFsKHtcbiAgICAgIC4uLmluaXRpYWxTdGF0ZSxcbiAgICAgIGlzUXVldWVQYXVzZWQ6IGZhbHNlLFxuICAgIH0pO1xuICB9KTtcbn0pO1xuXG5kZXNjcmliZSgndGh1bmtzJywgKCkgPT4ge1xuICBmdW5jdGlvbiBmZXRjaFRodW5rKGRpc3BhdGNoOiBEaXNwYXRjaCkge1xuICAgIGRpc3BhdGNoKHsgdHlwZTogJ0ZFVENIX0RBVEFfUkVRVUVTVCcgfSk7XG4gIH1cblxuICBkZXNjcmliZSgnRkVUQ0hfT0ZGTElORV9NT0RFIGFjdGlvbiB0eXBlJywgKCkgPT4ge1xuICAgIGRlc2NyaWJlKCdhY3Rpb24gd2l0aCBtZXRhLnJldHJ5ICE9PSB0cnVlJywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCBOT1QgYWRkIHRoZSBhY3Rpb24gdG8gdGhlIHF1ZXVlJywgKCkgPT4ge1xuICAgICAgICBjb25zdCBhY3Rpb24gPSBhY3Rpb25DcmVhdG9ycy5mZXRjaE9mZmxpbmVNb2RlKGZldGNoVGh1bmspO1xuICAgICAgICBleHBlY3QobmV0d29ya1JlZHVjZXIoaW5pdGlhbFN0YXRlLCBhY3Rpb24pKS50b0VxdWFsKGluaXRpYWxTdGF0ZSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdhY3Rpb24gd2l0aCBtZXRhLnJldHJ5ID09PSB0cnVlJywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCBhZGQgdGhlIGFjdGlvbiB0byB0aGUgcXVldWUgaWYgdGhlIHRodW5rIGlzIGRpZmZlcmVudCcsICgpID0+IHtcbiAgICAgICAgY29uc3QgcHJldlN0YXRlID0gZ2V0U3RhdGUoZmFsc2UpO1xuXG4gICAgICAgIC8vIFByb3BlcnR5ICdtZXRhJyBkb2VzIG5vdCBleGlzdCBvbiB0eXBlICcoZGlzcGF0Y2g6IERpc3BhdGNoPEFueUFjdGlvbj4pID0+IHZvaWQnXG4gICAgICAgIChmZXRjaFRodW5rIGFzIGFueSkubWV0YSA9IHtcbiAgICAgICAgICByZXRyeTogdHJ1ZSxcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgYWN0aW9uID0gYWN0aW9uQ3JlYXRvcnMuZmV0Y2hPZmZsaW5lTW9kZShmZXRjaFRodW5rKTtcblxuICAgICAgICBleHBlY3QobmV0d29ya1JlZHVjZXIocHJldlN0YXRlLCBhY3Rpb24pKS50b0VxdWFsKFxuICAgICAgICAgIGdldFN0YXRlKGZhbHNlLCBmZXRjaFRodW5rKSxcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdChgc2hvdWxkIHJlbW92ZSB0aGUgdGh1bmsgYW5kIGFkZCBpdCBiYWNrIGF0IHRoZSBlbmQgb2YgdGhlIHF1ZXVlIFxuICAgICAgaWYgaXQgcHJlc2VudHMgdGhlIHNhbWUgc2hhcGVgLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHRodW5rRmFjdG9yeSA9IChwYXJhbTogYW55KSA9PiB7XG4gICAgICAgICAgZnVuY3Rpb24gdGh1bmsxKGRpc3BhdGNoOiBEaXNwYXRjaCkge1xuICAgICAgICAgICAgZGlzcGF0Y2goeyB0eXBlOiAnRkVUQ0hfREFUQV9SRVFVRVNUJywgcGF5bG9hZDogcGFyYW0gfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiB0aHVuazE7XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHRodW5rID0gdGh1bmtGYWN0b3J5KCdmb28nKTtcbiAgICAgICAgY29uc3QgcHJldlN0YXRlID0gZ2V0U3RhdGUoZmFsc2UsIHRodW5rKTtcblxuICAgICAgICBjb25zdCBzaW1pbGFyVGh1bmsgPSB0aHVua0ZhY3RvcnkoJ2JhcicpO1xuICAgICAgICAoc2ltaWxhclRodW5rIGFzIGFueSkubWV0YSA9IHtcbiAgICAgICAgICByZXRyeTogdHJ1ZSxcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgYWN0aW9uID0gYWN0aW9uQ3JlYXRvcnMuZmV0Y2hPZmZsaW5lTW9kZShzaW1pbGFyVGh1bmspO1xuICAgICAgICBjb25zdCBuZXh0U3RhdGUgPSBuZXR3b3JrUmVkdWNlcihwcmV2U3RhdGUsIGFjdGlvbik7XG5cbiAgICAgICAgZXhwZWN0KG5leHRTdGF0ZSkudG9FcXVhbChnZXRTdGF0ZShmYWxzZSwgc2ltaWxhclRodW5rKSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1JFTU9WRV9BQ1RJT05fRlJPTV9RVUVVRSBhY3Rpb24gdHlwZScsICgpID0+IHtcbiAgICBpdCgncmVtb3ZlcyB0aGUgdGh1bmsgZnJvbSB0aGUgcXVldWUgcHJvcGVybHknLCAoKSA9PiB7XG4gICAgICBjb25zdCBwcmV2U3RhdGUgPSBnZXRTdGF0ZShmYWxzZSwgZmV0Y2hUaHVuayk7XG4gICAgICBjb25zdCBhY3Rpb24gPSBhY3Rpb25DcmVhdG9ycy5yZW1vdmVBY3Rpb25Gcm9tUXVldWUoZmV0Y2hUaHVuayk7XG5cbiAgICAgIGV4cGVjdChuZXR3b3JrUmVkdWNlcihwcmV2U3RhdGUsIGFjdGlvbikpLnRvRXF1YWwoZ2V0U3RhdGUoZmFsc2UpKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ2Rpc21pc3MgZmVhdHVyZScsICgpID0+IHtcbiAgY29uc3QgYWN0aW9uRW5xdWV1ZWQxID0ge1xuICAgIHR5cGU6ICdGRVRDSF9QQUdFX1JFUVVFU1QnLFxuICAgIHBheWxvYWQ6IHtcbiAgICAgIGlkOiAnMicsXG4gICAgfSxcbiAgICBtZXRhOiB7XG4gICAgICByZXRyeTogdHJ1ZSxcbiAgICAgIGRpc21pc3M6IFsnTkFWSUdBVEVfQkFDSycsICdOQVZJR0FURV9UT19MT0dJTiddLFxuICAgIH0sXG4gIH07XG4gIGNvbnN0IGFjdGlvbkVucXVldWVkMiA9IHtcbiAgICB0eXBlOiAnRkVUQ0hfVVNFUl9SRVFVRVNUJyxcbiAgICBwYXlsb2FkOiB7XG4gICAgICBpZDogJzQnLFxuICAgIH0sXG4gICAgbWV0YToge1xuICAgICAgcmV0cnk6IHRydWUsXG4gICAgICBkaXNtaXNzOiBbJ05BVklHQVRFX1RPX0xPR0lOJ10sXG4gICAgfSxcbiAgfTtcbiAgY29uc3QgYWN0aW9uRW5xdWV1ZWQzID0ge1xuICAgIHR5cGU6ICdGRVRDSF9VU0VSX1JFUVVFU1QnLFxuICAgIHBheWxvYWQ6IHtcbiAgICAgIGlkOiAnNCcsXG4gICAgfSxcbiAgICBtZXRhOiB7XG4gICAgICByZXRyeTogdHJ1ZSxcbiAgICB9LFxuICB9O1xuXG4gIGl0KCdOQVZJR0FURV9CQUNLIGRpc3BhdGNoZWQsIGRpc21pc3NpbmcgMSBhY3Rpb24nLCAoKSA9PiB7XG4gICAgY29uc3QgcHJldlN0YXRlID0gZ2V0U3RhdGUoXG4gICAgICBmYWxzZSxcbiAgICAgIGFjdGlvbkVucXVldWVkMSxcbiAgICAgIGFjdGlvbkVucXVldWVkMixcbiAgICAgIGFjdGlvbkVucXVldWVkMyxcbiAgICApO1xuICAgIGNvbnN0IGFjdGlvbiA9IGFjdGlvbkNyZWF0b3JzLmRpc21pc3NBY3Rpb25zRnJvbVF1ZXVlKCdOQVZJR0FURV9CQUNLJyk7XG5cbiAgICBleHBlY3QobmV0d29ya1JlZHVjZXIocHJldlN0YXRlLCBhY3Rpb24pKS50b0VxdWFsKFxuICAgICAgZ2V0U3RhdGUoZmFsc2UsIGFjdGlvbkVucXVldWVkMiwgYWN0aW9uRW5xdWV1ZWQzKSxcbiAgICApO1xuICB9KTtcblxuICBpdCgnTkFWSUdBVEVfVE9fTE9HSU4gZGlzcGF0Y2hlZCwgZGlzbWlzc2luZyAyIGFjdGlvbnMnLCAoKSA9PiB7XG4gICAgY29uc3QgcHJldlN0YXRlID0gZ2V0U3RhdGUoXG4gICAgICBmYWxzZSxcbiAgICAgIGFjdGlvbkVucXVldWVkMSxcbiAgICAgIGFjdGlvbkVucXVldWVkMixcbiAgICAgIGFjdGlvbkVucXVldWVkMyxcbiAgICApO1xuICAgIGNvbnN0IGFjdGlvbiA9IGFjdGlvbkNyZWF0b3JzLmRpc21pc3NBY3Rpb25zRnJvbVF1ZXVlKCdOQVZJR0FURV9UT19MT0dJTicpO1xuXG4gICAgZXhwZWN0KG5ldHdvcmtSZWR1Y2VyKHByZXZTdGF0ZSwgYWN0aW9uKSkudG9FcXVhbChcbiAgICAgIGdldFN0YXRlKGZhbHNlLCBhY3Rpb25FbnF1ZXVlZDMpLFxuICAgICk7XG4gIH0pO1xuXG4gIGl0KFwiQW55IG90aGVyIGFjdGlvbiBkaXNwYXRjaGVkLCBubyBjaGFuZ2VzIChhbHRob3VnaCB0aGUgbWlkZGxld2FyZSB3b24ndCBhbGxvdyB0aGF0KVwiLCAoKSA9PiB7XG4gICAgY29uc3QgcHJldlN0YXRlID0gZ2V0U3RhdGUoXG4gICAgICBmYWxzZSxcbiAgICAgIGFjdGlvbkVucXVldWVkMSxcbiAgICAgIGFjdGlvbkVucXVldWVkMixcbiAgICAgIGFjdGlvbkVucXVldWVkMyxcbiAgICApO1xuICAgIGNvbnN0IGFjdGlvbiA9IGFjdGlvbkNyZWF0b3JzLmRpc21pc3NBY3Rpb25zRnJvbVF1ZXVlKCdOQVZJR0FURV9BV0FZJyk7XG5cbiAgICBleHBlY3QobmV0d29ya1JlZHVjZXIocHJldlN0YXRlLCBhY3Rpb24pKS50b0VxdWFsKFxuICAgICAgZ2V0U3RhdGUoZmFsc2UsIGFjdGlvbkVucXVldWVkMSwgYWN0aW9uRW5xdWV1ZWQyLCBhY3Rpb25FbnF1ZXVlZDMpLFxuICAgICk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCduZXR3b3JrU2VsZWN0b3InLCAoKSA9PiB7XG4gIGl0KCdyZXR1cm5zIHRoZSBjb3JyZWN0IHNoYXBlJywgKCkgPT4ge1xuICAgIGNvbnN0IHN0YXRlOiB7IG5ldHdvcms6IE5ldHdvcmtTdGF0ZSB9ID0ge1xuICAgICAgbmV0d29yazoge1xuICAgICAgICBpc0Nvbm5lY3RlZDogdHJ1ZSxcbiAgICAgICAgYWN0aW9uUXVldWU6IFt7IHR5cGU6ICdmb28nLCBwYXlsb2FkOiB7fSB9XSxcbiAgICAgICAgaXNRdWV1ZVBhdXNlZDogZmFsc2UsXG4gICAgICB9LFxuICAgIH07XG4gICAgZXhwZWN0KG5ldHdvcmtTZWxlY3RvcihzdGF0ZSkpLnRvRXF1YWwoe1xuICAgICAgaXNDb25uZWN0ZWQ6IHRydWUsXG4gICAgICBhY3Rpb25RdWV1ZTogW3sgdHlwZTogJ2ZvbycsIHBheWxvYWQ6IHt9IH1dLFxuICAgICAgaXNRdWV1ZVBhdXNlZDogZmFsc2UsXG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
import isEqual from 'lodash/isEqual';
import * as actionCreators from '../redux/actionCreators';
import createReducer, { initialState, networkSelector, } from '../redux/createReducer';
import getSimilarActionInQueue from '../utils/getSimilarActionInQueue';
var networkReducer = createReducer();
var getState = function (isConnected) {
    if (isConnected === void 0) { isConnected = false; }
    var actionQueue = [];
    for (var _i = 1; _i < arguments.length; _i++) {
        actionQueue[_i - 1] = arguments[_i];
    }
    return ({
        isConnected: isConnected,
        actionQueue: actionQueue,
        isQueuePaused: false,
    });
};
/** Actions used from now on to test different scenarios */
var prevActionToRetry1 = {
    type: 'FETCH_DATA_REQUEST',
    payload: {
        id: '1',
    },
    meta: {
        retry: true,
    },
};
var prevActionToRetry2 = {
    type: 'FETCH_OTHER_REQUEST',
    payload: {
        isFetching: true,
    },
    meta: {
        retry: true,
    },
};
var prevActionToRetry1WithDifferentPayload = {
    type: 'FETCH_DATA_REQUEST',
    payload: {
        id: '2',
    },
    meta: {
        retry: true,
    },
};
describe('unknown action type', function () {
    it('returns prevState on initialization', function () {
        expect(networkReducer(undefined, { type: 'ACTION_I_DONT_CARE' })).toEqual(initialState);
    });
    it('returns prevState if the action is not handled', function () {
        expect(networkReducer(initialState, { type: 'ANOTHER_ACTION_I_DONT_CARE' })).toEqual(initialState);
    });
});
describe('CONNECTION_CHANGE action type', function () {
    it('changes isConnected state properly', function () {
        var mockAction = actionCreators.connectionChange(false);
        expect(networkReducer(initialState, mockAction)).toEqual({
            isConnected: false,
            actionQueue: [],
            isQueuePaused: false,
        });
    });
});
describe('OFFLINE_ACTION action type', function () {
    describe('meta.retry !== true', function () {
        it('should NOT add the action to the queue', function () {
            var prevAction = {
                type: 'FETCH_DATA_REQUEST',
                payload: {
                    id: '1',
                },
            };
            var anotherPrevAction = {
                type: 'FETCH_DATA_REQUEST',
                payload: {
                    id: '1',
                },
                meta: {
                    retry: false,
                },
            };
            var action = actionCreators.fetchOfflineMode(prevAction);
            var anotherAction = actionCreators.fetchOfflineMode(anotherPrevAction);
            expect(networkReducer(initialState, action)).toEqual(initialState);
            expect(networkReducer(initialState, anotherAction)).toEqual(initialState);
        });
    });
    describe('meta.retry === true', function () {
        describe('actions with DIFFERENT type', function () {
            it('actions are pushed into the queue in order of arrival', function () {
                var preAction = actionCreators.connectionChange(false);
                var action1 = actionCreators.fetchOfflineMode(prevActionToRetry1);
                var prevState = networkReducer(initialState, preAction);
                var nextState = networkReducer(prevState, action1);
                expect(nextState).toEqual({
                    isConnected: false,
                    actionQueue: [prevActionToRetry1],
                    isQueuePaused: false,
                });
                var action2 = actionCreators.fetchOfflineMode(prevActionToRetry2);
                nextState = networkReducer(nextState, action2);
                expect(nextState).toEqual(getState(false, prevActionToRetry1, prevActionToRetry2));
            });
        });
        describe('thunks that are the same with custom comparison function', function () {
            function comparisonFn(action, actionQueue) {
                if (typeof action === 'object') {
                    return actionQueue.find(function (queued) { return isEqual(queued, action); });
                }
                if (typeof action === 'function') {
                    return actionQueue.find(function (queued) {
                        return action.meta.name === queued.meta.name &&
                            action.meta.args.id === queued.meta.args.id;
                    });
                }
                return undefined;
            }
            var thunkFactory = function (id, name, age) {
                function thunk(dispatch) {
                    dispatch({ type: 'UPDATE_DATA_REQUEST', payload: { id: id, name: name, age: age } });
                }
                thunk.meta = {
                    args: { id: id, name: name, age: age },
                    retry: true,
                };
                return thunk;
            };
            it("should add thunks if function is same but thunks are modifying different items", function () {
                var prevState = getState(false, thunkFactory(1, 'Bilbo', 55));
                var thunk = thunkFactory(2, 'Link', 54);
                var wrappedThunk = actionCreators.fetchOfflineMode(thunk);
                expect(getSimilarActionInQueue(thunk, prevState.actionQueue)).toEqual(prevState.actionQueue[0]);
                var nextState = createReducer(comparisonFn)(prevState, wrappedThunk);
                expect(nextState.actionQueue).toHaveLength(2);
            });
            it("should replace a thunk if thunk already exists to modify same item", function () {
                var prevState = getState(false, thunkFactory(1, 'Bilbo', 55));
                var thunk = thunkFactory(1, 'Bilbo', 65);
                var wrappedThunk = actionCreators.fetchOfflineMode(thunk);
                expect(getSimilarActionInQueue(thunk, prevState.actionQueue)).toEqual(prevState.actionQueue[0]);
                var nextState = createReducer(comparisonFn)(prevState, wrappedThunk);
                expect(nextState.actionQueue).toHaveLength(1);
            });
        });
        describe('actions with the same type', function () {
            it("should remove the action and add it back at the end of the queue\n   if the action has the same payload", function () {
                var prevState = getState(false, prevActionToRetry1, prevActionToRetry2);
                var action = actionCreators.fetchOfflineMode(prevActionToRetry1);
                var nextState = networkReducer(prevState, action);
                expect(nextState).toEqual(getState(false, prevActionToRetry2, prevActionToRetry1));
            });
            it("should push the action if the payload is different", function () {
                var prevState = getState(false, prevActionToRetry2, prevActionToRetry1);
                var action = actionCreators.fetchOfflineMode(prevActionToRetry1WithDifferentPayload);
                expect(networkReducer(prevState, action)).toEqual(getState(false, prevActionToRetry2, prevActionToRetry1, prevActionToRetry1WithDifferentPayload));
            });
        });
    });
});
describe('REMOVE_ACTION_FROM_QUEUE action type', function () {
    it('removes the action from the queue properly', function () {
        var prevState = getState(false, prevActionToRetry2, prevActionToRetry1, prevActionToRetry1WithDifferentPayload);
        // Different object references but same shape, checking that deep equal works correctly
        var action = actionCreators.removeActionFromQueue(__assign({}, prevActionToRetry2));
        expect(networkReducer(prevState, action)).toEqual(getState(false, prevActionToRetry1, prevActionToRetry1WithDifferentPayload));
    });
});
describe('QUEUE_SEMAPHORE_CHANGE action type', function () {
    it('Pauses the queue if semaphore is red', function () {
        expect(networkReducer(undefined, actionCreators.changeQueueSemaphore('RED'))).toEqual(__assign(__assign({}, initialState), { isQueuePaused: true }));
    });
    it('Resumes the queue if semaphore is green', function () {
        expect(networkReducer(undefined, actionCreators.changeQueueSemaphore('GREEN'))).toEqual(__assign(__assign({}, initialState), { isQueuePaused: false }));
    });
});
describe('thunks', function () {
    function fetchThunk(dispatch) {
        dispatch({ type: 'FETCH_DATA_REQUEST' });
    }
    describe('FETCH_OFFLINE_MODE action type', function () {
        describe('action with meta.retry !== true', function () {
            it('should NOT add the action to the queue', function () {
                var action = actionCreators.fetchOfflineMode(fetchThunk);
                expect(networkReducer(initialState, action)).toEqual(initialState);
            });
        });
        describe('action with meta.retry === true', function () {
            it('should add the action to the queue if the thunk is different', function () {
                var prevState = getState(false);
                // Property 'meta' does not exist on type '(dispatch: Dispatch<AnyAction>) => void'
                fetchThunk.meta = {
                    retry: true,
                };
                var action = actionCreators.fetchOfflineMode(fetchThunk);
                expect(networkReducer(prevState, action)).toEqual(getState(false, fetchThunk));
            });
            it("should remove the thunk and add it back at the end of the queue \n      if it presents the same shape", function () {
                var thunkFactory = function (param) {
                    function thunk1(dispatch) {
                        dispatch({ type: 'FETCH_DATA_REQUEST', payload: param });
                    }
                    return thunk1;
                };
                var thunk = thunkFactory('foo');
                var prevState = getState(false, thunk);
                var similarThunk = thunkFactory('bar');
                similarThunk.meta = {
                    retry: true,
                };
                var action = actionCreators.fetchOfflineMode(similarThunk);
                var nextState = networkReducer(prevState, action);
                expect(nextState).toEqual(getState(false, similarThunk));
            });
        });
    });
    describe('REMOVE_ACTION_FROM_QUEUE action type', function () {
        it('removes the thunk from the queue properly', function () {
            var prevState = getState(false, fetchThunk);
            var action = actionCreators.removeActionFromQueue(fetchThunk);
            expect(networkReducer(prevState, action)).toEqual(getState(false));
        });
    });
});
describe('dismiss feature', function () {
    var actionEnqueued1 = {
        type: 'FETCH_PAGE_REQUEST',
        payload: {
            id: '2',
        },
        meta: {
            retry: true,
            dismiss: ['NAVIGATE_BACK', 'NAVIGATE_TO_LOGIN'],
        },
    };
    var actionEnqueued2 = {
        type: 'FETCH_USER_REQUEST',
        payload: {
            id: '4',
        },
        meta: {
            retry: true,
            dismiss: ['NAVIGATE_TO_LOGIN'],
        },
    };
    var actionEnqueued3 = {
        type: 'FETCH_USER_REQUEST',
        payload: {
            id: '4',
        },
        meta: {
            retry: true,
        },
    };
    it('NAVIGATE_BACK dispatched, dismissing 1 action', function () {
        var prevState = getState(false, actionEnqueued1, actionEnqueued2, actionEnqueued3);
        var action = actionCreators.dismissActionsFromQueue('NAVIGATE_BACK');
        expect(networkReducer(prevState, action)).toEqual(getState(false, actionEnqueued2, actionEnqueued3));
    });
    it('NAVIGATE_TO_LOGIN dispatched, dismissing 2 actions', function () {
        var prevState = getState(false, actionEnqueued1, actionEnqueued2, actionEnqueued3);
        var action = actionCreators.dismissActionsFromQueue('NAVIGATE_TO_LOGIN');
        expect(networkReducer(prevState, action)).toEqual(getState(false, actionEnqueued3));
    });
    it("Any other action dispatched, no changes (although the middleware won't allow that)", function () {
        var prevState = getState(false, actionEnqueued1, actionEnqueued2, actionEnqueued3);
        var action = actionCreators.dismissActionsFromQueue('NAVIGATE_AWAY');
        expect(networkReducer(prevState, action)).toEqual(getState(false, actionEnqueued1, actionEnqueued2, actionEnqueued3));
    });
});
describe('networkSelector', function () {
    it('returns the correct shape', function () {
        var state = {
            network: {
                isConnected: true,
                actionQueue: [{ type: 'foo', payload: {} }],
                isQueuePaused: false,
            },
        };
        expect(networkSelector(state)).toEqual({
            isConnected: true,
            actionQueue: [{ type: 'foo', payload: {} }],
            isQueuePaused: false,
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0RldkFDL0Rlc2t0b3AvQW5nYXphL3JlYWN0LW9mZmxpbmUtc3luYy9zcmMvdGVzdC9yZWR1Y2VyLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFDQSxPQUFPLE9BQU8sTUFBTSxnQkFBZ0IsQ0FBQztBQUNyQyxPQUFPLEtBQUssY0FBYyxNQUFNLHlCQUF5QixDQUFDO0FBRTFELE9BQU8sYUFBYSxFQUFFLEVBQ3BCLFlBQVksRUFDWixlQUFlLEdBQ2hCLE1BQU0sd0JBQXdCLENBQUM7QUFDaEMsT0FBTyx1QkFBdUIsTUFBTSxrQ0FBa0MsQ0FBQztBQUV2RSxJQUFNLGNBQWMsR0FBRyxhQUFhLEVBQUUsQ0FBQztBQUV2QyxJQUFNLFFBQVEsR0FBRyxVQUFDLFdBQW1CO0lBQW5CLDRCQUFBLEVBQUEsbUJBQW1CO0lBQUUscUJBQWdDO1NBQWhDLFVBQWdDLEVBQWhDLHFCQUFnQyxFQUFoQyxJQUFnQztRQUFoQyxvQ0FBZ0M7O0lBQUssT0FBQSxDQUFDO1FBQzNFLFdBQVcsYUFBQTtRQUNYLFdBQVcsYUFBQTtRQUNYLGFBQWEsRUFBRSxLQUFLO0tBQ3JCLENBQUM7QUFKMEUsQ0FJMUUsQ0FBQztBQUVILDJEQUEyRDtBQUMzRCxJQUFNLGtCQUFrQixHQUFHO0lBQ3pCLElBQUksRUFBRSxvQkFBb0I7SUFDMUIsT0FBTyxFQUFFO1FBQ1AsRUFBRSxFQUFFLEdBQUc7S0FDUjtJQUNELElBQUksRUFBRTtRQUNKLEtBQUssRUFBRSxJQUFJO0tBQ1o7Q0FDRixDQUFDO0FBQ0YsSUFBTSxrQkFBa0IsR0FBRztJQUN6QixJQUFJLEVBQUUscUJBQXFCO0lBQzNCLE9BQU8sRUFBRTtRQUNQLFVBQVUsRUFBRSxJQUFJO0tBQ2pCO0lBQ0QsSUFBSSxFQUFFO1FBQ0osS0FBSyxFQUFFLElBQUk7S0FDWjtDQUNGLENBQUM7QUFDRixJQUFNLHNDQUFzQyxHQUFHO0lBQzdDLElBQUksRUFBRSxvQkFBb0I7SUFDMUIsT0FBTyxFQUFFO1FBQ1AsRUFBRSxFQUFFLEdBQUc7S0FDUjtJQUNE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QUUsQ0FBQyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLEVBQUUsRUFBRSxDQUFDO1lBQzNDLGFBQWEsRUFBRSxLQUFLO1NBQ3JCLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL0RldkFDL0Rlc2t0b3AvQW5nYXphL3JlYWN0LW9mZmxpbmUtc3luYy9zcmMvdGVzdC9yZWR1Y2VyLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGlzcGF0Y2ggfSBmcm9tICdyZWR1eCc7XG5pbXBvcnQgaXNFcXVhbCBmcm9tICdsb2Rhc2gvaXNFcXVhbCc7XG5pbXBvcnQgKiBhcyBhY3Rpb25DcmVhdG9ycyBmcm9tICcuLi9yZWR1eC9hY3Rpb25DcmVhdG9ycyc7XG5pbXBvcnQgeyBFbnF1ZXVlZEFjdGlvbiwgTmV0d29ya1N0YXRlIH0gZnJvbSAnLi4vdHlwZXMnO1xuaW1wb3J0IGNyZWF0ZVJlZHVjZXIsIHtcbiAgaW5pdGlhbFN0YXRlLFxuICBuZXR3b3JrU2VsZWN0b3IsXG59IGZyb20gJy4uL3JlZHV4L2NyZWF0ZVJlZHVjZXInO1xuaW1wb3J0IGdldFNpbWlsYXJBY3Rpb25JblF1ZXVlIGZyb20gJy4uL3V0aWxzL2dldFNpbWlsYXJBY3Rpb25JblF1ZXVlJztcblxuY29uc3QgbmV0d29ya1JlZHVjZXIgPSBjcmVhdGVSZWR1Y2VyKCk7XG5cbmNvbnN0IGdldFN0YXRlID0gKGlzQ29ubmVjdGVkID0gZmFsc2UsIC4uLmFjdGlvblF1ZXVlOiBFbnF1ZXVlZEFjdGlvbltdKSA9PiAoe1xuICBpc0Nvbm5lY3RlZCxcbiAgYWN0aW9uUXVldWUsXG4gIGlzUXVldWVQYXVzZWQ6IGZhbHNlLFxufSk7XG5cbi8qKiBBY3Rpb25zIHVzZWQgZnJvbSBub3cgb24gdG8gdGVzdCBkaWZmZXJlbnQgc2NlbmFyaW9zICovXG5jb25zdCBwcmV2QWN0aW9uVG9SZXRyeTEgPSB7XG4gIHR5cGU6ICdGRVRDSF9EQVRBX1JFUVVFU1QnLFxuICBwYXlsb2FkOiB7XG4gICAgaWQ6ICcxJyxcbiAgfSxcbiAgbWV0YToge1xuICAgIHJldHJ5OiB0cnVlLFxuICB9LFxufTtcbmNvbnN0IHByZXZBY3Rpb25Ub1JldHJ5MiA9IHtcbiAgdHlwZTogJ0ZFVENIX09USEVSX1JFUVVFU1QnLFxuICBwYXlsb2FkOiB7XG4gICAgaXNGZXRjaGluZzogdHJ1ZSxcbiAgfSxcbiAgbWV0YToge1xuICAgIHJldHJ5OiB0cnVlLFxuICB9LFxufTtcbmNvbnN0IHByZXZBY3Rpb25Ub1JldHJ5MVdpdGhEaWZmZXJlbnRQYXlsb2FkID0ge1xuICB0eXBlOiAnRkVUQ0hfREFUQV9SRVFVRVNUJyxcbiAgcGF5bG9hZDoge1xuICAgIGlkOiAnMicsXG4gIH0sXG4gIG1ldGE6IHtcbiAgICByZXRyeTogdHJ1ZSxcbiAgfSxcbn07XG5cbmRlc2NyaWJlKCd1bmtub3duIGFjdGlvbiB0eXBlJywgKCkgPT4ge1xuICBpdCgncmV0dXJucyBwcmV2U3RhdGUgb24gaW5pdGlhbGl6YXRpb24nLCAoKSA9PiB7XG4gICAgZXhwZWN0KG5ldHdvcmtSZWR1Y2VyKHVuZGVmaW5lZCwgeyB0eXBlOiAnQUNUSU9OX0lfRE9OVF9DQVJFJyB9KSkudG9FcXVhbChcbiAgICAgIGluaXRpYWxTdGF0ZSxcbiAgICApO1xuICB9KTtcblxuICBpdCgncmV0dXJucyBwcmV2U3RhdGUgaWYgdGhlIGFjdGlvbiBpcyBub3QgaGFuZGxlZCcsICgpID0+IHtcbiAgICBleHBlY3QoXG4gICAgICBuZXR3b3JrUmVkdWNlcihpbml0aWFsU3RhdGUsIHsgdHlwZTogJ0FOT1RIRVJfQUNUSU9OX0lfRE9OVF9DQVJFJyB9KSxcbiAgICApLnRvRXF1YWwoaW5pdGlhbFN0YXRlKTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ0NPTk5FQ1RJT05fQ0hBTkdFIGFjdGlvbiB0eXBlJywgKCkgPT4ge1xuICBpdCgnY2hhbmdlcyBpc0Nvbm5lY3RlZCBzdGF0ZSBwcm9wZXJseScsICgpID0+IHtcbiAgICBjb25zdCBtb2NrQWN0aW9uID0gYWN0aW9uQ3JlYXRvcnMuY29ubmVjdGlvbkNoYW5nZShmYWxzZSk7XG4gICAgZXhwZWN0KG5ldHdvcmtSZWR1Y2VyKGluaXRpYWxTdGF0ZSwgbW9ja0FjdGlvbikpLnRvRXF1YWwoe1xuICAgICAgaXNDb25uZWN0ZWQ6IGZhbHNlLFxuICAgICAgYWN0aW9uUXVldWU6IFtdLFxuICAgICAgaXNRdWV1ZVBhdXNlZDogZmFsc2UsXG4gICAgfSk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdPRkZMSU5FX0FDVElPTiBhY3Rpb24gdHlwZScsICgpID0+IHtcbiAgZGVzY3JpYmUoJ21ldGEucmV0cnkgIT09IHRydWUnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBOT1QgYWRkIHRoZSBhY3Rpb24gdG8gdGhlIHF1ZXVlJywgKCkgPT4ge1xuICAgICAgY29uc3QgcHJldkFjdGlvbiA9IHtcbiAgICAgICAgdHlwZTogJ0ZFVENIX0RBVEFfUkVRVUVTVCcsXG4gICAgICAgIHBheWxvYWQ6IHtcbiAgICAgICAgICBpZDogJzEnLFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICAgIGNvbnN0IGFub3RoZXJQcmV2QWN0aW9uID0ge1xuICAgICAgICB0eXBlOiAnRkVUQ0hfREFUQV9SRVFVRVNUJyxcbiAgICAgICAgcGF5bG9hZDoge1xuICAgICAgICAgIGlkOiAnMScsXG4gICAgICAgIH0sXG4gICAgICAgIG1ldGE6IHtcbiAgICAgICAgICByZXRyeTogZmFsc2UsXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBhY3Rpb24gPSBhY3Rpb25DcmVhdG9ycy5mZXRjaE9mZmxpbmVNb2RlKHByZXZBY3Rpb24pO1xuICAgICAgY29uc3QgYW5vdGhlckFjdGlvbiA9IGFjdGlvbkNyZWF0b3JzLmZldGNoT2ZmbGluZU1vZGUoYW5vdGhlclByZXZBY3Rpb24pO1xuXG4gICAgICBleHBlY3QobmV0d29ya1JlZHVjZXIoaW5pdGlhbFN0YXRlLCBhY3Rpb24pKS50b0VxdWFsKGluaXRpYWxTdGF0ZSk7XG4gICAgICBleHBlY3QobmV0d29ya1JlZHVjZXIoaW5pdGlhbFN0YXRlLCBhbm90aGVyQWN0aW9uKSkudG9FcXVhbChpbml0aWFsU3RhdGUpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnbWV0YS5yZXRyeSA9PT0gdHJ1ZScsICgpID0+IHtcbiAgICBkZXNjcmliZSgnYWN0aW9ucyB3aXRoIERJRkZFUkVOVCB0eXBlJywgKCkgPT4ge1xuICAgICAgaXQoJ2FjdGlvbnMgYXJlIHB1c2hlZCBpbnRvIHRoZSBxdWV1ZSBpbiBvcmRlciBvZiBhcnJpdmFsJywgKCkgPT4ge1xuICAgICAgICBjb25zdCBwcmVBY3Rpb24gPSBhY3Rpb25DcmVhdG9ycy5jb25uZWN0aW9uQ2hhbmdlKGZhbHNlKTtcbiAgICAgICAgY29uc3QgYWN0aW9uMSA9IGFjdGlvbkNyZWF0b3JzLmZldGNoT2ZmbGluZU1vZGUocHJldkFjdGlvblRvUmV0cnkxKTtcbiAgICAgICAgY29uc3QgcHJldlN0YXRlID0gbmV0d29ya1JlZHVjZXIoaW5pdGlhbFN0YXRlLCBwcmVBY3Rpb24pO1xuXG4gICAgICAgIGxldCBuZXh0U3RhdGUgPSBuZXR3b3JrUmVkdWNlcihwcmV2U3RhdGUsIGFjdGlvbjEpO1xuXG4gICAgICAgIGV4cGVjdChuZXh0U3RhdGUpLnRvRXF1YWwoe1xuICAgICAgICAgIGlzQ29ubmVjdGVkOiBmYWxzZSxcbiAgICAgICAgICBhY3Rpb25RdWV1ZTogW3ByZXZBY3Rpb25Ub1JldHJ5MV0sXG4gICAgICAgICAgaXNRdWV1ZVBhdXNlZDogZmFsc2UsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGFjdGlvbjIgPSBhY3Rpb25DcmVhdG9ycy5mZXRjaE9mZmxpbmVNb2RlKHByZXZBY3Rpb25Ub1JldHJ5Mik7XG4gICAgICAgIG5leHRTdGF0ZSA9IG5ldHdvcmtSZWR1Y2VyKG5leHRTdGF0ZSwgYWN0aW9uMik7XG5cbiAgICAgICAgZXhwZWN0KG5leHRTdGF0ZSkudG9FcXVhbChcbiAgICAgICAgICBnZXRTdGF0ZShmYWxzZSwgcHJldkFjdGlvblRvUmV0cnkxLCBwcmV2QWN0aW9uVG9SZXRyeTIpLFxuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgndGh1bmtzIHRoYXQgYXJlIHRoZSBzYW1lIHdpdGggY3VzdG9tIGNvbXBhcmlzb24gZnVuY3Rpb24nLCAoKSA9PiB7XG4gICAgICBmdW5jdGlvbiBjb21wYXJpc29uRm4oYWN0aW9uOiBhbnksIGFjdGlvblF1ZXVlOiBFbnF1ZXVlZEFjdGlvbltdKSB7XG4gICAgICAgIGlmICh0eXBlb2YgYWN0aW9uID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgIHJldHVybiBhY3Rpb25RdWV1ZS5maW5kKHF1ZXVlZCA9PiBpc0VxdWFsKHF1ZXVlZCwgYWN0aW9uKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiBhY3Rpb24gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICByZXR1cm4gYWN0aW9uUXVldWUuZmluZChcbiAgICAgICAgICAgIHF1ZXVlZCA9PlxuICAgICAgICAgICAgICBhY3Rpb24ubWV0YS5uYW1lID09PSBxdWV1ZWQubWV0YSEubmFtZSAmJlxuICAgICAgICAgICAgICBhY3Rpb24ubWV0YS5hcmdzLmlkID09PSBxdWV1ZWQubWV0YSEuYXJncy5pZCxcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHRodW5rRmFjdG9yeSA9IChpZDogbnVtYmVyLCBuYW1lOiBzdHJpbmcsIGFnZTogbnVtYmVyKSA9PiB7XG4gICAgICAgIGZ1bmN0aW9uIHRodW5rKGRpc3BhdGNoOiBEaXNwYXRjaCkge1xuICAgICAgICAgIGRpc3BhdGNoKHsgdHlwZTogJ1VQREFURV9EQVRBX1JFUVVFU1QnLCBwYXlsb2FkOiB7IGlkLCBuYW1lLCBhZ2UgfSB9KTtcbiAgICAgICAgfVxuICAgICAgICB0aHVuay5tZXRhID0ge1xuICAgICAgICAgIGFyZ3M6IHsgaWQsIG5hbWUsIGFnZSB9LFxuICAgICAgICAgIHJldHJ5OiB0cnVlLFxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gdGh1bms7XG4gICAgICB9O1xuXG4gICAgICBpdChgc2hvdWxkIGFkZCB0aHVua3MgaWYgZnVuY3Rpb24gaXMgc2FtZSBidXQgdGh1bmtzIGFyZSBtb2RpZnlpbmcgZGlmZmVyZW50IGl0ZW1zYCwgKCkgPT4ge1xuICAgICAgICBjb25zdCBwcmV2U3RhdGUgPSBnZXRTdGF0ZShmYWxzZSwgdGh1bmtGYWN0b3J5KDEsICdCaWxibycsIDU1KSk7XG4gICAgICAgIGNvbnN0IHRodW5rID0gdGh1bmtGYWN0b3J5KDIsICdMaW5rJywgNTQpO1xuICAgICAgICBjb25zdCB3cmFwcGVkVGh1bmsgPSBhY3Rpb25DcmVhdG9ycy5mZXRjaE9mZmxpbmVNb2RlKHRodW5rKTtcblxuICAgICAgICBleHBlY3QoZ2V0U2ltaWxhckFjdGlvbkluUXVldWUodGh1bmssIHByZXZTdGF0ZS5hY3Rpb25RdWV1ZSkpLnRvRXF1YWwoXG4gICAgICAgICAgcHJldlN0YXRlLmFjdGlvblF1ZXVlWzBdLFxuICAgICAgICApO1xuXG4gICAgICAgIGNvbnN0IG5leHRTdGF0ZSA9IGNyZWF0ZVJlZHVjZXIoY29tcGFyaXNvbkZuKShwcmV2U3RhdGUsIHdyYXBwZWRUaHVuayk7XG5cbiAgICAgICAgZXhwZWN0KG5leHRTdGF0ZS5hY3Rpb25RdWV1ZSkudG9IYXZlTGVuZ3RoKDIpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KGBzaG91bGQgcmVwbGFjZSBhIHRodW5rIGlmIHRodW5rIGFscmVhZHkgZXhpc3RzIHRvIG1vZGlmeSBzYW1lIGl0ZW1gLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHByZXZTdGF0ZSA9IGdldFN0YXRlKGZhbHNlLCB0aHVua0ZhY3RvcnkoMSwgJ0JpbGJvJywgNTUpKTtcbiAgICAgICAgY29uc3QgdGh1bmsgPSB0aHVua0ZhY3RvcnkoMSwgJ0JpbGJvJywgNjUpO1xuICAgICAgICBjb25zdCB3cmFwcGVkVGh1bmsgPSBhY3Rpb25DcmVhdG9ycy5mZXRjaE9mZmxpbmVNb2RlKHRodW5rKTtcblxuICAgICAgICBleHBlY3QoZ2V0U2ltaWxhckFjdGlvbkluUXVldWUodGh1bmssIHByZXZTdGF0ZS5hY3Rpb25RdWV1ZSkpLnRvRXF1YWwoXG4gICAgICAgICAgcHJldlN0YXRlLmFjdGlvblF1ZXVlWzBdLFxuICAgICAgICApO1xuXG4gICAgICAgIGNvbnN0IG5leHRTdGF0ZSA9IGNyZWF0ZVJlZHVjZXIoY29tcGFyaXNvbkZuKShwcmV2U3RhdGUsIHdyYXBwZWRUaHVuayk7XG5cbiAgICAgICAgZXhwZWN0KG5leHRTdGF0ZS5hY3Rpb25RdWV1ZSkudG9IYXZlTGVuZ3RoKDEpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnYWN0aW9ucyB3aXRoIHRoZSBzYW1lIHR5cGUnLCAoKSA9PiB7XG4gICAgICBpdChgc2hvdWxkIHJlbW92ZSB0aGUgYWN0aW9uIGFuZCBhZGQgaXQgYmFjayBhdCB0aGUgZW5kIG9mIHRoZSBxdWV1ZVxuICAgaWYgdGhlIGFjdGlvbiBoYXMgdGhlIHNhbWUgcGF5bG9hZGAsICgpID0+IHtcbiAgICAgICAgY29uc3QgcHJldlN0YXRlID0gZ2V0U3RhdGUoXG4gICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgcHJldkFjdGlvblRvUmV0cnkxLFxuICAgICAgICAgIHByZXZBY3Rpb25Ub1JldHJ5MixcbiAgICAgICAgKTtcbiAgICAgICAgY29uc3QgYWN0aW9uID0gYWN0aW9uQ3JlYXRvcnMuZmV0Y2hPZmZsaW5lTW9kZShwcmV2QWN0aW9uVG9SZXRyeTEpO1xuXG4gICAgICAgIGNvbnN0IG5leHRTdGF0ZSA9IG5ldHdvcmtSZWR1Y2VyKHByZXZTdGF0ZSwgYWN0aW9uKTtcbiAgICAgICAgZXhwZWN0KG5leHRTdGF0ZSkudG9FcXVhbChcbiAgICAgICAgICBnZXRTdGF0ZShmYWxzZSwgcHJldkFjdGlvblRvUmV0cnkyLCBwcmV2QWN0aW9uVG9SZXRyeTEpLFxuICAgICAgICApO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KGBzaG91bGQgcHVzaCB0aGUgYWN0aW9uIGlmIHRoZSBwYXlsb2FkIGlzIGRpZmZlcmVudGAsICgpID0+IHtcbiAgICAgICAgY29uc3QgcHJldlN0YXRlID0gZ2V0U3RhdGUoXG4gICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgcHJldkFjdGlvblRvUmV0cnkyLFxuICAgICAgICAgIHByZXZBY3Rpb25Ub1JldHJ5MSxcbiAgICAgICAgKTtcbiAgICAgICAgY29uc3QgYWN0aW9uID0gYWN0aW9uQ3JlYXRvcnMuZmV0Y2hPZmZsaW5lTW9kZShcbiAgICAgICAgICBwcmV2QWN0aW9uVG9SZXRyeTFXaXRoRGlmZmVyZW50UGF5bG9hZCxcbiAgICAgICAgKTtcblxuICAgICAgICBleHBlY3QobmV0d29ya1JlZHVjZXIocHJldlN0YXRlLCBhY3Rpb24pKS50b0VxdWFsKFxuICAgICAgICAgIGdldFN0YXRlKFxuICAgICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgICBwcmV2QWN0aW9uVG9SZXRyeTIsXG4gICAgICAgICAgICBwcmV2QWN0aW9uVG9SZXRyeTEsXG4gICAgICAgICAgICBwcmV2QWN0aW9uVG9SZXRyeTFXaXRoRGlmZmVyZW50UGF5bG9hZCxcbiAgICAgICAgICApLFxuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdSRU1PVkVfQUNUSU9OX0ZST01fUVVFVUUgYWN0aW9uIHR5cGUnLCAoKSA9PiB7XG4gIGl0KCdyZW1vdmVzIHRoZSBhY3Rpb24gZnJvbSB0aGUgcXVldWUgcHJvcGVybHknLCAoKSA9PiB7XG4gICAgY29uc3QgcHJldlN0YXRlID0gZ2V0U3RhdGUoXG4gICAgICBmYWxzZSxcbiAgICAgIHByZXZBY3Rpb25Ub1JldHJ5MixcbiAgICAgIHByZXZBY3Rpb25Ub1JldHJ5MSxcbiAgICAgIHByZXZBY3Rpb25Ub1JldHJ5MVdpdGhEaWZmZXJlbnRQYXlsb2FkLFxuICAgICk7XG4gICAgLy8gRGlmZmVyZW50IG9iamVjdCByZWZlcmVuY2VzIGJ1dCBzYW1lIHNoYXBlLCBjaGVja2luZyB0aGF0IGRlZXAgZXF1YWwgd29ya3MgY29ycmVjdGx5XG4gICAgY29uc3QgYWN0aW9uID0gYWN0aW9uQ3JlYXRvcnMucmVtb3ZlQWN0aW9uRnJvbVF1ZXVlKHtcbiAgICAgIC4uLnByZXZBY3Rpb25Ub1JldHJ5MixcbiAgICB9KTtcblxuICAgIGV4cGVjdChuZXR3b3JrUmVkdWNlcihwcmV2U3RhdGUsIGFjdGlvbikpLnRvRXF1YWwoXG4gICAgICBnZXRTdGF0ZShcbiAgICAgICAgZmFsc2UsXG4gICAgICAgIHByZXZBY3Rpb25Ub1JldHJ5MSxcbiAgICAgICAgcHJldkFjdGlvblRvUmV0cnkxV2l0aERpZmZlcmVudFBheWxvYWQsXG4gICAgICApLFxuICAgICk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdRVUVVRV9TRU1BUEhPUkVfQ0hBTkdFIGFjdGlvbiB0eXBlJywgKCkgPT4ge1xuICBpdCgnUGF1c2VzIHRoZSBxdWV1ZSBpZiBzZW1hcGhvcmUgaXMgcmVkJywgKCkgPT4ge1xuICAgIGV4cGVjdChcbiAgICAgIG5ldHdvcmtSZWR1Y2VyKHVuZGVmaW5lZCwgYWN0aW9uQ3JlYXRvcnMuY2hhbmdlUXVldWVTZW1hcGhvcmUoJ1JFRCcpKSxcbiAgICApLnRvRXF1YWwoe1xuICAgICAgLi4uaW5pdGlhbFN0YXRlLFxuICAgICAgaXNRdWV1ZVBhdXNlZDogdHJ1ZSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgaXQoJ1Jlc3VtZXMgdGhlIHF1ZXVlIGlmIHNlbWFwaG9yZSBpcyBncmVlbicsICgpID0+IHtcbiAgICBleHBlY3QoXG4gICAgICBuZXR3b3JrUmVkdWNlcih1bmRlZmluZWQsIGFjdGlvbkNyZWF0b3JzLmNoYW5nZVF1ZXVlU2VtYXBob3JlKCdHUkVFTicpKSxcbiAgICApLnRvRXF1YWwoe1xuICAgICAgLi4uaW5pdGlhbFN0YXRlLFxuICAgICAgaXNRdWV1ZVBhdXNlZDogZmFsc2UsXG4gICAgfSk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCd0aHVua3MnLCAoKSA9PiB7XG4gIGZ1bmN0aW9uIGZldGNoVGh1bmsoZGlzcGF0Y2g6IERpc3BhdGNoKSB7XG4gICAgZGlzcGF0Y2goeyB0eXBlOiAnRkVUQ0hfREFUQV9SRVFVRVNUJyB9KTtcbiAgfVxuXG4gIGRlc2NyaWJlKCdGRVRDSF9PRkZMSU5FX01PREUgYWN0aW9uIHR5cGUnLCAoKSA9PiB7XG4gICAgZGVzY3JpYmUoJ2FjdGlvbiB3aXRoIG1ldGEucmV0cnkgIT09IHRydWUnLCAoKSA9PiB7XG4gICAgICBpdCgnc2hvdWxkIE5PVCBhZGQgdGhlIGFjdGlvbiB0byB0aGUgcXVldWUnLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGFjdGlvbiA9IGFjdGlvbkNyZWF0b3JzLmZldGNoT2ZmbGluZU1vZGUoZmV0Y2hUaHVuayk7XG4gICAgICAgIGV4cGVjdChuZXR3b3JrUmVkdWNlcihpbml0aWFsU3RhdGUsIGFjdGlvbikpLnRvRXF1YWwoaW5pdGlhbFN0YXRlKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2FjdGlvbiB3aXRoIG1ldGEucmV0cnkgPT09IHRydWUnLCAoKSA9PiB7XG4gICAgICBpdCgnc2hvdWxkIGFkZCB0aGUgYWN0aW9uIHRvIHRoZSBxdWV1ZSBpZiB0aGUgdGh1bmsgaXMgZGlmZmVyZW50JywgKCkgPT4ge1xuICAgICAgICBjb25zdCBwcmV2U3RhdGUgPSBnZXRTdGF0ZShmYWxzZSk7XG5cbiAgICAgICAgLy8gUHJvcGVydHkgJ21ldGEnIGRvZXMgbm90IGV4aXN0IG9uIHR5cGUgJyhkaXNwYXRjaDogRGlzcGF0Y2g8QW55QWN0aW9uPikgPT4gdm9pZCdcbiAgICAgICAgKGZldGNoVGh1bmsgYXMgYW55KS5tZXRhID0ge1xuICAgICAgICAgIHJldHJ5OiB0cnVlLFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBhY3Rpb24gPSBhY3Rpb25DcmVhdG9ycy5mZXRjaE9mZmxpbmVNb2RlKGZldGNoVGh1bmspO1xuXG4gICAgICAgIGV4cGVjdChuZXR3b3JrUmVkdWNlcihwcmV2U3RhdGUsIGFjdGlvbikpLnRvRXF1YWwoXG4gICAgICAgICAgZ2V0U3RhdGUoZmFsc2UsIGZldGNoVGh1bmspLFxuICAgICAgICApO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KGBzaG91bGQgcmVtb3ZlIHRoZSB0aHVuayBhbmQgYWRkIGl0IGJhY2sgYXQgdGhlIGVuZCBvZiB0aGUgcXVldWUgXG4gICAgICBpZiBpdCBwcmVzZW50cyB0aGUgc2FtZSBzaGFwZWAsICgpID0+IHtcbiAgICAgICAgY29uc3QgdGh1bmtGYWN0b3J5ID0gKHBhcmFtOiBhbnkpID0+IHtcbiAgICAgICAgICBmdW5jdGlvbiB0aHVuazEoZGlzcGF0Y2g6IERpc3BhdGNoKSB7XG4gICAgICAgICAgICBkaXNwYXRjaCh7IHR5cGU6ICdGRVRDSF9EQVRBX1JFUVVFU1QnLCBwYXlsb2FkOiBwYXJhbSB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHRodW5rMTtcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgdGh1bmsgPSB0aHVua0ZhY3RvcnkoJ2ZvbycpO1xuICAgICAgICBjb25zdCBwcmV2U3RhdGUgPSBnZXRTdGF0ZShmYWxzZSwgdGh1bmspO1xuXG4gICAgICAgIGNvbnN0IHNpbWlsYXJUaHVuayA9IHRodW5rRmFjdG9yeSgnYmFyJyk7XG4gICAgICAgIChzaW1pbGFyVGh1bmsgYXMgYW55KS5tZXRhID0ge1xuICAgICAgICAgIHJldHJ5OiB0cnVlLFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBhY3Rpb24gPSBhY3Rpb25DcmVhdG9ycy5mZXRjaE9mZmxpbmVNb2RlKHNpbWlsYXJUaHVuayk7XG4gICAgICAgIGNvbnN0IG5leHRTdGF0ZSA9IG5ldHdvcmtSZWR1Y2VyKHByZXZTdGF0ZSwgYWN0aW9uKTtcblxuICAgICAgICBleHBlY3QobmV4dFN0YXRlKS50b0VxdWFsKGdldFN0YXRlKGZhbHNlLCBzaW1pbGFyVGh1bmspKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUkVNT1ZFX0FDVElPTl9GUk9NX1FVRVVFIGFjdGlvbiB0eXBlJywgKCkgPT4ge1xuICAgIGl0KCdyZW1vdmVzIHRoZSB0aHVuayBmcm9tIHRoZSBxdWV1ZSBwcm9wZXJseScsICgpID0+IHtcbiAgICAgIGNvbnN0IHByZXZTdGF0ZSA9IGdldFN0YXRlKGZhbHNlLCBmZXRjaFRodW5rKTtcbiAgICAgIGNvbnN0IGFjdGlvbiA9IGFjdGlvbkNyZWF0b3JzLnJlbW92ZUFjdGlvbkZyb21RdWV1ZShmZXRjaFRodW5rKTtcblxuICAgICAgZXhwZWN0KG5ldHdvcmtSZWR1Y2VyKHByZXZTdGF0ZSwgYWN0aW9uKSkudG9FcXVhbChnZXRTdGF0ZShmYWxzZSkpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuXG5kZXNjcmliZSgnZGlzbWlzcyBmZWF0dXJlJywgKCkgPT4ge1xuICBjb25zdCBhY3Rpb25FbnF1ZXVlZDEgPSB7XG4gICAgdHlwZTogJ0ZFVENIX1BBR0VfUkVRVUVTVCcsXG4gICAgcGF5bG9hZDoge1xuICAgICAgaWQ6ICcyJyxcbiAgICB9LFxuICAgIG1ldGE6IHtcbiAgICAgIHJldHJ5OiB0cnVlLFxuICAgICAgZGlzbWlzczogWydOQVZJR0FURV9CQUNLJywgJ05BVklHQVRFX1RPX0xPR0lOJ10sXG4gICAgfSxcbiAgfTtcbiAgY29uc3QgYWN0aW9uRW5xdWV1ZWQyID0ge1xuICAgIHR5cGU6ICdGRVRDSF9VU0VSX1JFUVVFU1QnLFxuICAgIHBheWxvYWQ6IHtcbiAgICAgIGlkOiAnNCcsXG4gICAgfSxcbiAgICBtZXRhOiB7XG4gICAgICByZXRyeTogdHJ1ZSxcbiAgICAgIGRpc21pc3M6IFsnTkFWSUdBVEVfVE9fTE9HSU4nXSxcbiAgICB9LFxuICB9O1xuICBjb25zdCBhY3Rpb25FbnF1ZXVlZDMgPSB7XG4gICAgdHlwZTogJ0ZFVENIX1VTRVJfUkVRVUVTVCcsXG4gICAgcGF5bG9hZDoge1xuICAgICAgaWQ6ICc0JyxcbiAgICB9LFxuICAgIG1ldGE6IHtcbiAgICAgIHJldHJ5OiB0cnVlLFxuICAgIH0sXG4gIH07XG5cbiAgaXQoJ05BVklHQVRFX0JBQ0sgZGlzcGF0Y2hlZCwgZGlzbWlzc2luZyAxIGFjdGlvbicsICgpID0+IHtcbiAgICBjb25zdCBwcmV2U3RhdGUgPSBnZXRTdGF0ZShcbiAgICAgIGZhbHNlLFxuICAgICAgYWN0aW9uRW5xdWV1ZWQxLFxuICAgICAgYWN0aW9uRW5xdWV1ZWQyLFxuICAgICAgYWN0aW9uRW5xdWV1ZWQzLFxuICAgICk7XG4gICAgY29uc3QgYWN0aW9uID0gYWN0aW9uQ3JlYXRvcnMuZGlzbWlzc0FjdGlvbnNGcm9tUXVldWUoJ05BVklHQVRFX0JBQ0snKTtcblxuICAgIGV4cGVjdChuZXR3b3JrUmVkdWNlcihwcmV2U3RhdGUsIGFjdGlvbikpLnRvRXF1YWwoXG4gICAgICBnZXRTdGF0ZShmYWxzZSwgYWN0aW9uRW5xdWV1ZWQyLCBhY3Rpb25FbnF1ZXVlZDMpLFxuICAgICk7XG4gIH0pO1xuXG4gIGl0KCdOQVZJR0FURV9UT19MT0dJTiBkaXNwYXRjaGVkLCBkaXNtaXNzaW5nIDIgYWN0aW9ucycsICgpID0+IHtcbiAgICBjb25zdCBwcmV2U3RhdGUgPSBnZXRTdGF0ZShcbiAgICAgIGZhbHNlLFxuICAgICAgYWN0aW9uRW5xdWV1ZWQxLFxuICAgICAgYWN0aW9uRW5xdWV1ZWQyLFxuICAgICAgYWN0aW9uRW5xdWV1ZWQzLFxuICAgICk7XG4gICAgY29uc3QgYWN0aW9uID0gYWN0aW9uQ3JlYXRvcnMuZGlzbWlzc0FjdGlvbnNGcm9tUXVldWUoJ05BVklHQVRFX1RPX0xPR0lOJyk7XG5cbiAgICBleHBlY3QobmV0d29ya1JlZHVjZXIocHJldlN0YXRlLCBhY3Rpb24pKS50b0VxdWFsKFxuICAgICAgZ2V0U3RhdGUoZmFsc2UsIGFjdGlvbkVucXVldWVkMyksXG4gICAgKTtcbiAgfSk7XG5cbiAgaXQoXCJBbnkgb3RoZXIgYWN0aW9uIGRpc3BhdGNoZWQsIG5vIGNoYW5nZXMgKGFsdGhvdWdoIHRoZSBtaWRkbGV3YXJlIHdvbid0IGFsbG93IHRoYXQpXCIsICgpID0+IHtcbiAgICBjb25zdCBwcmV2U3RhdGUgPSBnZXRTdGF0ZShcbiAgICAgIGZhbHNlLFxuICAgICAgYWN0aW9uRW5xdWV1ZWQxLFxuICAgICAgYWN0aW9uRW5xdWV1ZWQyLFxuICAgICAgYWN0aW9uRW5xdWV1ZWQzLFxuICAgICk7XG4gICAgY29uc3QgYWN0aW9uID0gYWN0aW9uQ3JlYXRvcnMuZGlzbWlzc0FjdGlvbnNGcm9tUXVldWUoJ05BVklHQVRFX0FXQVknKTtcblxuICAgIGV4cGVjdChuZXR3b3JrUmVkdWNlcihwcmV2U3RhdGUsIGFjdGlvbikpLnRvRXF1YWwoXG4gICAgICBnZXRTdGF0ZShmYWxzZSwgYWN0aW9uRW5xdWV1ZWQxLCBhY3Rpb25FbnF1ZXVlZDIsIGFjdGlvbkVucXVldWVkMyksXG4gICAgKTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ25ldHdvcmtTZWxlY3RvcicsICgpID0+IHtcbiAgaXQoJ3JldHVybnMgdGhlIGNvcnJlY3Qgc2hhcGUnLCAoKSA9PiB7XG4gICAgY29uc3Qgc3RhdGU6IHsgbmV0d29yazogTmV0d29ya1N0YXRlIH0gPSB7XG4gICAgICBuZXR3b3JrOiB7XG4gICAgICAgIGlzQ29ubmVjdGVkOiB0cnVlLFxuICAgICAgICBhY3Rpb25RdWV1ZTogW3sgdHlwZTogJ2ZvbycsIHBheWxvYWQ6IHt9IH1dLFxuICAgICAgICBpc1F1ZXVlUGF1c2VkOiBmYWxzZSxcbiAgICAgIH0sXG4gICAgfTtcbiAgICBleHBlY3QobmV0d29ya1NlbGVjdG9yKHN0YXRlKSkudG9FcXVhbCh7XG4gICAgICBpc0Nvbm5lY3RlZDogdHJ1ZSxcbiAgICAgIGFjdGlvblF1ZXVlOiBbeyB0eXBlOiAnZm9vJywgcGF5bG9hZDoge30gfV0sXG4gICAgICBpc1F1ZXVlUGF1c2VkOiBmYWxzZSxcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==
15feb4961b2b730f1ea7f2b32041ed37
var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _isEqual = _interopRequireDefault(require("lodash/isEqual"));

var actionCreators = _interopRequireWildcard(require("../redux/actionCreators"));

var _createReducer = _interopRequireWildcard(require("../redux/createReducer"));

var _getSimilarActionInQueue = _interopRequireDefault(require("../utils/getSimilarActionInQueue"));

var __assign = this && this.__assign || function () {
  __assign = Object.assign || function (t) {
    for (var s, i = 1, n = arguments.length; i < n; i++) {
      s = arguments[i];

      for (var p in s) {
        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];
      }
    }

    return t;
  };

  return __assign.apply(this, arguments);
};

var networkReducer = (0, _createReducer.default)();

var getState = function getState(isConnected) {
  if (isConnected === void 0) {
    isConnected = false;
  }

  var actionQueue = [];

  for (var _i = 1; _i < arguments.length; _i++) {
    actionQueue[_i - 1] = arguments[_i];
  }

  return {
    isConnected: isConnected,
    actionQueue: actionQueue,
    isQueuePaused: false
  };
};

var prevActionToRetry1 = {
  type: 'FETCH_DATA_REQUEST',
  payload: {
    id: '1'
  },
  meta: {
    retry: true
  }
};
var prevActionToRetry2 = {
  type: 'FETCH_OTHER_REQUEST',
  payload: {
    isFetching: true
  },
  meta: {
    retry: true
  }
};
var prevActionToRetry1WithDifferentPayload = {
  type: 'FETCH_DATA_REQUEST',
  payload: {
    id: '2'
  },
  meta: {
    retry: true
  }
};
describe('unknown action type', function () {
  it('returns prevState on initialization', function () {
    expect(networkReducer(undefined, {
      type: 'ACTION_I_DONT_CARE'
    })).toEqual(_createReducer.initialState);
  });
  it('returns prevState if the action is not handled', function () {
    expect(networkReducer(_createReducer.initialState, {
      type: 'ANOTHER_ACTION_I_DONT_CARE'
    })).toEqual(_createReducer.initialState);
  });
});
describe('CONNECTION_CHANGE action type', function () {
  it('changes isConnected state properly', function () {
    var mockAction = actionCreators.connectionChange(false);
    expect(networkReducer(_createReducer.initialState, mockAction)).toEqual({
      isConnected: false,
      actionQueue: [],
      isQueuePaused: false
    });
  });
});
describe('OFFLINE_ACTION action type', function () {
  describe('meta.retry !== true', function () {
    it('should NOT add the action to the queue', function () {
      var prevAction = {
        type: 'FETCH_DATA_REQUEST',
        payload: {
          id: '1'
        }
      };
      var anotherPrevAction = {
        type: 'FETCH_DATA_REQUEST',
        payload: {
          id: '1'
        },
        meta: {
          retry: false
        }
      };
      var action = actionCreators.fetchOfflineMode(prevAction);
      var anotherAction = actionCreators.fetchOfflineMode(anotherPrevAction);
      expect(networkReducer(_createReducer.initialState, action)).toEqual(_createReducer.initialState);
      expect(networkReducer(_createReducer.initialState, anotherAction)).toEqual(_createReducer.initialState);
    });
  });
  describe('meta.retry === true', function () {
    describe('actions with DIFFERENT type', function () {
      it('actions are pushed into the queue in order of arrival', function () {
        var preAction = actionCreators.connectionChange(false);
        var action1 = actionCreators.fetchOfflineMode(prevActionToRetry1);
        var prevState = networkReducer(_createReducer.initialState, preAction);
        var nextState = networkReducer(prevState, action1);
        expect(nextState).toEqual({
          isConnected: false,
          actionQueue: [prevActionToRetry1],
          isQueuePaused: false
        });
        var action2 = actionCreators.fetchOfflineMode(prevActionToRetry2);
        nextState = networkReducer(nextState, action2);
        expect(nextState).toEqual(getState(false, prevActionToRetry1, prevActionToRetry2));
      });
    });
    describe('thunks that are the same with custom comparison function', function () {
      function comparisonFn(action, actionQueue) {
        if (typeof action === 'object') {
          return actionQueue.find(function (queued) {
            return (0, _isEqual.default)(queued, action);
          });
        }

        if (typeof action === 'function') {
          return actionQueue.find(function (queued) {
            return action.meta.name === queued.meta.name && action.meta.args.id === queued.meta.args.id;
          });
        }

        return undefined;
      }

      var thunkFactory = function thunkFactory(id, name, age) {
        function thunk(dispatch) {
          dispatch({
            type: 'UPDATE_DATA_REQUEST',
            payload: {
              id: id,
              name: name,
              age: age
            }
          });
        }

        thunk.meta = {
          args: {
            id: id,
            name: name,
            age: age
          },
          retry: true
        };
        return thunk;
      };

      it("should add thunks if function is same but thunks are modifying different items", function () {
        var prevState = getState(false, thunkFactory(1, 'Bilbo', 55));
        var thunk = thunkFactory(2, 'Link', 54);
        var wrappedThunk = actionCreators.fetchOfflineMode(thunk);
        expect((0, _getSimilarActionInQueue.default)(thunk, prevState.actionQueue)).toEqual(prevState.actionQueue[0]);
        var nextState = (0, _createReducer.default)(comparisonFn)(prevState, wrappedThunk);
        expect(nextState.actionQueue).toHaveLength(2);
      });
      it("should replace a thunk if thunk already exists to modify same item", function () {
        var prevState = getState(false, thunkFactory(1, 'Bilbo', 55));
        var thunk = thunkFactory(1, 'Bilbo', 65);
        var wrappedThunk = actionCreators.fetchOfflineMode(thunk);
        expect((0, _getSimilarActionInQueue.default)(thunk, prevState.actionQueue)).toEqual(prevState.actionQueue[0]);
        var nextState = (0, _createReducer.default)(comparisonFn)(prevState, wrappedThunk);
        expect(nextState.actionQueue).toHaveLength(1);
      });
    });
    describe('actions with the same type', function () {
      it("should remove the action and add it back at the end of the queue\n   if the action has the same payload", function () {
        var prevState = getState(false, prevActionToRetry1, prevActionToRetry2);
        var action = actionCreators.fetchOfflineMode(prevActionToRetry1);
        var nextState = networkReducer(prevState, action);
        expect(nextState).toEqual(getState(false, prevActionToRetry2, prevActionToRetry1));
      });
      it("should push the action if the payload is different", function () {
        var prevState = getState(false, prevActionToRetry2, prevActionToRetry1);
        var action = actionCreators.fetchOfflineMode(prevActionToRetry1WithDifferentPayload);
        expect(networkReducer(prevState, action)).toEqual(getState(false, prevActionToRetry2, prevActionToRetry1, prevActionToRetry1WithDifferentPayload));
      });
    });
  });
});
describe('REMOVE_ACTION_FROM_QUEUE action type', function () {
  it('removes the action from the queue properly', function () {
    var prevState = getState(false, prevActionToRetry2, prevActionToRetry1, prevActionToRetry1WithDifferentPayload);
    var action = actionCreators.removeActionFromQueue(__assign({}, prevActionToRetry2));
    expect(networkReducer(prevState, action)).toEqual(getState(false, prevActionToRetry1, prevActionToRetry1WithDifferentPayload));
  });
});
describe('QUEUE_SEMAPHORE_CHANGE action type', function () {
  it('Pauses the queue if semaphore is red', function () {
    expect(networkReducer(undefined, actionCreators.changeQueueSemaphore('RED'))).toEqual(__assign(__assign({}, _createReducer.initialState), {
      isQueuePaused: true
    }));
  });
  it('Resumes the queue if semaphore is green', function () {
    expect(networkReducer(undefined, actionCreators.changeQueueSemaphore('GREEN'))).toEqual(__assign(__assign({}, _createReducer.initialState), {
      isQueuePaused: false
    }));
  });
});
describe('thunks', function () {
  function fetchThunk(dispatch) {
    dispatch({
      type: 'FETCH_DATA_REQUEST'
    });
  }

  describe('FETCH_OFFLINE_MODE action type', function () {
    describe('action with meta.retry !== true', function () {
      it('should NOT add the action to the queue', function () {
        var action = actionCreators.fetchOfflineMode(fetchThunk);
        expect(networkReducer(_createReducer.initialState, action)).toEqual(_createReducer.initialState);
      });
    });
    describe('action with meta.retry === true', function () {
      it('should add the action to the queue if the thunk is different', function () {
        var prevState = getState(false);
        fetchThunk.meta = {
          retry: true
        };
        var action = actionCreators.fetchOfflineMode(fetchThunk);
        expect(networkReducer(prevState, action)).toEqual(getState(false, fetchThunk));
      });
      it("should remove the thunk and add it back at the end of the queue \n      if it presents the same shape", function () {
        var thunkFactory = function thunkFactory(param) {
          function thunk1(dispatch) {
            dispatch({
              type: 'FETCH_DATA_REQUEST',
              payload: param
            });
          }

          return thunk1;
        };

        var thunk = thunkFactory('foo');
        var prevState = getState(false, thunk);
        var similarThunk = thunkFactory('bar');
        similarThunk.meta = {
          retry: true
        };
        var action = actionCreators.fetchOfflineMode(similarThunk);
        var nextState = networkReducer(prevState, action);
        expect(nextState).toEqual(getState(false, similarThunk));
      });
    });
  });
  describe('REMOVE_ACTION_FROM_QUEUE action type', function () {
    it('removes the thunk from the queue properly', function () {
      var prevState = getState(false, fetchThunk);
      var action = actionCreators.removeActionFromQueue(fetchThunk);
      expect(networkReducer(prevState, action)).toEqual(getState(false));
    });
  });
});
describe('dismiss feature', function () {
  var actionEnqueued1 = {
    type: 'FETCH_PAGE_REQUEST',
    payload: {
      id: '2'
    },
    meta: {
      retry: true,
      dismiss: ['NAVIGATE_BACK', 'NAVIGATE_TO_LOGIN']
    }
  };
  var actionEnqueued2 = {
    type: 'FETCH_USER_REQUEST',
    payload: {
      id: '4'
    },
    meta: {
      retry: true,
      dismiss: ['NAVIGATE_TO_LOGIN']
    }
  };
  var actionEnqueued3 = {
    type: 'FETCH_USER_REQUEST',
    payload: {
      id: '4'
    },
    meta: {
      retry: true
    }
  };
  it('NAVIGATE_BACK dispatched, dismissing 1 action', function () {
    var prevState = getState(false, actionEnqueued1, actionEnqueued2, actionEnqueued3);
    var action = actionCreators.dismissActionsFromQueue('NAVIGATE_BACK');
    expect(networkReducer(prevState, action)).toEqual(getState(false, actionEnqueued2, actionEnqueued3));
  });
  it('NAVIGATE_TO_LOGIN dispatched, dismissing 2 actions', function () {
    var prevState = getState(false, actionEnqueued1, actionEnqueued2, actionEnqueued3);
    var action = actionCreators.dismissActionsFromQueue('NAVIGATE_TO_LOGIN');
    expect(networkReducer(prevState, action)).toEqual(getState(false, actionEnqueued3));
  });
  it("Any other action dispatched, no changes (although the middleware won't allow that)", function () {
    var prevState = getState(false, actionEnqueued1, actionEnqueued2, actionEnqueued3);
    var action = actionCreators.dismissActionsFromQueue('NAVIGATE_AWAY');
    expect(networkReducer(prevState, action)).toEqual(getState(false, actionEnqueued1, actionEnqueued2, actionEnqueued3));
  });
});
describe('networkSelector', function () {
  it('returns the correct shape', function () {
    var state = {
      network: {
        isConnected: true,
        actionQueue: [{
          type: 'foo',
          payload: {}
        }],
        isQueuePaused: false
      }
    };
    expect((0, _createReducer.networkSelector)(state)).toEqual({
      isConnected: true,
      actionQueue: [{
        type: 'foo',
        payload: {}
      }],
      isQueuePaused: false
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9EZXZBQy9EZXNrdG9wL0FuZ2F6YS9yZWFjdC1vZmZsaW5lLXN5bmMvc3JjL3Rlc3QvcmVkdWNlci50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFDQTs7QUFDQTs7QUFFQTs7QUFJQTs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRUEsSUFBTSxjQUFjLEdBQUcsNkJBQXZCOztBQUVBLElBQU0sUUFBUSxHQUFHLFNBQVgsUUFBVyxDQUFDLFdBQUQsRUFBb0I7QUFBbkIsTUFBQSxXQUFBLEtBQUEsS0FBQSxDQUFBLEVBQUE7QUFBQSxJQUFBLFdBQUEsR0FBQSxLQUFBO0FBQW1COztBQUFFLE1BQUEsV0FBQSxHQUFBLEVBQUE7O09BQUEsSUFBQSxFQUFBLEdBQUEsQyxFQUFBLEVBQUEsR0FBQSxTQUFBLENBQUEsTSxFQUFBLEVBQUEsRSxFQUFnQztBQUFoQyxJQUFBLFdBQUEsQ0FBQSxFQUFBLEdBQUEsQ0FBQSxDQUFBLEdBQUEsU0FBQSxDQUFBLEVBQUEsQ0FBQTs7O0FBQXFDLFNBQUM7QUFDM0UsSUFBQSxXQUFXLEVBQUEsV0FEZ0U7QUFFM0UsSUFBQSxXQUFXLEVBQUEsV0FGZ0U7QUFHM0UsSUFBQSxhQUFhLEVBQUU7QUFINEQsR0FBRDtBQUkxRSxDQUpGOztBQU9BLElBQU0sa0JBQWtCLEdBQUc7QUFDekIsRUFBQSxJQUFJLEVBQUUsb0JBRG1CO0FBRXpCLEVBQUEsT0FBTyxFQUFFO0FBQ1AsSUFBQSxFQUFFLEVBQUU7QUFERyxHQUZnQjtBQUt6QixFQUFBLElBQUksRUFBRTtBQUNKLElBQUEsS0FBSyxFQUFFO0FBREg7QUFMbUIsQ0FBM0I7QUFTQSxJQUFNLGtCQUFrQixHQUFHO0FBQ3pCLEVBQUEsSUFBSSxFQUFFLHFCQURtQjtBQUV6QixFQUFBLE9BQU8sRUFBRTtBQUNQLElBQUEsVUFBVSxFQUFFO0FBREwsR0FGZ0I7QUFLekIsRUFBQSxJQUFJLEVBQUU7QUFDSixJQUFBLEtBQUssRUFBRTtBQURIO0FBTG1CLENBQTNCO0FBU0EsSUFBTSxzQ0FBc0MsR0FBRztBQUM3QyxFQUFBLElBQUksRUFBRSxvQkFEdUM7QUFFN0MsRUFBQSxPQUFPLEVBQUU7QUFDUCxJQUFBLEVBQUUsRUFBRTtBQURHLEdBRm9DO0FBSzdDLEVBQUEsSUFBSSxFQUFFO0FBQ0osSUFBQSxLQUFLLEVBQUU7QUFESDtBQUx1QyxDQUEvQztBQVVBLFFBQVEsQ0FBQyxxQkFBRCxFQUF3QixZQUFBO0FBQzlCLEVBQUEsRUFBRSxDQUFDLHFDQUFELEVBQXdDLFlBQUE7QUFDeEMsSUFBQSxNQUFNLENBQUMsY0FBYyxDQUFDLFNBQUQsRUFBWTtBQUFFLE1BQUEsSUFBSSxFQUFFO0FBQVIsS0FBWixDQUFmLENBQU4sQ0FBa0UsT0FBbEUsQ0FDRSwyQkFERjtBQUdELEdBSkMsQ0FBRjtBQU1BLEVBQUEsRUFBRSxDQUFDLGdEQUFELEVBQW1ELFlBQUE7QUFDbkQsSUFBQSxNQUFNLENBQ0osY0FBYyxDQUFDLDJCQUFELEVBQWU7QUFBRSxNQUFBLElBQUksRUFBRTtBQUFSLEtBQWYsQ0FEVixDQUFOLENBRUUsT0FGRixDQUVVLDJCQUZWO0FBR0QsR0FKQyxDQUFGO0FBS0QsQ0FaTyxDQUFSO0FBY0EsUUFBUSxDQUFDLCtCQUFELEVBQWtDLFlBQUE7QUFDeEMsRUFBQSxFQUFFLENBQUMsb0NBQUQsRUFBdUMsWUFBQTtBQUN2QyxRQUFNLFVBQVUsR0FBRyxjQUFjLENBQUMsZ0JBQWYsQ0FBZ0MsS0FBaEMsQ0FBbkI7QUFDQSxJQUFBLE1BQU0sQ0FBQyxjQUFjLENBQUMsMkJBQUQsRUFBZSxVQUFmLENBQWYsQ0FBTixDQUFpRCxPQUFqRCxDQUF5RDtBQUN2RCxNQUFBLFdBQVcsRUFBRSxLQUQwQztBQUV2RCxNQUFBLFdBQVcsRUFBRSxFQUYwQztBQUd2RCxNQUFBLGFBQWEsRUFBRTtBQUh3QyxLQUF6RDtBQUtELEdBUEMsQ0FBRjtBQVFELENBVE8sQ0FBUjtBQVdBLFFBQVEsQ0FBQyw0QkFBRCxFQUErQixZQUFBO0FBQ3JDLEVBQUEsUUFBUSxDQUFDLHFCQUFELEVBQXdCLFlBQUE7QUFDOUIsSUFBQSxFQUFFLENBQUMsd0NBQUQsRUFBMkMsWUFBQTtBQUMzQyxVQUFNLFVBQVUsR0FBRztBQUNqQixRQUFBLElBQUksRUFBRSxvQkFEVztBQUVqQixRQUFBLE9BQU8sRUFBRTtBQUNQLFVBQUEsRUFBRSxFQUFFO0FBREc7QUFGUSxPQUFuQjtBQU1BLFVBQU0saUJBQWlCLEdBQUc7QUFDeEIsUUFBQSxJQUFJLEVBQUUsb0JBRGtCO0FBRXhCLFFBQUEsT0FBTyxFQUFFO0FBQ1AsVUFBQSxFQUFFLEVBQUU7QUFERyxTQUZlO0FBS3hCLFFBQUEsSUFBSSxFQUFFO0FBQ0osVUFBQSxLQUFLLEVBQUU7QUFESDtBQUxrQixPQUExQjtBQVVBLFVBQU0sTUFBTSxHQUFHLGNBQWMsQ0FBQyxnQkFBZixDQUFnQyxVQUFoQyxDQUFmO0FBQ0EsVUFBTSxhQUFhLEdBQUcsY0FBYyxDQUFDLGdCQUFmLENBQWdDLGlCQUFoQyxDQUF0QjtBQUVBLE1BQUEsTUFBTSxDQUFDLGNBQWMsQ0FBQywyQkFBRCxFQUFlLE1BQWYsQ0FBZixDQUFOLENBQTZDLE9BQTdDLENBQXFELDJCQUFyRDtBQUNBLE1BQUEsTUFBTSxDQUFDLGNBQWMsQ0FBQywyQkFBRCxFQUFlLGFBQWYsQ0FBZixDQUFOLENBQW9ELE9BQXBELENBQTRELDJCQUE1RDtBQUNELEtBdEJDLENBQUY7QUF1QkQsR0F4Qk8sQ0FBUjtBQTBCQSxFQUFBLFFBQVEsQ0FBQyxxQkFBRCxFQUF3QixZQUFBO0FBQzlCLElBQUEsUUFBUSxDQUFDLDZCQUFELEVBQWdDLFlBQUE7QUFDdEMsTUFBQSxFQUFFLENBQUMsdURBQUQsRUFBMEQsWUFBQTtBQUMxRCxZQUFNLFNBQVMsR0FBRyxjQUFjLENBQUMsZ0JBQWYsQ0FBZ0MsS0FBaEMsQ0FBbEI7QUFDQSxZQUFNLE9BQU8sR0FBRyxjQUFjLENBQUMsZ0JBQWYsQ0FBZ0Msa0JBQWhDLENBQWhCO0FBQ0EsWUFBTSxTQUFTLEdBQUcsY0FBYyxDQUFDLDJCQUFELEVBQWUsU0FBZixDQUFoQztBQUVBLFlBQUksU0FBUyxHQUFHLGNBQWMsQ0FBQyxTQUFELEVBQVksT0FBWixDQUE5QjtBQUVBLFFBQUEsTUFBTSxDQUFDLFNBQUQsQ0FBTixDQUFrQixPQUFsQixDQUEwQjtBQUN4QixVQUFBLFdBQVcsRUFBRSxLQURXO0FBRXhCLFVBQUEsV0FBVyxFQUFFLENBQUMsa0JBQUQsQ0FGVztBQUd4QixVQUFBLGFBQWEsRUFBRTtBQUhTLFNBQTFCO0FBTUEsWUFBTSxPQUFPLEdBQUcsY0FBYyxDQUFDLGdCQUFmLENBQWdDLGtCQUFoQyxDQUFoQjtBQUNBLFFBQUEsU0FBUyxHQUFHLGNBQWMsQ0FBQyxTQUFELEVBQVksT0FBWixDQUExQjtBQUVBLFFBQUEsTUFBTSxDQUFDLFNBQUQsQ0FBTixDQUFrQixPQUFsQixDQUNFLFFBQVEsQ0FBQyxLQUFELEVBQVEsa0JBQVIsRUFBNEIsa0JBQTVCLENBRFY7QUFHRCxPQW5CQyxDQUFGO0FBb0JELEtBckJPLENBQVI7QUF1QkEsSUFBQSxRQUFRLENBQUMsMERBQUQsRUFBNkQsWUFBQTtBQUNuRSxlQUFTLFlBQVQsQ0FBc0IsTUFBdEIsRUFBbUMsV0FBbkMsRUFBZ0U7QUFDOUQsWUFBSSxPQUFPLE1BQVAsS0FBa0IsUUFBdEIsRUFBZ0M7QUFDOUIsaUJBQU8sV0FBVyxDQUFDLElBQVosQ0FBaUIsVUFBQSxNQUFBLEVBQU07QUFBSSxtQkFBQSxzQkFBUSxNQUFSLEVBQUEsTUFBQSxDQUFBO0FBQXVCLFdBQWxELENBQVA7QUFDRDs7QUFDRCxZQUFJLE9BQU8sTUFBUCxLQUFrQixVQUF0QixFQUFrQztBQUNoQyxpQkFBTyxXQUFXLENBQUMsSUFBWixDQUNMLFVBQUEsTUFBQSxFQUFNO0FBQ0osbUJBQUEsTUFBTSxDQUFDLElBQVAsQ0FBWSxJQUFaLEtBQXFCLE1BQU0sQ0FBQyxJQUFQLENBQWEsSUFBbEMsSUFDQSxNQUFNLENBQUMsSUFBUCxDQUFZLElBQVosQ0FBaUIsRUFBakIsS0FBd0IsTUFBTSxDQUFDLElBQVAsQ0FBYSxJQUFiLENBQWtCLEVBRDFDO0FBQzRDLFdBSHpDLENBQVA7QUFLRDs7QUFDRCxlQUFPLFNBQVA7QUFDRDs7QUFFRCxVQUFNLFlBQVksR0FBRyxTQUFmLFlBQWUsQ0FBQyxFQUFELEVBQWEsSUFBYixFQUEyQixHQUEzQixFQUFzQztBQUN6RCxpQkFBUyxLQUFULENBQWUsUUFBZixFQUFpQztBQUMvQixVQUFBLFFBQVEsQ0FBQztBQUFFLFlBQUEsSUFBSSxFQUFFLHFCQUFSO0FBQStCLFlBQUEsT0FBTyxFQUFFO0FBQUUsY0FBQSxFQUFFLEVBQUEsRUFBSjtBQUFNLGNBQUEsSUFBSSxFQUFBLElBQVY7QUFBWSxjQUFBLEdBQUcsRUFBQTtBQUFmO0FBQXhDLFdBQUQsQ0FBUjtBQUNEOztBQUNELFFBQUEsS0FBSyxDQUFDLElBQU4sR0FBYTtBQUNYLFVBQUEsSUFBSSxFQUFFO0FBQUUsWUFBQSxFQUFFLEVBQUEsRUFBSjtBQUFNLFlBQUEsSUFBSSxFQUFBLElBQVY7QUFBWSxZQUFBLEdBQUcsRUFBQTtBQUFmLFdBREs7QUFFWCxVQUFBLEtBQUssRUFBRTtBQUZJLFNBQWI7QUFJQSxlQUFPLEtBQVA7QUFDRCxPQVREOztBQVdBLE1BQUEsRUFBRSxDQUFDLGdGQUFELEVBQW1GLFlBQUE7QUFDbkYsWUFBTSxTQUFTLEdBQUcsUUFBUSxDQUFDLEtBQUQsRUFBUSxZQUFZLENBQUMsQ0FBRCxFQUFJLE9BQUosRUFBYSxFQUFiLENBQXBCLENBQTFCO0FBQ0EsWUFBTSxLQUFLLEdBQUcsWUFBWSxDQUFDLENBQUQsRUFBSSxNQUFKLEVBQVksRUFBWixDQUExQjtBQUNBLFlBQU0sWUFBWSxHQUFHLGNBQWMsQ0FBQyxnQkFBZixDQUFnQyxLQUFoQyxDQUFyQjtBQUVBLFFBQUEsTUFBTSxDQUFDLHNDQUF3QixLQUF4QixFQUErQixTQUFTLENBQUMsV0FBekMsQ0FBRCxDQUFOLENBQThELE9BQTlELENBQ0UsU0FBUyxDQUFDLFdBQVYsQ0FBc0IsQ0FBdEIsQ0FERjtBQUlBLFlBQU0sU0FBUyxHQUFHLDRCQUFjLFlBQWQsRUFBNEIsU0FBNUIsRUFBdUMsWUFBdkMsQ0FBbEI7QUFFQSxRQUFBLE1BQU0sQ0FBQyxTQUFTLENBQUMsV0FBWCxDQUFOLENBQThCLFlBQTlCLENBQTJDLENBQTNDO0FBQ0QsT0FaQyxDQUFGO0FBY0EsTUFBQSxFQUFFLENBQUMsb0VBQUQsRUFBdUUsWUFBQTtBQUN2RSxZQUFNLFNBQVMsR0FBRyxRQUFRLENBQUMsS0FBRCxFQUFRLFlBQVksQ0FBQyxDQUFELEVBQUksT0FBSixFQUFhLEVBQWIsQ0FBcEIsQ0FBMUI7QUFDQSxZQUFNLEtBQUssR0FBRyxZQUFZLENBQUMsQ0FBRCxFQUFJLE9BQUosRUFBYSxFQUFiLENBQTFCO0FBQ0EsWUFBTSxZQUFZLEdBQUcsY0FBYyxDQUFDLGdCQUFmLENBQWdDLEtBQWhDLENBQXJCO0FBRUEsUUFBQSxNQUFNLENBQUMsc0NBQXdCLEtBQXhCLEVBQStCLFNBQVMsQ0FBQyxXQUF6QyxDQUFELENBQU4sQ0FBOEQsT0FBOUQsQ0FDRSxTQUFTLENBQUMsV0FBVixDQUFzQixDQUF0QixDQURGO0FBSUEsWUFBTSxTQUFTLEdBQUcsNEJBQWMsWUFBZCxFQUE0QixTQUE1QixFQUF1QyxZQUF2QyxDQUFsQjtBQUVBLFFBQUEsTUFBTSxDQUFDLFNBQVMsQ0FBQyxXQUFYLENBQU4sQ0FBOEIsWUFBOUIsQ0FBMkMsQ0FBM0M7QUFDRCxPQVpDLENBQUY7QUFhRCxLQXJETyxDQUFSO0FBdURBLElBQUEsUUFBUSxDQUFDLDRCQUFELEVBQStCLFlBQUE7QUFDckMsTUFBQSxFQUFFLENBQUMseUdBQUQsRUFDZ0MsWUFBQTtBQUNoQyxZQUFNLFNBQVMsR0FBRyxRQUFRLENBQ3hCLEtBRHdCLEVBRXhCLGtCQUZ3QixFQUd4QixrQkFId0IsQ0FBMUI7QUFLQSxZQUFNLE1BQU0sR0FBRyxjQUFjLENBQUMsZ0JBQWYsQ0FBZ0Msa0JBQWhDLENBQWY7QUFFQSxZQUFNLFNBQVMsR0FBRyxjQUFjLENBQUMsU0FBRCxFQUFZLE1BQVosQ0FBaEM7QUFDQSxRQUFBLE1BQU0sQ0FBQyxTQUFELENBQU4sQ0FBa0IsT0FBbEIsQ0FDRSxRQUFRLENBQUMsS0FBRCxFQUFRLGtCQUFSLEVBQTRCLGtCQUE1QixDQURWO0FBR0QsT0FiQyxDQUFGO0FBZUEsTUFBQSxFQUFFLENBQUMsb0RBQUQsRUFBdUQsWUFBQTtBQUN2RCxZQUFNLFNBQVMsR0FBRyxRQUFRLENBQ3hCLEtBRHdCLEVBRXhCLGtCQUZ3QixFQUd4QixrQkFId0IsQ0FBMUI7QUFLQSxZQUFNLE1BQU0sR0FBRyxjQUFjLENBQUMsZ0JBQWYsQ0FDYixzQ0FEYSxDQUFmO0FBSUEsUUFBQSxNQUFNLENBQUMsY0FBYyxDQUFDLFNBQUQsRUFBWSxNQUFaLENBQWYsQ0FBTixDQUEwQyxPQUExQyxDQUNFLFFBQVEsQ0FDTixLQURNLEVBRU4sa0JBRk0sRUFHTixrQkFITSxFQUlOLHNDQUpNLENBRFY7QUFRRCxPQWxCQyxDQUFGO0FBbUJELEtBbkNPLENBQVI7QUFvQ0QsR0FuSE8sQ0FBUjtBQW9IRCxDQS9JTyxDQUFSO0FBaUpBLFFBQVEsQ0FBQyxzQ0FBRCxFQUF5QyxZQUFBO0FBQy9DLEVBQUEsRUFBRSxDQUFDLDRDQUFELEVBQStDLFlBQUE7QUFDL0MsUUFBTSxTQUFTLEdBQUcsUUFBUSxDQUN4QixLQUR3QixFQUV4QixrQkFGd0IsRUFHeEIsa0JBSHdCLEVBSXhCLHNDQUp3QixDQUExQjtBQU9BLFFBQU0sTUFBTSxHQUFHLGNBQWMsQ0FBQyxxQkFBZixDQUFvQyxRQUFBLENBQUEsRUFBQSxFQUM5QyxrQkFEOEMsQ0FBcEMsQ0FBZjtBQUlBLElBQUEsTUFBTSxDQUFDLGNBQWMsQ0FBQyxTQUFELEVBQVksTUFBWixDQUFmLENBQU4sQ0FBMEMsT0FBMUMsQ0FDRSxRQUFRLENBQ04sS0FETSxFQUVOLGtCQUZNLEVBR04sc0NBSE0sQ0FEVjtBQU9ELEdBbkJDLENBQUY7QUFvQkQsQ0FyQk8sQ0FBUjtBQXVCQSxRQUFRLENBQUMsb0NBQUQsRUFBdUMsWUFBQTtBQUM3QyxFQUFBLEVBQUUsQ0FBQyxzQ0FBRCxFQUF5QyxZQUFBO0FBQ3pDLElBQUEsTUFBTSxDQUNKLGNBQWMsQ0FBQyxTQUFELEVBQVksY0FBYyxDQUFDLG9CQUFmLENBQW9DLEtBQXBDLENBQVosQ0FEVixDQUFOLENBRUUsT0FGRixDQUVTLFFBQUEsQ0FBQSxRQUFBLENBQUEsRUFBQSxFQUNKLDJCQURJLENBQUEsRUFDUTtBQUNmLE1BQUEsYUFBYSxFQUFFO0FBREEsS0FEUixDQUZUO0FBTUQsR0FQQyxDQUFGO0FBU0EsRUFBQSxFQUFFLENBQUMseUNBQUQsRUFBNEMsWUFBQTtBQUM1QyxJQUFBLE1BQU0sQ0FDSixjQUFjLENBQUMsU0FBRCxFQUFZLGNBQWMsQ0FBQyxvQkFBZixDQUFvQyxPQUFwQyxDQUFaLENBRFYsQ0FBTixDQUVFLE9BRkYsQ0FFUyxRQUFBLENBQUEsUUFBQSxDQUFBLEVBQUEsRUFDSiwyQkFESSxDQUFBLEVBQ1E7QUFDZixNQUFBLGFBQWEsRUFBRTtBQURBLEtBRFIsQ0FGVDtBQU1ELEdBUEMsQ0FBRjtBQVFELENBbEJPLENBQVI7QUFvQkEsUUFBUSxDQUFDLFFBQUQsRUFBVyxZQUFBO0FBQ2pCLFdBQVMsVUFBVCxDQUFvQixRQUFwQixFQUFzQztBQUNwQyxJQUFBLFFBQVEsQ0FBQztBQUFFLE1BQUEsSUFBSSxFQUFFO0FBQVIsS0FBRCxDQUFSO0FBQ0Q7O0FBRUQsRUFBQSxRQUFRLENBQUMsZ0NBQUQsRUFBbUMsWUFBQTtBQUN6QyxJQUFBLFFBQVEsQ0FBQyxpQ0FBRCxFQUFvQyxZQUFBO0FBQzFDLE1BQUEsRUFBRSxDQUFDLHdDQUFELEVBQTJDLFlBQUE7QUFDM0MsWUFBTSxNQUFNLEdBQUcsY0FBYyxDQUFDLGdCQUFmLENBQWdDLFVBQWhDLENBQWY7QUFDQSxRQUFBLE1BQU0sQ0FBQyxjQUFjLENBQUMsMkJBQUQsRUFBZSxNQUFmLENBQWYsQ0FBTixDQUE2QyxPQUE3QyxDQUFxRCwyQkFBckQ7QUFDRCxPQUhDLENBQUY7QUFJRCxLQUxPLENBQVI7QUFPQSxJQUFBLFFBQVEsQ0FBQyxpQ0FBRCxFQUFvQyxZQUFBO0FBQzFDLE1BQUEsRUFBRSxDQUFDLDhEQUFELEVBQWlFLFlBQUE7QUFDakUsWUFBTSxTQUFTLEdBQUcsUUFBUSxDQUFDLEtBQUQsQ0FBMUI7QUFHQyxRQUFBLFVBQWtCLENBQUMsSUFBbkIsR0FBMEI7QUFDekIsVUFBQSxLQUFLLEVBQUU7QUFEa0IsU0FBMUI7QUFHRCxZQUFNLE1BQU0sR0FBRyxjQUFjLENBQUMsZ0JBQWYsQ0FBZ0MsVUFBaEMsQ0FBZjtBQUVBLFFBQUEsTUFBTSxDQUFDLGNBQWMsQ0FBQyxTQUFELEVBQVksTUFBWixDQUFmLENBQU4sQ0FBMEMsT0FBMUMsQ0FDRSxRQUFRLENBQUMsS0FBRCxFQUFRLFVBQVIsQ0FEVjtBQUdELE9BWkMsQ0FBRjtBQWNBLE1BQUEsRUFBRSxDQUFDLHVHQUFELEVBQzhCLFlBQUE7QUFDOUIsWUFBTSxZQUFZLEdBQUcsU0FBZixZQUFlLENBQUMsS0FBRCxFQUFXO0FBQzlCLG1CQUFTLE1BQVQsQ0FBZ0IsUUFBaEIsRUFBa0M7QUFDaEMsWUFBQSxRQUFRLENBQUM7QUFBRSxjQUFBLElBQUksRUFBRSxvQkFBUjtBQUE4QixjQUFBLE9BQU8sRUFBRTtBQUF2QyxhQUFELENBQVI7QUFDRDs7QUFDRCxpQkFBTyxNQUFQO0FBQ0QsU0FMRDs7QUFNQSxZQUFNLEtBQUssR0FBRyxZQUFZLENBQUMsS0FBRCxDQUExQjtBQUNBLFlBQU0sU0FBUyxHQUFHLFFBQVEsQ0FBQyxLQUFELEVBQVEsS0FBUixDQUExQjtBQUVBLFlBQU0sWUFBWSxHQUFHLFlBQVksQ0FBQyxLQUFELENBQWpDO0FBQ0MsUUFBQSxZQUFvQixDQUFDLElBQXJCLEdBQTRCO0FBQzNCLFVBQUEsS0FBSyxFQUFFO0FBRG9CLFNBQTVCO0FBR0QsWUFBTSxNQUFNLEdBQUcsY0FBYyxDQUFDLGdCQUFmLENBQWdDLFlBQWhDLENBQWY7QUFDQSxZQUFNLFNBQVMsR0FBRyxjQUFjLENBQUMsU0FBRCxFQUFZLE1BQVosQ0FBaEM7QUFFQSxRQUFBLE1BQU0sQ0FBQyxTQUFELENBQU4sQ0FBa0IsT0FBbEIsQ0FBMEIsUUFBUSxDQUFDLEtBQUQsRUFBUSxZQUFSLENBQWxDO0FBQ0QsT0FuQkMsQ0FBRjtBQW9CRCxLQW5DTyxDQUFSO0FBb0NELEdBNUNPLENBQVI7QUE4Q0EsRUFBQSxRQUFRLENBQUMsc0NBQUQsRUFBeUMsWUFBQTtBQUMvQyxJQUFBLEVBQUUsQ0FBQywyQ0FBRCxFQUE4QyxZQUFBO0FBQzlDLFVBQU0sU0FBUyxHQUFHLFFBQVEsQ0FBQyxLQUFELEVBQVEsVUFBUixDQUExQjtBQUNBLFVBQU0sTUFBTSxHQUFHLGNBQWMsQ0FBQyxxQkFBZixDQUFxQyxVQUFyQyxDQUFmO0FBRUEsTUFBQSxNQUFNLENBQUMsY0FBYyxDQUFDLFNBQUQsRUFBWSxNQUFaLENBQWYsQ0FBTixDQUEwQyxPQUExQyxDQUFrRCxRQUFRLENBQUMsS0FBRCxDQUExRDtBQUNELEtBTEMsQ0FBRjtBQU1ELEdBUE8sQ0FBUjtBQVFELENBM0RPLENBQVI7QUE2REEsUUFBUSxDQUFDLGlCQUFELEVBQW9CLFlBQUE7QUFDMUIsTUFBTSxlQUFlLEdBQUc7QUFDdEIsSUFBQSxJQUFJLEVBQUUsb0JBRGdCO0FBRXRCLElBQUEsT0FBTyxFQUFFO0FBQ1AsTUFBQSxFQUFFLEVBQUU7QUFERyxLQUZhO0FBS3RCLElBQUEsSUFBSSxFQUFFO0FBQ0osTUFBQSxLQUFLLEVBQUUsSUFESDtBQUVKLE1BQUEsT0FBTyxFQUFFLENBQUMsZUFBRCxFQUFrQixtQkFBbEI7QUFGTDtBQUxnQixHQUF4QjtBQVVBLE1BQU0sZUFBZSxHQUFHO0FBQ3RCLElBQUEsSUFBSSxFQUFFLG9CQURnQjtBQUV0QixJQUFBLE9BQU8sRUFBRTtBQUNQLE1BQUEsRUFBRSxFQUFFO0FBREcsS0FGYTtBQUt0QixJQUFBLElBQUksRUFBRTtBQUNKLE1BQUEsS0FBSyxFQUFFLElBREg7QUFFSixNQUFBLE9BQU8sRUFBRSxDQUFDLG1CQUFEO0FBRkw7QUFMZ0IsR0FBeEI7QUFVQSxNQUFNLGVBQWUsR0FBRztBQUN0QixJQUFBLElBQUksRUFBRSxvQkFEZ0I7QUFFdEIsSUFBQSxPQUFPLEVBQUU7QUFDUCxNQUFBLEVBQUUsRUFBRTtBQURHLEtBRmE7QUFLdEIsSUFBQSxJQUFJLEVBQUU7QUFDSixNQUFBLEtBQUssRUFBRTtBQURIO0FBTGdCLEdBQXhCO0FBVUEsRUFBQSxFQUFFLENBQUMsK0NBQUQsRUFBa0QsWUFBQTtBQUNsRCxRQUFNLFNBQVMsR0FBRyxRQUFRLENBQ3hCLEtBRHdCLEVBRXhCLGVBRndCLEVBR3hCLGVBSHdCLEVBSXhCLGVBSndCLENBQTFCO0FBTUEsUUFBTSxNQUFNLEdBQUcsY0FBYyxDQUFDLHVCQUFmLENBQXVDLGVBQXZDLENBQWY7QUFFQSxJQUFBLE1BQU0sQ0FBQyxjQUFjLENBQUMsU0FBRCxFQUFZLE1BQVosQ0FBZixDQUFOLENBQTBDLE9BQTFDLENBQ0UsUUFBUSxDQUFDLEtBQUQsRUFBUSxlQUFSLEVBQXlCLGVBQXpCLENBRFY7QUFHRCxHQVpDLENBQUY7QUFjQSxFQUFBLEVBQUUsQ0FBQyxvREFBRCxFQUF1RCxZQUFBO0FBQ3ZELFFBQU0sU0FBUyxHQUFHLFFBQVEsQ0FDeEIsS0FEd0IsRUFFeEIsZUFGd0IsRUFHeEIsZUFId0IsRUFJeEIsZUFKd0IsQ0FBMUI7QUFNQSxRQUFNLE1BQU0sR0FBRyxjQUFjLENBQUMsdUJBQWYsQ0FBdUMsbUJBQXZDLENBQWY7QUFFQSxJQUFBLE1BQU0sQ0FBQyxjQUFjLENBQUMsU0FBRCxFQUFZLE1BQVosQ0FBZixDQUFOLENBQTBDLE9BQTFDLENBQ0UsUUFBUSxDQUFDLEtBQUQsRUFBUSxlQUFSLENBRFY7QUFHRCxHQVpDLENBQUY7QUFjQSxFQUFBLEVBQUUsQ0FBQyxvRkFBRCxFQUF1RixZQUFBO0FBQ3ZGLFFBQU0sU0FBUyxHQUFHLFFBQVEsQ0FDeEIsS0FEd0IsRUFFeEIsZUFGd0IsRUFHeEIsZUFId0IsRUFJeEIsZUFKd0IsQ0FBMUI7QUFNQSxRQUFNLE1BQU0sR0FBRyxjQUFjLENBQUMsdUJBQWYsQ0FBdUMsZUFBdkMsQ0FBZjtBQUVBLElBQUEsTUFBTSxDQUFDLGNBQWMsQ0FBQyxTQUFELEVBQVksTUFBWixDQUFmLENBQU4sQ0FBMEMsT0FBMUMsQ0FDRSxRQUFRLENBQUMsS0FBRCxFQUFRLGVBQVIsRUFBeUIsZUFBekIsRUFBMEMsZUFBMUMsQ0FEVjtBQUdELEdBWkMsQ0FBRjtBQWFELENBeEVPLENBQVI7QUEwRUEsUUFBUSxDQUFDLGlCQUFELEVBQW9CLFlBQUE7QUFDMUIsRUFBQSxFQUFFLENBQUMsMkJBQUQsRUFBOEIsWUFBQTtBQUM5QixRQUFNLEtBQUssR0FBOEI7QUFDdkMsTUFBQSxPQUFPLEVBQUU7QUFDUCxRQUFBLFdBQVcsRUFBRSxJQUROO0FBRVAsUUFBQSxXQUFXLEVBQUUsQ0FBQztBQUFFLFVBQUEsSUFBSSxFQUFFLEtBQVI7QUFBZSxVQUFBLE9BQU8sRUFBRTtBQUF4QixTQUFELENBRk47QUFHUCxRQUFBLGFBQWEsRUFBRTtBQUhSO0FBRDhCLEtBQXpDO0FBT0EsSUFBQSxNQUFNLENBQUMsb0NBQWdCLEtBQWhCLENBQUQsQ0FBTixDQUErQixPQUEvQixDQUF1QztBQUNyQyxNQUFBLFdBQVcsRUFBRSxJQUR3QjtBQUVyQyxNQUFBLFdBQVcsRUFBRSxDQUFDO0FBQUUsUUFBQSxJQUFJLEVBQUUsS0FBUjtBQUFlLFFBQUEsT0FBTyxFQUFFO0FBQXhCLE9BQUQsQ0FGd0I7QUFHckMsTUFBQSxhQUFhLEVBQUU7QUFIc0IsS0FBdkM7QUFLRCxHQWJDLENBQUY7QUFjRCxDQWZPLENBQVIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEaXNwYXRjaCB9IGZyb20gJ3JlZHV4JztcbmltcG9ydCBpc0VxdWFsIGZyb20gJ2xvZGFzaC9pc0VxdWFsJztcbmltcG9ydCAqIGFzIGFjdGlvbkNyZWF0b3JzIGZyb20gJy4uL3JlZHV4L2FjdGlvbkNyZWF0b3JzJztcbmltcG9ydCB7IEVucXVldWVkQWN0aW9uLCBOZXR3b3JrU3RhdGUgfSBmcm9tICcuLi90eXBlcyc7XG5pbXBvcnQgY3JlYXRlUmVkdWNlciwge1xuICBpbml0aWFsU3RhdGUsXG4gIG5ldHdvcmtTZWxlY3Rvcixcbn0gZnJvbSAnLi4vcmVkdXgvY3JlYXRlUmVkdWNlcic7XG5pbXBvcnQgZ2V0U2ltaWxhckFjdGlvbkluUXVldWUgZnJvbSAnLi4vdXRpbHMvZ2V0U2ltaWxhckFjdGlvbkluUXVldWUnO1xuXG5jb25zdCBuZXR3b3JrUmVkdWNlciA9IGNyZWF0ZVJlZHVjZXIoKTtcblxuY29uc3QgZ2V0U3RhdGUgPSAoaXNDb25uZWN0ZWQgPSBmYWxzZSwgLi4uYWN0aW9uUXVldWU6IEVucXVldWVkQWN0aW9uW10pID0+ICh7XG4gIGlzQ29ubmVjdGVkLFxuICBhY3Rpb25RdWV1ZSxcbiAgaXNRdWV1ZVBhdXNlZDogZmFsc2UsXG59KTtcblxuLyoqIEFjdGlvbnMgdXNlZCBmcm9tIG5vdyBvbiB0byB0ZXN0IGRpZmZlcmVudCBzY2VuYXJpb3MgKi9cbmNvbnN0IHByZXZBY3Rpb25Ub1JldHJ5MSA9IHtcbiAgdHlwZTogJ0ZFVENIX0RBVEFfUkVRVUVTVCcsXG4gIHBheWxvYWQ6IHtcbiAgICBpZDogJzEnLFxuICB9LFxuICBtZXRhOiB7XG4gICAgcmV0cnk6IHRydWUsXG4gIH0sXG59O1xuY29uc3QgcHJldkFjdGlvblRvUmV0cnkyID0ge1xuICB0eXBlOiAnRkVUQ0hfT1RIRVJfUkVRVUVTVCcsXG4gIHBheWxvYWQ6IHtcbiAgICBpc0ZldGNoaW5nOiB0cnVlLFxuICB9LFxuICBtZXRhOiB7XG4gICAgcmV0cnk6IHRydWUsXG4gIH0sXG59O1xuY29uc3QgcHJldkFjdGlvblRvUmV0cnkxV2l0aERpZmZlcmVudFBheWxvYWQgPSB7XG4gIHR5cGU6ICdGRVRDSF9EQVRBX1JFUVVFU1QnLFxuICBwYXlsb2FkOiB7XG4gICAgaWQ6ICcyJyxcbiAgfSxcbiAgbWV0YToge1xuICAgIHJldHJ5OiB0cnVlLFxuICB9LFxufTtcblxuZGVzY3JpYmUoJ3Vua25vd24gYWN0aW9uIHR5cGUnLCAoKSA9PiB7XG4gIGl0KCdyZXR1cm5zIHByZXZTdGF0ZSBvbiBpbml0aWFsaXphdGlvbicsICgpID0+IHtcbiAgICBleHBlY3QobmV0d29ya1JlZHVjZXIodW5kZWZpbmVkLCB7IHR5cGU6ICdBQ1RJT05fSV9ET05UX0NBUkUnIH0pKS50b0VxdWFsKFxuICAgICAgaW5pdGlhbFN0YXRlLFxuICAgICk7XG4gIH0pO1xuXG4gIGl0KCdyZXR1cm5zIHByZXZTdGF0ZSBpZiB0aGUgYWN0aW9uIGlzIG5vdCBoYW5kbGVkJywgKCkgPT4ge1xuICAgIGV4cGVjdChcbiAgICAgIG5ldHdvcmtSZWR1Y2VyKGluaXRpYWxTdGF0ZSwgeyB0eXBlOiAnQU5PVEhFUl9BQ1RJT05fSV9ET05UX0NBUkUnIH0pLFxuICAgICkudG9FcXVhbChpbml0aWFsU3RhdGUpO1xuICB9KTtcbn0pO1xuXG5kZXNjcmliZSgnQ09OTkVDVElPTl9DSEFOR0UgYWN0aW9uIHR5cGUnLCAoKSA9PiB7XG4gIGl0KCdjaGFuZ2VzIGlzQ29ubmVjdGVkIHN0YXRlIHByb3Blcmx5JywgKCkgPT4ge1xuICAgIGNvbnN0IG1vY2tBY3Rpb24gPSBhY3Rpb25DcmVhdG9ycy5jb25uZWN0aW9uQ2hhbmdlKGZhbHNlKTtcbiAgICBleHBlY3QobmV0d29ya1JlZHVjZXIoaW5pdGlhbFN0YXRlLCBtb2NrQWN0aW9uKSkudG9FcXVhbCh7XG4gICAgICBpc0Nvbm5lY3RlZDogZmFsc2UsXG4gICAgICBhY3Rpb25RdWV1ZTogW10sXG4gICAgICBpc1F1ZXVlUGF1c2VkOiBmYWxzZSxcbiAgICB9KTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ09GRkxJTkVfQUNUSU9OIGFjdGlvbiB0eXBlJywgKCkgPT4ge1xuICBkZXNjcmliZSgnbWV0YS5yZXRyeSAhPT0gdHJ1ZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIE5PVCBhZGQgdGhlIGFjdGlvbiB0byB0aGUgcXVldWUnLCAoKSA9PiB7XG4gICAgICBjb25zdCBwcmV2QWN0aW9uID0ge1xuICAgICAgICB0eXBlOiAnRkVUQ0hfREFUQV9SRVFVRVNUJyxcbiAgICAgICAgcGF5bG9hZDoge1xuICAgICAgICAgIGlkOiAnMScsXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgICAgY29uc3QgYW5vdGhlclByZXZBY3Rpb24gPSB7XG4gICAgICAgIHR5cGU6ICdGRVRDSF9EQVRBX1JFUVVFU1QnLFxuICAgICAgICBwYXlsb2FkOiB7XG4gICAgICAgICAgaWQ6ICcxJyxcbiAgICAgICAgfSxcbiAgICAgICAgbWV0YToge1xuICAgICAgICAgIHJldHJ5OiBmYWxzZSxcbiAgICAgICAgfSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IGFjdGlvbiA9IGFjdGlvbkNyZWF0b3JzLmZldGNoT2ZmbGluZU1vZGUocHJldkFjdGlvbik7XG4gICAgICBjb25zdCBhbm90aGVyQWN0aW9uID0gYWN0aW9uQ3JlYXRvcnMuZmV0Y2hPZmZsaW5lTW9kZShhbm90aGVyUHJldkFjdGlvbik7XG5cbiAgICAgIGV4cGVjdChuZXR3b3JrUmVkdWNlcihpbml0aWFsU3RhdGUsIGFjdGlvbikpLnRvRXF1YWwoaW5pdGlhbFN0YXRlKTtcbiAgICAgIGV4cGVjdChuZXR3b3JrUmVkdWNlcihpbml0aWFsU3RhdGUsIGFub3RoZXJBY3Rpb24pKS50b0VxdWFsKGluaXRpYWxTdGF0ZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdtZXRhLnJldHJ5ID09PSB0cnVlJywgKCkgPT4ge1xuICAgIGRlc2NyaWJlKCdhY3Rpb25zIHdpdGggRElGRkVSRU5UIHR5cGUnLCAoKSA9PiB7XG4gICAgICBpdCgnYWN0aW9ucyBhcmUgcHVzaGVkIGludG8gdGhlIHF1ZXVlIGluIG9yZGVyIG9mIGFycml2YWwnLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHByZUFjdGlvbiA9IGFjdGlvbkNyZWF0b3JzLmNvbm5lY3Rpb25DaGFuZ2UoZmFsc2UpO1xuICAgICAgICBjb25zdCBhY3Rpb24xID0gYWN0aW9uQ3JlYXRvcnMuZmV0Y2hPZmZsaW5lTW9kZShwcmV2QWN0aW9uVG9SZXRyeTEpO1xuICAgICAgICBjb25zdCBwcmV2U3RhdGUgPSBuZXR3b3JrUmVkdWNlcihpbml0aWFsU3RhdGUsIHByZUFjdGlvbik7XG5cbiAgICAgICAgbGV0IG5leHRTdGF0ZSA9IG5ldHdvcmtSZWR1Y2VyKHByZXZTdGF0ZSwgYWN0aW9uMSk7XG5cbiAgICAgICAgZXhwZWN0KG5leHRTdGF0ZSkudG9FcXVhbCh7XG4gICAgICAgICAgaXNDb25uZWN0ZWQ6IGZhbHNlLFxuICAgICAgICAgIGFjdGlvblF1ZXVlOiBbcHJldkFjdGlvblRvUmV0cnkxXSxcbiAgICAgICAgICBpc1F1ZXVlUGF1c2VkOiBmYWxzZSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgYWN0aW9uMiA9IGFjdGlvbkNyZWF0b3JzLmZldGNoT2ZmbGluZU1vZGUocHJldkFjdGlvblRvUmV0cnkyKTtcbiAgICAgICAgbmV4dFN0YXRlID0gbmV0d29ya1JlZHVjZXIobmV4dFN0YXRlLCBhY3Rpb24yKTtcblxuICAgICAgICBleHBlY3QobmV4dFN0YXRlKS50b0VxdWFsKFxuICAgICAgICAgIGdldFN0YXRlKGZhbHNlLCBwcmV2QWN0aW9uVG9SZXRyeTEsIHByZXZBY3Rpb25Ub1JldHJ5MiksXG4gICAgICAgICk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCd0aHVua3MgdGhhdCBhcmUgdGhlIHNhbWUgd2l0aCBjdXN0b20gY29tcGFyaXNvbiBmdW5jdGlvbicsICgpID0+IHtcbiAgICAgIGZ1bmN0aW9uIGNvbXBhcmlzb25GbihhY3Rpb246IGFueSwgYWN0aW9uUXVldWU6IEVucXVldWVkQWN0aW9uW10pIHtcbiAgICAgICAgaWYgKHR5cGVvZiBhY3Rpb24gPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgcmV0dXJuIGFjdGlvblF1ZXVlLmZpbmQocXVldWVkID0+IGlzRXF1YWwocXVldWVkLCBhY3Rpb24pKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIGFjdGlvbiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgIHJldHVybiBhY3Rpb25RdWV1ZS5maW5kKFxuICAgICAgICAgICAgcXVldWVkID0+XG4gICAgICAgICAgICAgIGFjdGlvbi5tZXRhLm5hbWUgPT09IHF1ZXVlZC5tZXRhIS5uYW1lICYmXG4gICAgICAgICAgICAgIGFjdGlvbi5tZXRhLmFyZ3MuaWQgPT09IHF1ZXVlZC5tZXRhIS5hcmdzLmlkLFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgIH1cblxuICAgICAgY29uc3QgdGh1bmtGYWN0b3J5ID0gKGlkOiBudW1iZXIsIG5hbWU6IHN0cmluZywgYWdlOiBudW1iZXIpID0+IHtcbiAgICAgICAgZnVuY3Rpb24gdGh1bmsoZGlzcGF0Y2g6IERpc3BhdGNoKSB7XG4gICAgICAgICAgZGlzcGF0Y2goeyB0eXBlOiAnVVBEQVRFX0RBVEFfUkVRVUVTVCcsIHBheWxvYWQ6IHsgaWQsIG5hbWUsIGFnZSB9IH0pO1xuICAgICAgICB9XG4gICAgICAgIHRodW5rLm1ldGEgPSB7XG4gICAgICAgICAgYXJnczogeyBpZCwgbmFtZSwgYWdlIH0sXG4gICAgICAgICAgcmV0cnk6IHRydWUsXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB0aHVuaztcbiAgICAgIH07XG5cbiAgICAgIGl0KGBzaG91bGQgYWRkIHRodW5rcyBpZiBmdW5jdGlvbiBpcyBzYW1lIGJ1dCB0aHVua3MgYXJlIG1vZGlmeWluZyBkaWZmZXJlbnQgaXRlbXNgLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHByZXZTdGF0ZSA9IGdldFN0YXRlKGZhbHNlLCB0aHVua0ZhY3RvcnkoMSwgJ0JpbGJvJywgNTUpKTtcbiAgICAgICAgY29uc3QgdGh1bmsgPSB0aHVua0ZhY3RvcnkoMiwgJ0xpbmsnLCA1NCk7XG4gICAgICAgIGNvbnN0IHdyYXBwZWRUaHVuayA9IGFjdGlvbkNyZWF0b3JzLmZldGNoT2ZmbGluZU1vZGUodGh1bmspO1xuXG4gICAgICAgIGV4cGVjdChnZXRTaW1pbGFyQWN0aW9uSW5RdWV1ZSh0aHVuaywgcHJldlN0YXRlLmFjdGlvblF1ZXVlKSkudG9FcXVhbChcbiAgICAgICAgICBwcmV2U3RhdGUuYWN0aW9uUXVldWVbMF0sXG4gICAgICAgICk7XG5cbiAgICAgICAgY29uc3QgbmV4dFN0YXRlID0gY3JlYXRlUmVkdWNlcihjb21wYXJpc29uRm4pKHByZXZTdGF0ZSwgd3JhcHBlZFRodW5rKTtcblxuICAgICAgICBleHBlY3QobmV4dFN0YXRlLmFjdGlvblF1ZXVlKS50b0hhdmVMZW5ndGgoMik7XG4gICAgICB9KTtcblxuICAgICAgaXQoYHNob3VsZCByZXBsYWNlIGEgdGh1bmsgaWYgdGh1bmsgYWxyZWFkeSBleGlzdHMgdG8gbW9kaWZ5IHNhbWUgaXRlbWAsICgpID0+IHtcbiAgICAgICAgY29uc3QgcHJldlN0YXRlID0gZ2V0U3RhdGUoZmFsc2UsIHRodW5rRmFjdG9yeSgxLCAnQmlsYm8nLCA1NSkpO1xuICAgICAgICBjb25zdCB0aHVuayA9IHRodW5rRmFjdG9yeSgxLCAnQmlsYm8nLCA2NSk7XG4gICAgICAgIGNvbnN0IHdyYXBwZWRUaHVuayA9IGFjdGlvbkNyZWF0b3JzLmZldGNoT2ZmbGluZU1vZGUodGh1bmspO1xuXG4gICAgICAgIGV4cGVjdChnZXRTaW1pbGFyQWN0aW9uSW5RdWV1ZSh0aHVuaywgcHJldlN0YXRlLmFjdGlvblF1ZXVlKSkudG9FcXVhbChcbiAgICAgICAgICBwcmV2U3RhdGUuYWN0aW9uUXVldWVbMF0sXG4gICAgICAgICk7XG5cbiAgICAgICAgY29uc3QgbmV4dFN0YXRlID0gY3JlYXRlUmVkdWNlcihjb21wYXJpc29uRm4pKHByZXZTdGF0ZSwgd3JhcHBlZFRodW5rKTtcblxuICAgICAgICBleHBlY3QobmV4dFN0YXRlLmFjdGlvblF1ZXVlKS50b0hhdmVMZW5ndGgoMSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdhY3Rpb25zIHdpdGggdGhlIHNhbWUgdHlwZScsICgpID0+IHtcbiAgICAgIGl0KGBzaG91bGQgcmVtb3ZlIHRoZSBhY3Rpb24gYW5kIGFkZCBpdCBiYWNrIGF0IHRoZSBlbmQgb2YgdGhlIHF1ZXVlXG4gICBpZiB0aGUgYWN0aW9uIGhhcyB0aGUgc2FtZSBwYXlsb2FkYCwgKCkgPT4ge1xuICAgICAgICBjb25zdCBwcmV2U3RhdGUgPSBnZXRTdGF0ZShcbiAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICBwcmV2QWN0aW9uVG9SZXRyeTEsXG4gICAgICAgICAgcHJldkFjdGlvblRvUmV0cnkyLFxuICAgICAgICApO1xuICAgICAgICBjb25zdCBhY3Rpb24gPSBhY3Rpb25DcmVhdG9ycy5mZXRjaE9mZmxpbmVNb2RlKHByZXZBY3Rpb25Ub1JldHJ5MSk7XG5cbiAgICAgICAgY29uc3QgbmV4dFN0YXRlID0gbmV0d29ya1JlZHVjZXIocHJldlN0YXRlLCBhY3Rpb24pO1xuICAgICAgICBleHBlY3QobmV4dFN0YXRlKS50b0VxdWFsKFxuICAgICAgICAgIGdldFN0YXRlKGZhbHNlLCBwcmV2QWN0aW9uVG9SZXRyeTIsIHByZXZBY3Rpb25Ub1JldHJ5MSksXG4gICAgICAgICk7XG4gICAgICB9KTtcblxuICAgICAgaXQoYHNob3VsZCBwdXNoIHRoZSBhY3Rpb24gaWYgdGhlIHBheWxvYWQgaXMgZGlmZmVyZW50YCwgKCkgPT4ge1xuICAgICAgICBjb25zdCBwcmV2U3RhdGUgPSBnZXRTdGF0ZShcbiAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICBwcmV2QWN0aW9uVG9SZXRyeTIsXG4gICAgICAgICAgcHJldkFjdGlvblRvUmV0cnkxLFxuICAgICAgICApO1xuICAgICAgICBjb25zdCBhY3Rpb24gPSBhY3Rpb25DcmVhdG9ycy5mZXRjaE9mZmxpbmVNb2RlKFxuICAgICAgICAgIHByZXZBY3Rpb25Ub1JldHJ5MVdpdGhEaWZmZXJlbnRQYXlsb2FkLFxuICAgICAgICApO1xuXG4gICAgICAgIGV4cGVjdChuZXR3b3JrUmVkdWNlcihwcmV2U3RhdGUsIGFjdGlvbikpLnRvRXF1YWwoXG4gICAgICAgICAgZ2V0U3RhdGUoXG4gICAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICAgIHByZXZBY3Rpb25Ub1JldHJ5MixcbiAgICAgICAgICAgIHByZXZBY3Rpb25Ub1JldHJ5MSxcbiAgICAgICAgICAgIHByZXZBY3Rpb25Ub1JldHJ5MVdpdGhEaWZmZXJlbnRQYXlsb2FkLFxuICAgICAgICAgICksXG4gICAgICAgICk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ1JFTU9WRV9BQ1RJT05fRlJPTV9RVUVVRSBhY3Rpb24gdHlwZScsICgpID0+IHtcbiAgaXQoJ3JlbW92ZXMgdGhlIGFjdGlvbiBmcm9tIHRoZSBxdWV1ZSBwcm9wZXJseScsICgpID0+IHtcbiAgICBjb25zdCBwcmV2U3RhdGUgPSBnZXRTdGF0ZShcbiAgICAgIGZhbHNlLFxuICAgICAgcHJldkFjdGlvblRvUmV0cnkyLFxuICAgICAgcHJldkFjdGlvblRvUmV0cnkxLFxuICAgICAgcHJldkFjdGlvblRvUmV0cnkxV2l0aERpZmZlcmVudFBheWxvYWQsXG4gICAgKTtcbiAgICAvLyBEaWZmZXJlbnQgb2JqZWN0IHJlZmVyZW5jZXMgYnV0IHNhbWUgc2hhcGUsIGNoZWNraW5nIHRoYXQgZGVlcCBlcXVhbCB3b3JrcyBjb3JyZWN0bHlcbiAgICBjb25zdCBhY3Rpb24gPSBhY3Rpb25DcmVhdG9ycy5yZW1vdmVBY3Rpb25Gcm9tUXVldWUoe1xuICAgICAgLi4ucHJldkFjdGlvblRvUmV0cnkyLFxuICAgIH0pO1xuXG4gICAgZXhwZWN0KG5ldHdvcmtSZWR1Y2VyKHByZXZTdGF0ZSwgYWN0aW9uKSkudG9FcXVhbChcbiAgICAgIGdldFN0YXRlKFxuICAgICAgICBmYWxzZSxcbiAgICAgICAgcHJldkFjdGlvblRvUmV0cnkxLFxuICAgICAgICBwcmV2QWN0aW9uVG9SZXRyeTFXaXRoRGlmZmVyZW50UGF5bG9hZCxcbiAgICAgICksXG4gICAgKTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ1FVRVVFX1NFTUFQSE9SRV9DSEFOR0UgYWN0aW9uIHR5cGUnLCAoKSA9PiB7XG4gIGl0KCdQYXVzZXMgdGhlIHF1ZXVlIGlmIHNlbWFwaG9yZSBpcyByZWQnLCAoKSA9PiB7XG4gICAgZXhwZWN0KFxuICAgICAgbmV0d29ya1JlZHVjZXIodW5kZWZpbmVkLCBhY3Rpb25DcmVhdG9ycy5jaGFuZ2VRdWV1ZVNlbWFwaG9yZSgnUkVEJykpLFxuICAgICkudG9FcXVhbCh7XG4gICAgICAuLi5pbml0aWFsU3RhdGUsXG4gICAgICBpc1F1ZXVlUGF1c2VkOiB0cnVlLFxuICAgIH0pO1xuICB9KTtcblxuICBpdCgnUmVzdW1lcyB0aGUgcXVldWUgaWYgc2VtYXBob3JlIGlzIGdyZWVuJywgKCkgPT4ge1xuICAgIGV4cGVjdChcbiAgICAgIG5ldHdvcmtSZWR1Y2VyKHVuZGVmaW5lZCwgYWN0aW9uQ3JlYXRvcnMuY2hhbmdlUXVldWVTZW1hcGhvcmUoJ0dSRUVOJykpLFxuICAgICkudG9FcXVhbCh7XG4gICAgICAuLi5pbml0aWFsU3RhdGUsXG4gICAgICBpc1F1ZXVlUGF1c2VkOiBmYWxzZSxcbiAgICB9KTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ3RodW5rcycsICgpID0+IHtcbiAgZnVuY3Rpb24gZmV0Y2hUaHVuayhkaXNwYXRjaDogRGlzcGF0Y2gpIHtcbiAgICBkaXNwYXRjaCh7IHR5cGU6ICdGRVRDSF9EQVRBX1JFUVVFU1QnIH0pO1xuICB9XG5cbiAgZGVzY3JpYmUoJ0ZFVENIX09GRkxJTkVfTU9ERSBhY3Rpb24gdHlwZScsICgpID0+IHtcbiAgICBkZXNjcmliZSgnYWN0aW9uIHdpdGggbWV0YS5yZXRyeSAhPT0gdHJ1ZScsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgTk9UIGFkZCB0aGUgYWN0aW9uIHRvIHRoZSBxdWV1ZScsICgpID0+IHtcbiAgICAgICAgY29uc3QgYWN0aW9uID0gYWN0aW9uQ3JlYXRvcnMuZmV0Y2hPZmZsaW5lTW9kZShmZXRjaFRodW5rKTtcbiAgICAgICAgZXhwZWN0KG5ldHdvcmtSZWR1Y2VyKGluaXRpYWxTdGF0ZSwgYWN0aW9uKSkudG9FcXVhbChpbml0aWFsU3RhdGUpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnYWN0aW9uIHdpdGggbWV0YS5yZXRyeSA9PT0gdHJ1ZScsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgYWRkIHRoZSBhY3Rpb24gdG8gdGhlIHF1ZXVlIGlmIHRoZSB0aHVuayBpcyBkaWZmZXJlbnQnLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHByZXZTdGF0ZSA9IGdldFN0YXRlKGZhbHNlKTtcblxuICAgICAgICAvLyBQcm9wZXJ0eSAnbWV0YScgZG9lcyBub3QgZXhpc3Qgb24gdHlwZSAnKGRpc3BhdGNoOiBEaXNwYXRjaDxBbnlBY3Rpb24+KSA9PiB2b2lkJ1xuICAgICAgICAoZmV0Y2hUaHVuayBhcyBhbnkpLm1ldGEgPSB7XG4gICAgICAgICAgcmV0cnk6IHRydWUsXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGFjdGlvbiA9IGFjdGlvbkNyZWF0b3JzLmZldGNoT2ZmbGluZU1vZGUoZmV0Y2hUaHVuayk7XG5cbiAgICAgICAgZXhwZWN0KG5ldHdvcmtSZWR1Y2VyKHByZXZTdGF0ZSwgYWN0aW9uKSkudG9FcXVhbChcbiAgICAgICAgICBnZXRTdGF0ZShmYWxzZSwgZmV0Y2hUaHVuayksXG4gICAgICAgICk7XG4gICAgICB9KTtcblxuICAgICAgaXQoYHNob3VsZCByZW1vdmUgdGhlIHRodW5rIGFuZCBhZGQgaXQgYmFjayBhdCB0aGUgZW5kIG9mIHRoZSBxdWV1ZSBcbiAgICAgIGlmIGl0IHByZXNlbnRzIHRoZSBzYW1lIHNoYXBlYCwgKCkgPT4ge1xuICAgICAgICBjb25zdCB0aHVua0ZhY3RvcnkgPSAocGFyYW06IGFueSkgPT4ge1xuICAgICAgICAgIGZ1bmN0aW9uIHRodW5rMShkaXNwYXRjaDogRGlzcGF0Y2gpIHtcbiAgICAgICAgICAgIGRpc3BhdGNoKHsgdHlwZTogJ0ZFVENIX0RBVEFfUkVRVUVTVCcsIHBheWxvYWQ6IHBhcmFtIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gdGh1bmsxO1xuICAgICAgICB9O1xuICAgICAgICBjb25zdCB0aHVuayA9IHRodW5rRmFjdG9yeSgnZm9vJyk7XG4gICAgICAgIGNvbnN0IHByZXZTdGF0ZSA9IGdldFN0YXRlKGZhbHNlLCB0aHVuayk7XG5cbiAgICAgICAgY29uc3Qgc2ltaWxhclRodW5rID0gdGh1bmtGYWN0b3J5KCdiYXInKTtcbiAgICAgICAgKHNpbWlsYXJUaHVuayBhcyBhbnkpLm1ldGEgPSB7XG4gICAgICAgICAgcmV0cnk6IHRydWUsXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGFjdGlvbiA9IGFjdGlvbkNyZWF0b3JzLmZldGNoT2ZmbGluZU1vZGUoc2ltaWxhclRodW5rKTtcbiAgICAgICAgY29uc3QgbmV4dFN0YXRlID0gbmV0d29ya1JlZHVjZXIocHJldlN0YXRlLCBhY3Rpb24pO1xuXG4gICAgICAgIGV4cGVjdChuZXh0U3RhdGUpLnRvRXF1YWwoZ2V0U3RhdGUoZmFsc2UsIHNpbWlsYXJUaHVuaykpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdSRU1PVkVfQUNUSU9OX0ZST01fUVVFVUUgYWN0aW9uIHR5cGUnLCAoKSA9PiB7XG4gICAgaXQoJ3JlbW92ZXMgdGhlIHRodW5rIGZyb20gdGhlIHF1ZXVlIHByb3Blcmx5JywgKCkgPT4ge1xuICAgICAgY29uc3QgcHJldlN0YXRlID0gZ2V0U3RhdGUoZmFsc2UsIGZldGNoVGh1bmspO1xuICAgICAgY29uc3QgYWN0aW9uID0gYWN0aW9uQ3JlYXRvcnMucmVtb3ZlQWN0aW9uRnJvbVF1ZXVlKGZldGNoVGh1bmspO1xuXG4gICAgICBleHBlY3QobmV0d29ya1JlZHVjZXIocHJldlN0YXRlLCBhY3Rpb24pKS50b0VxdWFsKGdldFN0YXRlKGZhbHNlKSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdkaXNtaXNzIGZlYXR1cmUnLCAoKSA9PiB7XG4gIGNvbnN0IGFjdGlvbkVucXVldWVkMSA9IHtcbiAgICB0eXBlOiAnRkVUQ0hfUEFHRV9SRVFVRVNUJyxcbiAgICBwYXlsb2FkOiB7XG4gICAgICBpZDogJzInLFxuICAgIH0sXG4gICAgbWV0YToge1xuICAgICAgcmV0cnk6IHRydWUsXG4gICAgICBkaXNtaXNzOiBbJ05BVklHQVRFX0JBQ0snLCAnTkFWSUdBVEVfVE9fTE9HSU4nXSxcbiAgICB9LFxuICB9O1xuICBjb25zdCBhY3Rpb25FbnF1ZXVlZDIgPSB7XG4gICAgdHlwZTogJ0ZFVENIX1VTRVJfUkVRVUVTVCcsXG4gICAgcGF5bG9hZDoge1xuICAgICAgaWQ6ICc0JyxcbiAgICB9LFxuICAgIG1ldGE6IHtcbiAgICAgIHJldHJ5OiB0cnVlLFxuICAgICAgZGlzbWlzczogWydOQVZJR0FURV9UT19MT0dJTiddLFxuICAgIH0sXG4gIH07XG4gIGNvbnN0IGFjdGlvbkVucXVldWVkMyA9IHtcbiAgICB0eXBlOiAnRkVUQ0hfVVNFUl9SRVFVRVNUJyxcbiAgICBwYXlsb2FkOiB7XG4gICAgICBpZDogJzQnLFxuICAgIH0sXG4gICAgbWV0YToge1xuICAgICAgcmV0cnk6IHRydWUsXG4gICAgfSxcbiAgfTtcblxuICBpdCgnTkFWSUdBVEVfQkFDSyBkaXNwYXRjaGVkLCBkaXNtaXNzaW5nIDEgYWN0aW9uJywgKCkgPT4ge1xuICAgIGNvbnN0IHByZXZTdGF0ZSA9IGdldFN0YXRlKFxuICAgICAgZmFsc2UsXG4gICAgICBhY3Rpb25FbnF1ZXVlZDEsXG4gICAgICBhY3Rpb25FbnF1ZXVlZDIsXG4gICAgICBhY3Rpb25FbnF1ZXVlZDMsXG4gICAgKTtcbiAgICBjb25zdCBhY3Rpb24gPSBhY3Rpb25DcmVhdG9ycy5kaXNtaXNzQWN0aW9uc0Zyb21RdWV1ZSgnTkFWSUdBVEVfQkFDSycpO1xuXG4gICAgZXhwZWN0KG5ldHdvcmtSZWR1Y2VyKHByZXZTdGF0ZSwgYWN0aW9uKSkudG9FcXVhbChcbiAgICAgIGdldFN0YXRlKGZhbHNlLCBhY3Rpb25FbnF1ZXVlZDIsIGFjdGlvbkVucXVldWVkMyksXG4gICAgKTtcbiAgfSk7XG5cbiAgaXQoJ05BVklHQVRFX1RPX0xPR0lOIGRpc3BhdGNoZWQsIGRpc21pc3NpbmcgMiBhY3Rpb25zJywgKCkgPT4ge1xuICAgIGNvbnN0IHByZXZTdGF0ZSA9IGdldFN0YXRlKFxuICAgICAgZmFsc2UsXG4gICAgICBhY3Rpb25FbnF1ZXVlZDEsXG4gICAgICBhY3Rpb25FbnF1ZXVlZDIsXG4gICAgICBhY3Rpb25FbnF1ZXVlZDMsXG4gICAgKTtcbiAgICBjb25zdCBhY3Rpb24gPSBhY3Rpb25DcmVhdG9ycy5kaXNtaXNzQWN0aW9uc0Zyb21RdWV1ZSgnTkFWSUdBVEVfVE9fTE9HSU4nKTtcblxuICAgIGV4cGVjdChuZXR3b3JrUmVkdWNlcihwcmV2U3RhdGUsIGFjdGlvbikpLnRvRXF1YWwoXG4gICAgICBnZXRTdGF0ZShmYWxzZSwgYWN0aW9uRW5xdWV1ZWQzKSxcbiAgICApO1xuICB9KTtcblxuICBpdChcIkFueSBvdGhlciBhY3Rpb24gZGlzcGF0Y2hlZCwgbm8gY2hhbmdlcyAoYWx0aG91Z2ggdGhlIG1pZGRsZXdhcmUgd29uJ3QgYWxsb3cgdGhhdClcIiwgKCkgPT4ge1xuICAgIGNvbnN0IHByZXZTdGF0ZSA9IGdldFN0YXRlKFxuICAgICAgZmFsc2UsXG4gICAgICBhY3Rpb25FbnF1ZXVlZDEsXG4gICAgICBhY3Rpb25FbnF1ZXVlZDIsXG4gICAgICBhY3Rpb25FbnF1ZXVlZDMsXG4gICAgKTtcbiAgICBjb25zdCBhY3Rpb24gPSBhY3Rpb25DcmVhdG9ycy5kaXNtaXNzQWN0aW9uc0Zyb21RdWV1ZSgnTkFWSUdBVEVfQVdBWScpO1xuXG4gICAgZXhwZWN0KG5ldHdvcmtSZWR1Y2VyKHByZXZTdGF0ZSwgYWN0aW9uKSkudG9FcXVhbChcbiAgICAgIGdldFN0YXRlKGZhbHNlLCBhY3Rpb25FbnF1ZXVlZDEsIGFjdGlvbkVucXVldWVkMiwgYWN0aW9uRW5xdWV1ZWQzKSxcbiAgICApO1xuICB9KTtcbn0pO1xuXG5kZXNjcmliZSgnbmV0d29ya1NlbGVjdG9yJywgKCkgPT4ge1xuICBpdCgncmV0dXJucyB0aGUgY29ycmVjdCBzaGFwZScsICgpID0+IHtcbiAgICBjb25zdCBzdGF0ZTogeyBuZXR3b3JrOiBOZXR3b3JrU3RhdGUgfSA9IHtcbiAgICAgIG5ldHdvcms6IHtcbiAgICAgICAgaXNDb25uZWN0ZWQ6IHRydWUsXG4gICAgICAgIGFjdGlvblF1ZXVlOiBbeyB0eXBlOiAnZm9vJywgcGF5bG9hZDoge30gfV0sXG4gICAgICAgIGlzUXVldWVQYXVzZWQ6IGZhbHNlLFxuICAgICAgfSxcbiAgICB9O1xuICAgIGV4cGVjdChuZXR3b3JrU2VsZWN0b3Ioc3RhdGUpKS50b0VxdWFsKHtcbiAgICAgIGlzQ29ubmVjdGVkOiB0cnVlLFxuICAgICAgYWN0aW9uUXVldWU6IFt7IHR5cGU6ICdmb28nLCBwYXlsb2FkOiB7fSB9XSxcbiAgICAgIGlzUXVldWVQYXVzZWQ6IGZhbHNlLFxuICAgIH0pO1xuICB9KTtcbn0pO1xuIl19
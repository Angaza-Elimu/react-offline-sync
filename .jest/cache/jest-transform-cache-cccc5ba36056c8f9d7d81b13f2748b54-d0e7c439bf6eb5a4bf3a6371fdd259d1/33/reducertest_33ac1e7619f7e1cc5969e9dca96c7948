51479da9977a686330ee529b85adc703
var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _isEqual = _interopRequireDefault(require("lodash/isEqual"));

var actionCreators = _interopRequireWildcard(require("../redux/actionCreators"));

var _createReducer = _interopRequireWildcard(require("../redux/createReducer"));

var _getSimilarActionInQueue = _interopRequireDefault(require("../utils/getSimilarActionInQueue"));

var __assign = this && this.__assign || function () {
  __assign = Object.assign || function (t) {
    for (var s, i = 1, n = arguments.length; i < n; i++) {
      s = arguments[i];

      for (var p in s) {
        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];
      }
    }

    return t;
  };

  return __assign.apply(this, arguments);
};

var networkReducer = (0, _createReducer.default)();

var getState = function getState(isConnected) {
  if (isConnected === void 0) {
    isConnected = false;
  }

  var actionQueue = [];

  for (var _i = 1; _i < arguments.length; _i++) {
    actionQueue[_i - 1] = arguments[_i];
  }

  return {
    isConnected: isConnected,
    actionQueue: actionQueue,
    isQueuePaused: false
  };
};

var prevActionToRetry1 = {
  type: 'FETCH_DATA_REQUEST',
  payload: {
    id: '1'
  },
  meta: {
    retry: true
  }
};
var prevActionToRetry2 = {
  type: 'FETCH_OTHER_REQUEST',
  payload: {
    isFetching: true
  },
  meta: {
    retry: true
  }
};
var prevActionToRetry1WithDifferentPayload = {
  type: 'FETCH_DATA_REQUEST',
  payload: {
    id: '2'
  },
  meta: {
    retry: true
  }
};
describe('unknown action type', function () {
  it('returns prevState on initialization', function () {
    expect(networkReducer(undefined, {
      type: 'ACTION_I_DONT_CARE'
    })).toEqual(_createReducer.initialState);
  });
  it('returns prevState if the action is not handled', function () {
    expect(networkReducer(_createReducer.initialState, {
      type: 'ANOTHER_ACTION_I_DONT_CARE'
    })).toEqual(_createReducer.initialState);
  });
});
describe('CONNECTION_CHANGE action type', function () {
  it('changes isConnected state properly', function () {
    var mockAction = actionCreators.connectionChange(false);
    expect(networkReducer(_createReducer.initialState, mockAction)).toEqual({
      isConnected: false,
      actionQueue: [],
      isQueuePaused: false
    });
  });
});
describe('OFFLINE_ACTION action type', function () {
  describe('meta.retry !== true', function () {
    it('should NOT add the action to the queue', function () {
      var prevAction = {
        type: 'FETCH_DATA_REQUEST',
        payload: {
          id: '1'
        }
      };
      var anotherPrevAction = {
        type: 'FETCH_DATA_REQUEST',
        payload: {
          id: '1'
        },
        meta: {
          retry: false
        }
      };
      var action = actionCreators.fetchOfflineMode(prevAction);
      var anotherAction = actionCreators.fetchOfflineMode(anotherPrevAction);
      expect(networkReducer(_createReducer.initialState, action)).toEqual(_createReducer.initialState);
      expect(networkReducer(_createReducer.initialState, anotherAction)).toEqual(_createReducer.initialState);
    });
  });
  describe('meta.retry === true', function () {
    describe('actions with DIFFERENT type', function () {
      it('actions are pushed into the queue in order of arrival', function () {
        var preAction = actionCreators.connectionChange(false);
        var action1 = actionCreators.fetchOfflineMode(prevActionToRetry1);
        var prevState = networkReducer(_createReducer.initialState, preAction);
        var nextState = networkReducer(prevState, action1);
        expect(nextState).toEqual({
          isConnected: false,
          actionQueue: [prevActionToRetry1],
          isQueuePaused: false
        });
        var action2 = actionCreators.fetchOfflineMode(prevActionToRetry2);
        nextState = networkReducer(nextState, action2);
        expect(nextState).toEqual(getState(false, prevActionToRetry1, prevActionToRetry2));
      });
    });
    describe('thunks that are the same with custom comparison function', function () {
      function comparisonFn(action, actionQueue) {
        if (typeof action === 'object') {
          return actionQueue.find(function (queued) {
            return (0, _isEqual.default)(queued, action);
          });
        }

        if (typeof action === 'function') {
          return actionQueue.find(function (queued) {
            return action.meta.name === queued.meta.name && action.meta.args.id === queued.meta.args.id;
          });
        }

        return undefined;
      }

      var thunkFactory = function thunkFactory(id, name, age) {
        function thunk(dispatch) {
          dispatch({
            type: 'UPDATE_DATA_REQUEST',
            payload: {
              id: id,
              name: name,
              age: age
            }
          });
        }

        thunk.meta = {
          args: {
            id: id,
            name: name,
            age: age
          },
          retry: true
        };
        return thunk;
      };

      it("should add thunks if function is same but thunks are modifying different items", function () {
        var prevState = getState(false, thunkFactory(1, 'Bilbo', 55));
        var thunk = thunkFactory(2, 'Link', 54);
        var wrappedThunk = actionCreators.fetchOfflineMode(thunk);
        expect((0, _getSimilarActionInQueue.default)(thunk, prevState.actionQueue)).toEqual(prevState.actionQueue[0]);
        var nextState = (0, _createReducer.default)(comparisonFn)(prevState, wrappedThunk);
        expect(nextState.actionQueue).toHaveLength(2);
      });
      it("should replace a thunk if thunk already exists to modify same item", function () {
        var prevState = getState(false, thunkFactory(1, 'Bilbo', 55));
        var thunk = thunkFactory(1, 'Bilbo', 65);
        var wrappedThunk = actionCreators.fetchOfflineMode(thunk);
        expect((0, _getSimilarActionInQueue.default)(thunk, prevState.actionQueue)).toEqual(prevState.actionQueue[0]);
        var nextState = (0, _createReducer.default)(comparisonFn)(prevState, wrappedThunk);
        expect(nextState.actionQueue).toHaveLength(1);
      });
    });
    describe('actions with the same type', function () {
      it("should remove the action and add it back at the end of the queue\n   if the action has the same payload", function () {
        var prevState = getState(false, prevActionToRetry1, prevActionToRetry2);
        var action = actionCreators.fetchOfflineMode(prevActionToRetry1);
        var nextState = networkReducer(prevState, action);
        expect(nextState).toEqual(getState(false, prevActionToRetry2, prevActionToRetry1));
      });
      it("should push the action if the payload is different", function () {
        var prevState = getState(false, prevActionToRetry2, prevActionToRetry1);
        var action = actionCreators.fetchOfflineMode(prevActionToRetry1WithDifferentPayload);
        expect(networkReducer(prevState, action)).toEqual(getState(false, prevActionToRetry2, prevActionToRetry1, prevActionToRetry1WithDifferentPayload));
      });
    });
  });
});
describe('REMOVE_ACTION_FROM_QUEUE action type', function () {
  it('removes the action from the queue properly', function () {
    var prevState = getState(false, prevActionToRetry2, prevActionToRetry1, prevActionToRetry1WithDifferentPayload);
    var action = actionCreators.removeActionFromQueue(__assign({}, prevActionToRetry2));
    expect(networkReducer(prevState, action)).toEqual(getState(false, prevActionToRetry1, prevActionToRetry1WithDifferentPayload));
  });
});
describe('QUEUE_SEMAPHORE_CHANGE action type', function () {
  it('Pauses the queue if semaphore is red', function () {
    expect(networkReducer(undefined, actionCreators.changeQueueSemaphore('RED'))).toEqual(__assign(__assign({}, _createReducer.initialState), {
      isQueuePaused: true
    }));
  });
  it('Resumes the queue if semaphore is green', function () {
    expect(networkReducer(undefined, actionCreators.changeQueueSemaphore('GREEN'))).toEqual(__assign(__assign({}, _createReducer.initialState), {
      isQueuePaused: false
    }));
  });
});
describe('thunks', function () {
  function fetchThunk(dispatch) {
    dispatch({
      type: 'FETCH_DATA_REQUEST'
    });
  }

  describe('FETCH_OFFLINE_MODE action type', function () {
    describe('action with meta.retry !== true', function () {
      it('should NOT add the action to the queue', function () {
        var action = actionCreators.fetchOfflineMode(fetchThunk);
        expect(networkReducer(_createReducer.initialState, action)).toEqual(_createReducer.initialState);
      });
    });
    describe('action with meta.retry === true', function () {
      it('should add the action to the queue if the thunk is different', function () {
        var prevState = getState(false);
        fetchThunk.meta = {
          retry: true
        };
        var action = actionCreators.fetchOfflineMode(fetchThunk);
        expect(networkReducer(prevState, action)).toEqual(getState(false, fetchThunk));
      });
      it("should remove the thunk and add it back at the end of the queue \n      if it presents the same shape", function () {
        var thunkFactory = function thunkFactory(param) {
          function thunk1(dispatch) {
            dispatch({
              type: 'FETCH_DATA_REQUEST',
              payload: param
            });
          }

          return thunk1;
        };

        var thunk = thunkFactory('foo');
        var prevState = getState(false, thunk);
        var similarThunk = thunkFactory('bar');
        similarThunk.meta = {
          retry: true
        };
        var action = actionCreators.fetchOfflineMode(similarThunk);
        var nextState = networkReducer(prevState, action);
        expect(nextState).toEqual(getState(false, similarThunk));
      });
    });
  });
  describe('REMOVE_ACTION_FROM_QUEUE action type', function () {
    it('removes the thunk from the queue properly', function () {
      var prevState = getState(false, fetchThunk);
      var action = actionCreators.removeActionFromQueue(fetchThunk);
      expect(networkReducer(prevState, action)).toEqual(getState(false));
    });
  });
});
describe('dismiss feature', function () {
  var actionEnqueued1 = {
    type: 'FETCH_PAGE_REQUEST',
    payload: {
      id: '2'
    },
    meta: {
      retry: true,
      dismiss: ['NAVIGATE_BACK', 'NAVIGATE_TO_LOGIN']
    }
  };
  var actionEnqueued2 = {
    type: 'FETCH_USER_REQUEST',
    payload: {
      id: '4'
    },
    meta: {
      retry: true,
      dismiss: ['NAVIGATE_TO_LOGIN']
    }
  };
  var actionEnqueued3 = {
    type: 'FETCH_USER_REQUEST',
    payload: {
      id: '4'
    },
    meta: {
      retry: true
    }
  };
  it('NAVIGATE_BACK dispatched, dismissing 1 action', function () {
    var prevState = getState(false, actionEnqueued1, actionEnqueued2, actionEnqueued3);
    var action = actionCreators.dismissActionsFromQueue('NAVIGATE_BACK');
    expect(networkReducer(prevState, action)).toEqual(getState(false, actionEnqueued2, actionEnqueued3));
  });
  it('NAVIGATE_TO_LOGIN dispatched, dismissing 2 actions', function () {
    var prevState = getState(false, actionEnqueued1, actionEnqueued2, actionEnqueued3);
    var action = actionCreators.dismissActionsFromQueue('NAVIGATE_TO_LOGIN');
    expect(networkReducer(prevState, action)).toEqual(getState(false, actionEnqueued3));
  });
  it("Any other action dispatched, no changes (although the middleware won't allow that)", function () {
    var prevState = getState(false, actionEnqueued1, actionEnqueued2, actionEnqueued3);
    var action = actionCreators.dismissActionsFromQueue('NAVIGATE_AWAY');
    expect(networkReducer(prevState, action)).toEqual(getState(false, actionEnqueued1, actionEnqueued2, actionEnqueued3));
  });
});
describe('networkSelector', function () {
  it('returns the correct shape', function () {
    var state = {
      network: {
        isConnected: true,
        actionQueue: [{
          type: 'foo',
          payload: {}
        }],
        isQueuePaused: false
      }
    };
    expect((0, _createReducer.networkSelector)(state)).toEqual({
      isConnected: true,
      actionQueue: [{
        type: 'foo',
        payload: {}
      }],
      isQueuePaused: false
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9EZXZBQy9EZXNrdG9wL0FuZ2F6YS9yZWFjdC1vZmZsaW5lLXN5bmMvc3JjL3Rlc3QvcmVkdWNlci50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFDQTs7QUFDQTs7QUFFQTs7QUFJQTs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRUEsSUFBTSxjQUFjLEdBQUcsNkJBQXZCOztBQUVBLElBQU0sUUFBUSxHQUFHLFNBQVgsUUFBVyxDQUFDLFdBQUQsRUFBb0I7QUFBbkIsTUFBQSxXQUFBLEtBQUEsS0FBQSxDQUFBLEVBQUE7QUFBQSxJQUFBLFdBQUEsR0FBQSxLQUFBO0FBQW1COztBQUFFLE1BQUEsV0FBQSxHQUFBLEVBQUE7O09BQUEsSUFBQSxFQUFBLEdBQUEsQyxFQUFBLEVBQUEsR0FBQSxTQUFBLENBQUEsTSxFQUFBLEVBQUEsRSxFQUFnQztBQUFoQyxJQUFBLFdBQUEsQ0FBQSxFQUFBLEdBQUEsQ0FBQSxDQUFBLEdBQUEsU0FBQSxDQUFBLEVBQUEsQ0FBQTs7O0FBQXFDLFNBQUM7QUFDM0UsSUFBQSxXQUFXLEVBQUEsV0FEZ0U7QUFFM0UsSUFBQSxXQUFXLEVBQUEsV0FGZ0U7QUFHM0UsSUFBQSxhQUFhLEVBQUU7QUFINEQsR0FBRDtBQUkxRSxDQUpGOztBQU9BLElBQU0sa0JBQWtCLEdBQUc7QUFDekIsRUFBQSxJQUFJLEVBQUUsb0JBRG1CO0FBRXpCLEVBQUEsT0FBTyxFQUFFO0FBQ1AsSUFBQSxFQUFFLEVBQUU7QUFERyxHQUZnQjtBQUt6QixFQUFBLElBQUksRUFBRTtBQUNKLElBQUEsS0FBSyxFQUFFO0FBREg7QUFMbUIsQ0FBM0I7QUFTQSxJQUFNLGtCQUFrQixHQUFHO0FBQ3pCLEVBQUEsSUFBSSxFQUFFLHFCQURtQjtBQUV6QixFQUFBLE9BQU8sRUFBRTtBQUNQLElBQUEsVUFBVSxFQUFFO0FBREwsR0FGZ0I7QUFLekIsRUFBQSxJQUFJLEVBQUU7QUFDSixJQUFBLEtBQUssRUFBRTtBQURIO0FBTG1CLENBQTNCO0FB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QUdELEdBWkMsQ0FBRjtBQWFELENBeEVPLENBQVI7QUEwRUEsUUFBUSxDQUFDLGlCQUFELEVBQW9CLFlBQUE7QUFDMUIsRUFBQSxFQUFFLENBQUMsMkJBQUQsRUFBOEIsWUFBQTtBQUM5QixRQUFNLEtBQUssR0FBOEI7QUFDdkMsTUFBQSxPQUFPLEVBQUU7QUFDUCxRQUFBLFdBQVcsRUFBRSxJQUROO0FBRVAsUUFBQSxXQUFXLEVBQUUsQ0FBQztBQUFFLFVBQUEsSUFBSSxFQUFFLEtBQVI7QUFBZSxVQUFBLE9BQU8sRUFBRTtBQUF4QixTQUFELENBRk47QUFHUCxRQUFBLGFBQWEsRUFBRTtBQUhSO0FBRDhCLEtBQXpDO0FBT0EsSUFBQSxNQUFNLENBQUMsb0NBQWdCLEtBQWhCLENBQUQsQ0FBTixDQUErQixPQUEvQixDQUF1QztBQUNyQyxNQUFBLFdBQVcsRUFBRSxJQUR3QjtBQUVyQyxNQUFBLFdBQVcsRUFBRSxDQUFDO0FBQUUsUUFBQSxJQUFJLEVBQUUsS0FBUjtBQUFlLFFBQUEsT0FBTyxFQUFFO0FBQXhCLE9BQUQsQ0FGd0I7QUFHckMsTUFBQSxhQUFhLEVBQUU7QUFIc0IsS0FBdkM7QUFLRCxHQWJDLENBQUY7QUFjRCxDQWZPLENBQVIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEaXNwYXRjaCB9IGZyb20gJ3JlZHV4JztcbmltcG9ydCBpc0VxdWFsIGZyb20gJ2xvZGFzaC9pc0VxdWFsJztcbmltcG9ydCAqIGFzIGFjdGlvbkNyZWF0b3JzIGZyb20gJy4uL3NyYy9yZWR1eC9hY3Rpb25DcmVhdG9ycyc7XG5pbXBvcnQgeyBFbnF1ZXVlZEFjdGlvbiwgTmV0d29ya1N0YXRlIH0gZnJvbSAnLi4vc3JjL3R5cGVzJztcbmltcG9ydCBjcmVhdGVSZWR1Y2VyLCB7XG4gIGluaXRpYWxTdGF0ZSxcbiAgbmV0d29ya1NlbGVjdG9yLFxufSBmcm9tICcuLi9zcmMvcmVkdXgvY3JlYXRlUmVkdWNlcic7XG5pbXBvcnQgZ2V0U2ltaWxhckFjdGlvbkluUXVldWUgZnJvbSAnLi4vc3JjL3V0aWxzL2dldFNpbWlsYXJBY3Rpb25JblF1ZXVlJztcblxuY29uc3QgbmV0d29ya1JlZHVjZXIgPSBjcmVhdGVSZWR1Y2VyKCk7XG5cbmNvbnN0IGdldFN0YXRlID0gKGlzQ29ubmVjdGVkID0gZmFsc2UsIC4uLmFjdGlvblF1ZXVlOiBFbnF1ZXVlZEFjdGlvbltdKSA9PiAoe1xuICBpc0Nvbm5lY3RlZCxcbiAgYWN0aW9uUXVldWUsXG4gIGlzUXVldWVQYXVzZWQ6IGZhbHNlLFxufSk7XG5cbi8qKiBBY3Rpb25zIHVzZWQgZnJvbSBub3cgb24gdG8gdGVzdCBkaWZmZXJlbnQgc2NlbmFyaW9zICovXG5jb25zdCBwcmV2QWN0aW9uVG9SZXRyeTEgPSB7XG4gIHR5cGU6ICdGRVRDSF9EQVRBX1JFUVVFU1QnLFxuICBwYXlsb2FkOiB7XG4gICAgaWQ6ICcxJyxcbiAgfSxcbiAgbWV0YToge1xuICAgIHJldHJ5OiB0cnVlLFxuICB9LFxufTtcbmNvbnN0IHByZXZBY3Rpb25Ub1JldHJ5MiA9IHtcbiAgdHlwZTogJ0ZFVENIX09USEVSX1JFUVVFU1QnLFxuICBwYXlsb2FkOiB7XG4gICAgaXNGZXRjaGluZzogdHJ1ZSxcbiAgfSxcbiAgbWV0YToge1xuICAgIHJldHJ5OiB0cnVlLFxuICB9LFxufTtcbmNvbnN0IHByZXZBY3Rpb25Ub1JldHJ5MVdpdGhEaWZmZXJlbnRQYXlsb2FkID0ge1xuICB0eXBlOiAnRkVUQ0hfREFUQV9SRVFVRVNUJyxcbiAgcGF5bG9hZDoge1xuICAgIGlkOiAnMicsXG4gIH0sXG4gIG1ldGE6IHtcbiAgICByZXRyeTogdHJ1ZSxcbiAgfSxcbn07XG5cbmRlc2NyaWJlKCd1bmtub3duIGFjdGlvbiB0eXBlJywgKCkgPT4ge1xuICBpdCgncmV0dXJucyBwcmV2U3RhdGUgb24gaW5pdGlhbGl6YXRpb24nLCAoKSA9PiB7XG4gICAgZXhwZWN0KG5ldHdvcmtSZWR1Y2VyKHVuZGVmaW5lZCwgeyB0eXBlOiAnQUNUSU9OX0lfRE9OVF9DQVJFJyB9KSkudG9FcXVhbChcbiAgICAgIGluaXRpYWxTdGF0ZSxcbiAgICApO1xuICB9KTtcblxuICBpdCgncmV0dXJucyBwcmV2U3RhdGUgaWYgdGhlIGFjdGlvbiBpcyBub3QgaGFuZGxlZCcsICgpID0+IHtcbiAgICBleHBlY3QoXG4gICAgICBuZXR3b3JrUmVkdWNlcihpbml0aWFsU3RhdGUsIHsgdHlwZTogJ0FOT1RIRVJfQUNUSU9OX0lfRE9OVF9DQVJFJyB9KSxcbiAgICApLnRvRXF1YWwoaW5pdGlhbFN0YXRlKTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ0NPTk5FQ1RJT05fQ0hBTkdFIGFjdGlvbiB0eXBlJywgKCkgPT4ge1xuICBpdCgnY2hhbmdlcyBpc0Nvbm5lY3RlZCBzdGF0ZSBwcm9wZXJseScsICgpID0+IHtcbiAgICBjb25zdCBtb2NrQWN0aW9uID0gYWN0aW9uQ3JlYXRvcnMuY29ubmVjdGlvbkNoYW5nZShmYWxzZSk7XG4gICAgZXhwZWN0KG5ldHdvcmtSZWR1Y2VyKGluaXRpYWxTdGF0ZSwgbW9ja0FjdGlvbikpLnRvRXF1YWwoe1xuICAgICAgaXNDb25uZWN0ZWQ6IGZhbHNlLFxuICAgICAgYWN0aW9uUXVldWU6IFtdLFxuICAgICAgaXNRdWV1ZVBhdXNlZDogZmFsc2UsXG4gICAgfSk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdPRkZMSU5FX0FDVElPTiBhY3Rpb24gdHlwZScsICgpID0+IHtcbiAgZGVzY3JpYmUoJ21ldGEucmV0cnkgIT09IHRydWUnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBOT1QgYWRkIHRoZSBhY3Rpb24gdG8gdGhlIHF1ZXVlJywgKCkgPT4ge1xuICAgICAgY29uc3QgcHJldkFjdGlvbiA9IHtcbiAgICAgICAgdHlwZTogJ0ZFVENIX0RBVEFfUkVRVUVTVCcsXG4gICAgICAgIHBheWxvYWQ6IHtcbiAgICAgICAgICBpZDogJzEnLFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICAgIGNvbnN0IGFub3RoZXJQcmV2QWN0aW9uID0ge1xuICAgICAgICB0eXBlOiAnRkVUQ0hfREFUQV9SRVFVRVNUJyxcbiAgICAgICAgcGF5bG9hZDoge1xuICAgICAgICAgIGlkOiAnMScsXG4gICAgICAgIH0sXG4gICAgICAgIG1ldGE6IHtcbiAgICAgICAgICByZXRyeTogZmFsc2UsXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBhY3Rpb24gPSBhY3Rpb25DcmVhdG9ycy5mZXRjaE9mZmxpbmVNb2RlKHByZXZBY3Rpb24pO1xuICAgICAgY29uc3QgYW5vdGhlckFjdGlvbiA9IGFjdGlvbkNyZWF0b3JzLmZldGNoT2ZmbGluZU1vZGUoYW5vdGhlclByZXZBY3Rpb24pO1xuXG4gICAgICBleHBlY3QobmV0d29ya1JlZHVjZXIoaW5pdGlhbFN0YXRlLCBhY3Rpb24pKS50b0VxdWFsKGluaXRpYWxTdGF0ZSk7XG4gICAgICBleHBlY3QobmV0d29ya1JlZHVjZXIoaW5pdGlhbFN0YXRlLCBhbm90aGVyQWN0aW9uKSkudG9FcXVhbChpbml0aWFsU3RhdGUpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnbWV0YS5yZXRyeSA9PT0gdHJ1ZScsICgpID0+IHtcbiAgICBkZXNjcmliZSgnYWN0aW9ucyB3aXRoIERJRkZFUkVOVCB0eXBlJywgKCkgPT4ge1xuICAgICAgaXQoJ2FjdGlvbnMgYXJlIHB1c2hlZCBpbnRvIHRoZSBxdWV1ZSBpbiBvcmRlciBvZiBhcnJpdmFsJywgKCkgPT4ge1xuICAgICAgICBjb25zdCBwcmVBY3Rpb24gPSBhY3Rpb25DcmVhdG9ycy5jb25uZWN0aW9uQ2hhbmdlKGZhbHNlKTtcbiAgICAgICAgY29uc3QgYWN0aW9uMSA9IGFjdGlvbkNyZWF0b3JzLmZldGNoT2ZmbGluZU1vZGUocHJldkFjdGlvblRvUmV0cnkxKTtcbiAgICAgICAgY29uc3QgcHJldlN0YXRlID0gbmV0d29ya1JlZHVjZXIoaW5pdGlhbFN0YXRlLCBwcmVBY3Rpb24pO1xuXG4gICAgICAgIGxldCBuZXh0U3RhdGUgPSBuZXR3b3JrUmVkdWNlcihwcmV2U3RhdGUsIGFjdGlvbjEpO1xuXG4gICAgICAgIGV4cGVjdChuZXh0U3RhdGUpLnRvRXF1YWwoe1xuICAgICAgICAgIGlzQ29ubmVjdGVkOiBmYWxzZSxcbiAgICAgICAgICBhY3Rpb25RdWV1ZTogW3ByZXZBY3Rpb25Ub1JldHJ5MV0sXG4gICAgICAgICAgaXNRdWV1ZVBhdXNlZDogZmFsc2UsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGFjdGlvbjIgPSBhY3Rpb25DcmVhdG9ycy5mZXRjaE9mZmxpbmVNb2RlKHByZXZBY3Rpb25Ub1JldHJ5Mik7XG4gICAgICAgIG5leHRTdGF0ZSA9IG5ldHdvcmtSZWR1Y2VyKG5leHRTdGF0ZSwgYWN0aW9uMik7XG5cbiAgICAgICAgZXhwZWN0KG5leHRTdGF0ZSkudG9FcXVhbChcbiAgICAgICAgICBnZXRTdGF0ZShmYWxzZSwgcHJldkFjdGlvblRvUmV0cnkxLCBwcmV2QWN0aW9uVG9SZXRyeTIpLFxuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgndGh1bmtzIHRoYXQgYXJlIHRoZSBzYW1lIHdpdGggY3VzdG9tIGNvbXBhcmlzb24gZnVuY3Rpb24nLCAoKSA9PiB7XG4gICAgICBmdW5jdGlvbiBjb21wYXJpc29uRm4oYWN0aW9uOiBhbnksIGFjdGlvblF1ZXVlOiBFbnF1ZXVlZEFjdGlvbltdKSB7XG4gICAgICAgIGlmICh0eXBlb2YgYWN0aW9uID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgIHJldHVybiBhY3Rpb25RdWV1ZS5maW5kKHF1ZXVlZCA9PiBpc0VxdWFsKHF1ZXVlZCwgYWN0aW9uKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiBhY3Rpb24gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICByZXR1cm4gYWN0aW9uUXVldWUuZmluZChcbiAgICAgICAgICAgIHF1ZXVlZCA9PlxuICAgICAgICAgICAgICBhY3Rpb24ubWV0YS5uYW1lID09PSBxdWV1ZWQubWV0YSEubmFtZSAmJlxuICAgICAgICAgICAgICBhY3Rpb24ubWV0YS5hcmdzLmlkID09PSBxdWV1ZWQubWV0YSEuYXJncy5pZCxcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHRodW5rRmFjdG9yeSA9IChpZDogbnVtYmVyLCBuYW1lOiBzdHJpbmcsIGFnZTogbnVtYmVyKSA9PiB7XG4gICAgICAgIGZ1bmN0aW9uIHRodW5rKGRpc3BhdGNoOiBEaXNwYXRjaCkge1xuICAgICAgICAgIGRpc3BhdGNoKHsgdHlwZTogJ1VQREFURV9EQVRBX1JFUVVFU1QnLCBwYXlsb2FkOiB7IGlkLCBuYW1lLCBhZ2UgfSB9KTtcbiAgICAgICAgfVxuICAgICAgICB0aHVuay5tZXRhID0ge1xuICAgICAgICAgIGFyZ3M6IHsgaWQsIG5hbWUsIGFnZSB9LFxuICAgICAgICAgIHJldHJ5OiB0cnVlLFxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gdGh1bms7XG4gICAgICB9O1xuXG4gICAgICBpdChgc2hvdWxkIGFkZCB0aHVua3MgaWYgZnVuY3Rpb24gaXMgc2FtZSBidXQgdGh1bmtzIGFyZSBtb2RpZnlpbmcgZGlmZmVyZW50IGl0ZW1zYCwgKCkgPT4ge1xuICAgICAgICBjb25zdCBwcmV2U3RhdGUgPSBnZXRTdGF0ZShmYWxzZSwgdGh1bmtGYWN0b3J5KDEsICdCaWxibycsIDU1KSk7XG4gICAgICAgIGNvbnN0IHRodW5rID0gdGh1bmtGYWN0b3J5KDIsICdMaW5rJywgNTQpO1xuICAgICAgICBjb25zdCB3cmFwcGVkVGh1bmsgPSBhY3Rpb25DcmVhdG9ycy5mZXRjaE9mZmxpbmVNb2RlKHRodW5rKTtcblxuICAgICAgICBleHBlY3QoZ2V0U2ltaWxhckFjdGlvbkluUXVldWUodGh1bmssIHByZXZTdGF0ZS5hY3Rpb25RdWV1ZSkpLnRvRXF1YWwoXG4gICAgICAgICAgcHJldlN0YXRlLmFjdGlvblF1ZXVlWzBdLFxuICAgICAgICApO1xuXG4gICAgICAgIGNvbnN0IG5leHRTdGF0ZSA9IGNyZWF0ZVJlZHVjZXIoY29tcGFyaXNvbkZuKShwcmV2U3RhdGUsIHdyYXBwZWRUaHVuayk7XG5cbiAgICAgICAgZXhwZWN0KG5leHRTdGF0ZS5hY3Rpb25RdWV1ZSkudG9IYXZlTGVuZ3RoKDIpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KGBzaG91bGQgcmVwbGFjZSBhIHRodW5rIGlmIHRodW5rIGFscmVhZHkgZXhpc3RzIHRvIG1vZGlmeSBzYW1lIGl0ZW1gLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHByZXZTdGF0ZSA9IGdldFN0YXRlKGZhbHNlLCB0aHVua0ZhY3RvcnkoMSwgJ0JpbGJvJywgNTUpKTtcbiAgICAgICAgY29uc3QgdGh1bmsgPSB0aHVua0ZhY3RvcnkoMSwgJ0JpbGJvJywgNjUpO1xuICAgICAgICBjb25zdCB3cmFwcGVkVGh1bmsgPSBhY3Rpb25DcmVhdG9ycy5mZXRjaE9mZmxpbmVNb2RlKHRodW5rKTtcblxuICAgICAgICBleHBlY3QoZ2V0U2ltaWxhckFjdGlvbkluUXVldWUodGh1bmssIHByZXZTdGF0ZS5hY3Rpb25RdWV1ZSkpLnRvRXF1YWwoXG4gICAgICAgICAgcHJldlN0YXRlLmFjdGlvblF1ZXVlWzBdLFxuICAgICAgICApO1xuXG4gICAgICAgIGNvbnN0IG5leHRTdGF0ZSA9IGNyZWF0ZVJlZHVjZXIoY29tcGFyaXNvbkZuKShwcmV2U3RhdGUsIHdyYXBwZWRUaHVuayk7XG5cbiAgICAgICAgZXhwZWN0KG5leHRTdGF0ZS5hY3Rpb25RdWV1ZSkudG9IYXZlTGVuZ3RoKDEpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnYWN0aW9ucyB3aXRoIHRoZSBzYW1lIHR5cGUnLCAoKSA9PiB7XG4gICAgICBpdChgc2hvdWxkIHJlbW92ZSB0aGUgYWN0aW9uIGFuZCBhZGQgaXQgYmFjayBhdCB0aGUgZW5kIG9mIHRoZSBxdWV1ZVxuICAgaWYgdGhlIGFjdGlvbiBoYXMgdGhlIHNhbWUgcGF5bG9hZGAsICgpID0+IHtcbiAgICAgICAgY29uc3QgcHJldlN0YXRlID0gZ2V0U3RhdGUoXG4gICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgcHJldkFjdGlvblRvUmV0cnkxLFxuICAgICAgICAgIHByZXZBY3Rpb25Ub1JldHJ5MixcbiAgICAgICAgKTtcbiAgICAgICAgY29uc3QgYWN0aW9uID0gYWN0aW9uQ3JlYXRvcnMuZmV0Y2hPZmZsaW5lTW9kZShwcmV2QWN0aW9uVG9SZXRyeTEpO1xuXG4gICAgICAgIGNvbnN0IG5leHRTdGF0ZSA9IG5ldHdvcmtSZWR1Y2VyKHByZXZTdGF0ZSwgYWN0aW9uKTtcbiAgICAgICAgZXhwZWN0KG5leHRTdGF0ZSkudG9FcXVhbChcbiAgICAgICAgICBnZXRTdGF0ZShmYWxzZSwgcHJldkFjdGlvblRvUmV0cnkyLCBwcmV2QWN0aW9uVG9SZXRyeTEpLFxuICAgICAgICApO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KGBzaG91bGQgcHVzaCB0aGUgYWN0aW9uIGlmIHRoZSBwYXlsb2FkIGlzIGRpZmZlcmVudGAsICgpID0+IHtcbiAgICAgICAgY29uc3QgcHJldlN0YXRlID0gZ2V0U3RhdGUoXG4gICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgcHJldkFjdGlvblRvUmV0cnkyLFxuICAgICAgICAgIHByZXZBY3Rpb25Ub1JldHJ5MSxcbiAgICAgICAgKTtcbiAgICAgICAgY29uc3QgYWN0aW9uID0gYWN0aW9uQ3JlYXRvcnMuZmV0Y2hPZmZsaW5lTW9kZShcbiAgICAgICAgICBwcmV2QWN0aW9uVG9SZXRyeTFXaXRoRGlmZmVyZW50UGF5bG9hZCxcbiAgICAgICAgKTtcblxuICAgICAgICBleHBlY3QobmV0d29ya1JlZHVjZXIocHJldlN0YXRlLCBhY3Rpb24pKS50b0VxdWFsKFxuICAgICAgICAgIGdldFN0YXRlKFxuICAgICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgICBwcmV2QWN0aW9uVG9SZXRyeTIsXG4gICAgICAgICAgICBwcmV2QWN0aW9uVG9SZXRyeTEsXG4gICAgICAgICAgICBwcmV2QWN0aW9uVG9SZXRyeTFXaXRoRGlmZmVyZW50UGF5bG9hZCxcbiAgICAgICAgICApLFxuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdSRU1PVkVfQUNUSU9OX0ZST01fUVVFVUUgYWN0aW9uIHR5cGUnLCAoKSA9PiB7XG4gIGl0KCdyZW1vdmVzIHRoZSBhY3Rpb24gZnJvbSB0aGUgcXVldWUgcHJvcGVybHknLCAoKSA9PiB7XG4gICAgY29uc3QgcHJldlN0YXRlID0gZ2V0U3RhdGUoXG4gICAgICBmYWxzZSxcbiAgICAgIHByZXZBY3Rpb25Ub1JldHJ5MixcbiAgICAgIHByZXZBY3Rpb25Ub1JldHJ5MSxcbiAgICAgIHByZXZBY3Rpb25Ub1JldHJ5MVdpdGhEaWZmZXJlbnRQYXlsb2FkLFxuICAgICk7XG4gICAgLy8gRGlmZmVyZW50IG9iamVjdCByZWZlcmVuY2VzIGJ1dCBzYW1lIHNoYXBlLCBjaGVja2luZyB0aGF0IGRlZXAgZXF1YWwgd29ya3MgY29ycmVjdGx5XG4gICAgY29uc3QgYWN0aW9uID0gYWN0aW9uQ3JlYXRvcnMucmVtb3ZlQWN0aW9uRnJvbVF1ZXVlKHtcbiAgICAgIC4uLnByZXZBY3Rpb25Ub1JldHJ5MixcbiAgICB9KTtcblxuICAgIGV4cGVjdChuZXR3b3JrUmVkdWNlcihwcmV2U3RhdGUsIGFjdGlvbikpLnRvRXF1YWwoXG4gICAgICBnZXRTdGF0ZShcbiAgICAgICAgZmFsc2UsXG4gICAgICAgIHByZXZBY3Rpb25Ub1JldHJ5MSxcbiAgICAgICAgcHJldkFjdGlvblRvUmV0cnkxV2l0aERpZmZlcmVudFBheWxvYWQsXG4gICAgICApLFxuICAgICk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdRVUVVRV9TRU1BUEhPUkVfQ0hBTkdFIGFjdGlvbiB0eXBlJywgKCkgPT4ge1xuICBpdCgnUGF1c2VzIHRoZSBxdWV1ZSBpZiBzZW1hcGhvcmUgaXMgcmVkJywgKCkgPT4ge1xuICAgIGV4cGVjdChcbiAgICAgIG5ldHdvcmtSZWR1Y2VyKHVuZGVmaW5lZCwgYWN0aW9uQ3JlYXRvcnMuY2hhbmdlUXVldWVTZW1hcGhvcmUoJ1JFRCcpKSxcbiAgICApLnRvRXF1YWwoe1xuICAgICAgLi4uaW5pdGlhbFN0YXRlLFxuICAgICAgaXNRdWV1ZVBhdXNlZDogdHJ1ZSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgaXQoJ1Jlc3VtZXMgdGhlIHF1ZXVlIGlmIHNlbWFwaG9yZSBpcyBncmVlbicsICgpID0+IHtcbiAgICBleHBlY3QoXG4gICAgICBuZXR3b3JrUmVkdWNlcih1bmRlZmluZWQsIGFjdGlvbkNyZWF0b3JzLmNoYW5nZVF1ZXVlU2VtYXBob3JlKCdHUkVFTicpKSxcbiAgICApLnRvRXF1YWwoe1xuICAgICAgLi4uaW5pdGlhbFN0YXRlLFxuICAgICAgaXNRdWV1ZVBhdXNlZDogZmFsc2UsXG4gICAgfSk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCd0aHVua3MnLCAoKSA9PiB7XG4gIGZ1bmN0aW9uIGZldGNoVGh1bmsoZGlzcGF0Y2g6IERpc3BhdGNoKSB7XG4gICAgZGlzcGF0Y2goeyB0eXBlOiAnRkVUQ0hfREFUQV9SRVFVRVNUJyB9KTtcbiAgfVxuXG4gIGRlc2NyaWJlKCdGRVRDSF9PRkZMSU5FX01PREUgYWN0aW9uIHR5cGUnLCAoKSA9PiB7XG4gICAgZGVzY3JpYmUoJ2FjdGlvbiB3aXRoIG1ldGEucmV0cnkgIT09IHRydWUnLCAoKSA9PiB7XG4gICAgICBpdCgnc2hvdWxkIE5PVCBhZGQgdGhlIGFjdGlvbiB0byB0aGUgcXVldWUnLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGFjdGlvbiA9IGFjdGlvbkNyZWF0b3JzLmZldGNoT2ZmbGluZU1vZGUoZmV0Y2hUaHVuayk7XG4gICAgICAgIGV4cGVjdChuZXR3b3JrUmVkdWNlcihpbml0aWFsU3RhdGUsIGFjdGlvbikpLnRvRXF1YWwoaW5pdGlhbFN0YXRlKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2FjdGlvbiB3aXRoIG1ldGEucmV0cnkgPT09IHRydWUnLCAoKSA9PiB7XG4gICAgICBpdCgnc2hvdWxkIGFkZCB0aGUgYWN0aW9uIHRvIHRoZSBxdWV1ZSBpZiB0aGUgdGh1bmsgaXMgZGlmZmVyZW50JywgKCkgPT4ge1xuICAgICAgICBjb25zdCBwcmV2U3RhdGUgPSBnZXRTdGF0ZShmYWxzZSk7XG5cbiAgICAgICAgLy8gUHJvcGVydHkgJ21ldGEnIGRvZXMgbm90IGV4aXN0IG9uIHR5cGUgJyhkaXNwYXRjaDogRGlzcGF0Y2g8QW55QWN0aW9uPikgPT4gdm9pZCdcbiAgICAgICAgKGZldGNoVGh1bmsgYXMgYW55KS5tZXRhID0ge1xuICAgICAgICAgIHJldHJ5OiB0cnVlLFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBhY3Rpb24gPSBhY3Rpb25DcmVhdG9ycy5mZXRjaE9mZmxpbmVNb2RlKGZldGNoVGh1bmspO1xuXG4gICAgICAgIGV4cGVjdChuZXR3b3JrUmVkdWNlcihwcmV2U3RhdGUsIGFjdGlvbikpLnRvRXF1YWwoXG4gICAgICAgICAgZ2V0U3RhdGUoZmFsc2UsIGZldGNoVGh1bmspLFxuICAgICAgICApO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KGBzaG91bGQgcmVtb3ZlIHRoZSB0aHVuayBhbmQgYWRkIGl0IGJhY2sgYXQgdGhlIGVuZCBvZiB0aGUgcXVldWUgXG4gICAgICBpZiBpdCBwcmVzZW50cyB0aGUgc2FtZSBzaGFwZWAsICgpID0+IHtcbiAgICAgICAgY29uc3QgdGh1bmtGYWN0b3J5ID0gKHBhcmFtOiBhbnkpID0+IHtcbiAgICAgICAgICBmdW5jdGlvbiB0aHVuazEoZGlzcGF0Y2g6IERpc3BhdGNoKSB7XG4gICAgICAgICAgICBkaXNwYXRjaCh7IHR5cGU6ICdGRVRDSF9EQVRBX1JFUVVFU1QnLCBwYXlsb2FkOiBwYXJhbSB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHRodW5rMTtcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgdGh1bmsgPSB0aHVua0ZhY3RvcnkoJ2ZvbycpO1xuICAgICAgICBjb25zdCBwcmV2U3RhdGUgPSBnZXRTdGF0ZShmYWxzZSwgdGh1bmspO1xuXG4gICAgICAgIGNvbnN0IHNpbWlsYXJUaHVuayA9IHRodW5rRmFjdG9yeSgnYmFyJyk7XG4gICAgICAgIChzaW1pbGFyVGh1bmsgYXMgYW55KS5tZXRhID0ge1xuICAgICAgICAgIHJldHJ5OiB0cnVlLFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBhY3Rpb24gPSBhY3Rpb25DcmVhdG9ycy5mZXRjaE9mZmxpbmVNb2RlKHNpbWlsYXJUaHVuayk7XG4gICAgICAgIGNvbnN0IG5leHRTdGF0ZSA9IG5ldHdvcmtSZWR1Y2VyKHByZXZTdGF0ZSwgYWN0aW9uKTtcblxuICAgICAgICBleHBlY3QobmV4dFN0YXRlKS50b0VxdWFsKGdldFN0YXRlKGZhbHNlLCBzaW1pbGFyVGh1bmspKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUkVNT1ZFX0FDVElPTl9GUk9NX1FVRVVFIGFjdGlvbiB0eXBlJywgKCkgPT4ge1xuICAgIGl0KCdyZW1vdmVzIHRoZSB0aHVuayBmcm9tIHRoZSBxdWV1ZSBwcm9wZXJseScsICgpID0+IHtcbiAgICAgIGNvbnN0IHByZXZTdGF0ZSA9IGdldFN0YXRlKGZhbHNlLCBmZXRjaFRodW5rKTtcbiAgICAgIGNvbnN0IGFjdGlvbiA9IGFjdGlvbkNyZWF0b3JzLnJlbW92ZUFjdGlvbkZyb21RdWV1ZShmZXRjaFRodW5rKTtcblxuICAgICAgZXhwZWN0KG5ldHdvcmtSZWR1Y2VyKHByZXZTdGF0ZSwgYWN0aW9uKSkudG9FcXVhbChnZXRTdGF0ZShmYWxzZSkpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuXG5kZXNjcmliZSgnZGlzbWlzcyBmZWF0dXJlJywgKCkgPT4ge1xuICBjb25zdCBhY3Rpb25FbnF1ZXVlZDEgPSB7XG4gICAgdHlwZTogJ0ZFVENIX1BBR0VfUkVRVUVTVCcsXG4gICAgcGF5bG9hZDoge1xuICAgICAgaWQ6ICcyJyxcbiAgICB9LFxuICAgIG1ldGE6IHtcbiAgICAgIHJldHJ5OiB0cnVlLFxuICAgICAgZGlzbWlzczogWydOQVZJR0FURV9CQUNLJywgJ05BVklHQVRFX1RPX0xPR0lOJ10sXG4gICAgfSxcbiAgfTtcbiAgY29uc3QgYWN0aW9uRW5xdWV1ZWQyID0ge1xuICAgIHR5cGU6ICdGRVRDSF9VU0VSX1JFUVVFU1QnLFxuICAgIHBheWxvYWQ6IHtcbiAgICAgIGlkOiAnNCcsXG4gICAgfSxcbiAgICBtZXRhOiB7XG4gICAgICByZXRyeTogdHJ1ZSxcbiAgICAgIGRpc21pc3M6IFsnTkFWSUdBVEVfVE9fTE9HSU4nXSxcbiAgICB9LFxuICB9O1xuICBjb25zdCBhY3Rpb25FbnF1ZXVlZDMgPSB7XG4gICAgdHlwZTogJ0ZFVENIX1VTRVJfUkVRVUVTVCcsXG4gICAgcGF5bG9hZDoge1xuICAgICAgaWQ6ICc0JyxcbiAgICB9LFxuICAgIG1ldGE6IHtcbiAgICAgIHJldHJ5OiB0cnVlLFxuICAgIH0sXG4gIH07XG5cbiAgaXQoJ05BVklHQVRFX0JBQ0sgZGlzcGF0Y2hlZCwgZGlzbWlzc2luZyAxIGFjdGlvbicsICgpID0+IHtcbiAgICBjb25zdCBwcmV2U3RhdGUgPSBnZXRTdGF0ZShcbiAgICAgIGZhbHNlLFxuICAgICAgYWN0aW9uRW5xdWV1ZWQxLFxuICAgICAgYWN0aW9uRW5xdWV1ZWQyLFxuICAgICAgYWN0aW9uRW5xdWV1ZWQzLFxuICAgICk7XG4gICAgY29uc3QgYWN0aW9uID0gYWN0aW9uQ3JlYXRvcnMuZGlzbWlzc0FjdGlvbnNGcm9tUXVldWUoJ05BVklHQVRFX0JBQ0snKTtcblxuICAgIGV4cGVjdChuZXR3b3JrUmVkdWNlcihwcmV2U3RhdGUsIGFjdGlvbikpLnRvRXF1YWwoXG4gICAgICBnZXRTdGF0ZShmYWxzZSwgYWN0aW9uRW5xdWV1ZWQyLCBhY3Rpb25FbnF1ZXVlZDMpLFxuICAgICk7XG4gIH0pO1xuXG4gIGl0KCdOQVZJR0FURV9UT19MT0dJTiBkaXNwYXRjaGVkLCBkaXNtaXNzaW5nIDIgYWN0aW9ucycsICgpID0+IHtcbiAgICBjb25zdCBwcmV2U3RhdGUgPSBnZXRTdGF0ZShcbiAgICAgIGZhbHNlLFxuICAgICAgYWN0aW9uRW5xdWV1ZWQxLFxuICAgICAgYWN0aW9uRW5xdWV1ZWQyLFxuICAgICAgYWN0aW9uRW5xdWV1ZWQzLFxuICAgICk7XG4gICAgY29uc3QgYWN0aW9uID0gYWN0aW9uQ3JlYXRvcnMuZGlzbWlzc0FjdGlvbnNGcm9tUXVldWUoJ05BVklHQVRFX1RPX0xPR0lOJyk7XG5cbiAgICBleHBlY3QobmV0d29ya1JlZHVjZXIocHJldlN0YXRlLCBhY3Rpb24pKS50b0VxdWFsKFxuICAgICAgZ2V0U3RhdGUoZmFsc2UsIGFjdGlvbkVucXVldWVkMyksXG4gICAgKTtcbiAgfSk7XG5cbiAgaXQoXCJBbnkgb3RoZXIgYWN0aW9uIGRpc3BhdGNoZWQsIG5vIGNoYW5nZXMgKGFsdGhvdWdoIHRoZSBtaWRkbGV3YXJlIHdvbid0IGFsbG93IHRoYXQpXCIsICgpID0+IHtcbiAgICBjb25zdCBwcmV2U3RhdGUgPSBnZXRTdGF0ZShcbiAgICAgIGZhbHNlLFxuICAgICAgYWN0aW9uRW5xdWV1ZWQxLFxuICAgICAgYWN0aW9uRW5xdWV1ZWQyLFxuICAgICAgYWN0aW9uRW5xdWV1ZWQzLFxuICAgICk7XG4gICAgY29uc3QgYWN0aW9uID0gYWN0aW9uQ3JlYXRvcnMuZGlzbWlzc0FjdGlvbnNGcm9tUXVldWUoJ05BVklHQVRFX0FXQVknKTtcblxuICAgIGV4cGVjdChuZXR3b3JrUmVkdWNlcihwcmV2U3RhdGUsIGFjdGlvbikpLnRvRXF1YWwoXG4gICAgICBnZXRTdGF0ZShmYWxzZSwgYWN0aW9uRW5xdWV1ZWQxLCBhY3Rpb25FbnF1ZXVlZDIsIGFjdGlvbkVucXVldWVkMyksXG4gICAgKTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ25ldHdvcmtTZWxlY3RvcicsICgpID0+IHtcbiAgaXQoJ3JldHVybnMgdGhlIGNvcnJlY3Qgc2hhcGUnLCAoKSA9PiB7XG4gICAgY29uc3Qgc3RhdGU6IHsgbmV0d29yazogTmV0d29ya1N0YXRlIH0gPSB7XG4gICAgICBuZXR3b3JrOiB7XG4gICAgICAgIGlzQ29ubmVjdGVkOiB0cnVlLFxuICAgICAgICBhY3Rpb25RdWV1ZTogW3sgdHlwZTogJ2ZvbycsIHBheWxvYWQ6IHt9IH1dLFxuICAgICAgICBpc1F1ZXVlUGF1c2VkOiBmYWxzZSxcbiAgICAgIH0sXG4gICAgfTtcbiAgICBleHBlY3QobmV0d29ya1NlbGVjdG9yKHN0YXRlKSkudG9FcXVhbCh7XG4gICAgICBpc0Nvbm5lY3RlZDogdHJ1ZSxcbiAgICAgIGFjdGlvblF1ZXVlOiBbeyB0eXBlOiAnZm9vJywgcGF5bG9hZDoge30gfV0sXG4gICAgICBpc1F1ZXVlUGF1c2VkOiBmYWxzZSxcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdfQ==